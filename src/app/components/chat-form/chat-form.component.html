<div class="chat-form-container">
  <!-- Form Header -->
  <div class="form-header">
    <h3 class="form-title">{{ formLayout.data.title | titlecase}}</h3>
    <div class="form-actions-top">
      @if (formLayout.data.metadata) {
        <button
          class="btn btn-info btn-sm"
          (click)="toggleMetadata()"
          title="Show form information"
          >
          ℹ️
        </button>
      }
    </div>
  </div>

  <!-- Submission Status Banner -->
  @if (isSubmitted) {
    <div class="submission-banner success">
      ✓ {{ formSubmittedMessage }}
    </div>
  }

  <!-- Metadata Panel -->
  @if (showMetadata && formLayout.data.metadata) {
    <div class="metadata-panel">
      <div class="metadata-content">
        <h4>Form Information</h4>
        @for (item of metadataEntries; track item) {
          <div class="metadata-item">
            <strong>{{ item.key | titlecase }}:</strong> {{ item.value }}
          </div>
        }
      </div>
    </div>
  }

  <!-- Dynamic Form Content -->
  <div class="form-content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="dynamic-form">
      <!-- Dynamic form fields will be generated here based on schema -->
      @for (field of formFields; track field) {
        <div class="form-field">
          <label [for]="field.key" [class.required]="field.required">{{ field.title }}</label>
          <!-- Text Input -->
          @if (field.type === 'string' && field.widgetType !== 'textArea') {
            <input
              [id]="field.key"
              type="text"
              [formControlName]="field.key"
              [placeholder]="field.placeholder"
              class="form-control"
              [class.readonly]="isSubmitted"
              [readonly]="isSubmitted"
              />
          }
          <!-- Text Area -->
          @if (field.widgetType === 'textArea') {
            <textarea
              [id]="field.key"
              [formControlName]="field.key"
              [placeholder]="field.placeholder"
              class="form-control"
              rows="3"
              [class.readonly]="isSubmitted"
              [readonly]="isSubmitted"
            ></textarea>
          }
          <!-- Number Input -->
          @if (field.type === 'number') {
            <input
              [id]="field.key"
              type="number"
              [formControlName]="field.key"
              [placeholder]="field.placeholder"
              class="form-control"
              [class.readonly]="isSubmitted"
              [readonly]="isSubmitted"
              />
          }
          <!-- Select Dropdown -->
          @if ((field.widgetType === 'select' || 'dropdown') && field.options) {
            <select
              [id]="field.key"
              [formControlName]="field.key"
              class="form-control"
              >
              <option value="">Select {{ field.title }}</option>
              @for (option of field.options; track option) {
                <option [value]="option.value">
                  {{ option.displayValue || option.value }}
                </option>
              }
            </select>
          }
          <!-- Boolean Checkbox -->
          @if (field.type === 'boolean') {
            <div class="checkbox-wrapper">
              <label>
                <input type="checkbox" [formControlName]="field.key" [disabled]="isSubmitted"/>
                {{ field.title }}
              </label>
            </div>
          }
          <!-- Validation Errors -->
          @if (form.get(field.key)?.invalid && form.get(field.key)?.touched && !isSubmitted) {
            <div class="error-message">
              @if (form.get(field.key)?.errors?.['required']) {
                <div>This field is required</div>
              }
              @if (form.get(field.key)?.errors?.['email']) {
                <div>Invalid email format</div>
              }
            </div>
          }
        </div>
      }

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" (click)="onCancel()" class="btn btn-secondary" [disabled]="isSubmitted">Cancel</button>
        <button type="submit" [disabled]="isSubmitting || isSubmitted || form.invalid" class="btn btn-primary">
          {{ isSubmitting ? 'Submitting...' : 'Submit' }}
        </button>
      </div>
    </form>
  </div>

</div>