var Vp=Object.create;var An=Object.defineProperty,Hp=Object.defineProperties,Jp=Object.getOwnPropertyDescriptor,Wp=Object.getOwnPropertyDescriptors,Kp=Object.getOwnPropertyNames,In=Object.getOwnPropertySymbols,eu=Object.getPrototypeOf,$s=Object.prototype.hasOwnProperty,tu=Object.prototype.propertyIsEnumerable,Yp=Reflect.get;var fr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Xp=r=>{throw TypeError(r)};var Qo=(r,e,t)=>e in r?An(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,l=(r,e)=>{for(var t in e||={})$s.call(e,t)&&Qo(r,t,e[t]);if(In)for(var t of In(e))tu.call(e,t)&&Qo(r,t,e[t]);return r},m=(r,e)=>Hp(r,Wp(e));var se=(r,e)=>{var t={};for(var n in r)$s.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&In)for(var n of In(r))e.indexOf(n)<0&&tu.call(r,n)&&(t[n]=r[n]);return t};var j=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),we=(r,e)=>{for(var t in e)An(r,t,{get:e[t],enumerable:!0})},Qp=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Kp(e))!$s.call(r,i)&&i!==t&&An(r,i,{get:()=>e[i],enumerable:!(n=Jp(e,i))||n.enumerable});return r};var gt=(r,e,t)=>(t=r!=null?Vp(eu(r)):{},Qp(e||!r||!r.__esModule?An(t,"default",{value:r,enumerable:!0}):t,r));var Is=(r,e,t)=>Yp(eu(r),t,e);var f=(r,e,t)=>new Promise((n,i)=>{var s=u=>{try{o(t.next(u))}catch(c){i(c)}},a=u=>{try{o(t.throw(u))}catch(c){i(c)}},o=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,a);o((t=t.apply(r,e)).next())}),x=function(r,e){this[0]=r,this[1]=e},H=(r,e,t)=>{var n=(a,o,u,c)=>{try{var d=t[a](o),p=(o=d.value)instanceof x,h=d.done;Promise.resolve(p?o[0]:o).then(g=>p?n(a==="return"?a:"next",o[1]?{done:g.done,value:g.value}:g,u,c):u({value:g,done:h})).catch(g=>n("throw",g,u,c))}catch(g){c(g)}},i=a=>s[a]=o=>new Promise((u,c)=>n(a,o,u,c)),s={};return t=t.apply(r,e),s[fr("asyncIterator")]=()=>s,i("next"),i("throw"),i("return"),s},ve=r=>{var e=r[fr("asyncIterator")],t=!1,n,i={};return e==null?(e=r[fr("iterator")](),n=s=>i[s]=a=>e[s](a)):(e=e.call(r),n=s=>i[s]=a=>{if(t){if(t=!1,s==="throw")throw a;return a}return t=!0,{done:!1,value:new x(new Promise(o=>{var u=e[s](a);u instanceof Object||Xp("Object expected"),o(u)}),1)}}),i[fr("iterator")]=()=>i,n("next"),"throw"in e?n("throw"):i.throw=s=>{throw s},"return"in e&&n("return"),i},X=(r,e,t)=>(e=r[fr("asyncIterator")])?e.call(r):(r=r[fr("iterator")](),e={},t=(n,i)=>(i=r[n])&&(e[n]=s=>new Promise((a,o,u)=>(s=i.call(r,s),u=s.done,Promise.resolve(s.value).then(c=>a({value:c,done:u}),o)))),t("next"),t("return"),e);var nu=j((Xv,ru)=>{"use strict";ru.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var lu=j((Qv,As)=>{"use strict";var eh=/[\p{Lu}]/u,th=/[\p{Ll}]/u,iu=/^[\p{Lu}](?![\p{Lu}])/gu,ou=/([\p{Alpha}\p{N}_]|$)/u,uu=/[_.\- ]+/,rh=new RegExp("^"+uu.source),su=new RegExp(uu.source+ou.source,"gu"),au=new RegExp("\\d+"+ou.source,"gu"),nh=(r,e,t)=>{let n=!1,i=!1,s=!1;for(let a=0;a<r.length;a++){let o=r[a];n&&eh.test(o)?(r=r.slice(0,a)+"-"+r.slice(a),n=!1,s=i,i=!0,a++):i&&s&&th.test(o)?(r=r.slice(0,a-1)+"-"+r.slice(a-1),s=i,i=!1,n=!0):(n=e(o)===o&&t(o)!==o,s=i,i=t(o)===o&&e(o)!==o)}return r},ih=(r,e)=>(iu.lastIndex=0,r.replace(iu,t=>e(t))),sh=(r,e)=>(su.lastIndex=0,au.lastIndex=0,r.replace(su,(t,n)=>e(n)).replace(au,t=>e(t))),cu=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e=l({pascalCase:!1,preserveConsecutiveUppercase:!1},e),Array.isArray(r)?r=r.map(s=>s.trim()).filter(s=>s.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),n=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=nh(r,t,n)),r=r.replace(rh,""),e.preserveConsecutiveUppercase?r=ih(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),sh(r,n))};As.exports=cu;As.exports.default=cu});var Du=j((JE,Mu)=>{"use strict";function Qe(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Mu.exports=Qe;Qe.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Qe.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Qe.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Qe.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Qe.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Qe.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Qe.prototype.start=Qe.prototype.try;Qe.prototype.errors=function(){return this._errors};Qe.prototype.attempts=function(){return this._attempts};Qe.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,a=(r[s]||0)+1;r[s]=a,a>=t&&(e=i,t=a)}return e}});var Uu=j(Yt=>{"use strict";var Sm=Du();Yt.operation=function(r){var e=Yt.timeouts(r);return new Sm(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Yt.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<e.retries;i++)n.push(this.createTimeout(i,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(i,e)),n.sort(function(s,a){return s-a}),n};Yt.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Yt.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var i=0;i<t.length;i++){var s=t[i],a=r[s];r[s]=(function(u){var c=Yt.operation(e),d=Array.prototype.slice.call(arguments,1),p=d.pop();d.push(function(h){c.retry(h)||(h&&(arguments[0]=c.mainError()),p.apply(this,arguments))}),c.attempt(function(){u.apply(r,d)})}).bind(r,a),r[s].options=e}}});var Fu=j((KE,Zu)=>{"use strict";Zu.exports=Uu()});var Yn=j((Gu,Kn)=>{"use strict";var Tm=Fu(),Om=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Wn=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},$m=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},Im=r=>Om.includes(r),Bu=(r,e)=>new Promise((t,n)=>{e=l({onFailedAttempt:()=>{},retries:10},e);let i=Tm.operation(e);i.attempt(s=>f(null,null,function*(){try{t(yield r(s))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Wn)i.stop(),n(a.originalError);else if(a instanceof TypeError&&!Im(a.message))i.stop(),n(a);else{$m(a,s,e);try{yield e.onFailedAttempt(a)}catch(o){n(o);return}i.retry(a)||n(i.mainError())}}}))});Kn.exports=Bu;Kn.exports.default=Bu;Kn.exports.AbortError=Wn});var Zc=j((SS,Ta)=>{"use strict";var fg=Object.prototype.hasOwnProperty,ke="~";function Qr(){}Object.create&&(Qr.prototype=Object.create(null),new Qr().__proto__||(ke=!1));function pg(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Uc(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new pg(t,n||r,i),a=ke?ke+e:e;return r._events[a]?r._events[a].fn?r._events[a]=[r._events[a],s]:r._events[a].push(s):(r._events[a]=s,r._eventsCount++),r}function mi(r,e){--r._eventsCount===0?r._events=new Qr:delete r._events[e]}function Ie(){this._events=new Qr,this._eventsCount=0}Ie.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)fg.call(t,n)&&e.push(ke?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ie.prototype.listeners=function(e){var t=ke?ke+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,a=new Array(s);i<s;i++)a[i]=n[i].fn;return a};Ie.prototype.listenerCount=function(e){var t=ke?ke+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Ie.prototype.emit=function(e,t,n,i,s,a){var o=ke?ke+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,d,p;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,s),!0;case 6:return u.fn.call(u.context,t,n,i,s,a),!0}for(p=1,d=new Array(c-1);p<c;p++)d[p-1]=arguments[p];u.fn.apply(u.context,d)}else{var h=u.length,g;for(p=0;p<h;p++)switch(u[p].once&&this.removeListener(e,u[p].fn,void 0,!0),c){case 1:u[p].fn.call(u[p].context);break;case 2:u[p].fn.call(u[p].context,t);break;case 3:u[p].fn.call(u[p].context,t,n);break;case 4:u[p].fn.call(u[p].context,t,n,i);break;default:if(!d)for(g=1,d=new Array(c-1);g<c;g++)d[g-1]=arguments[g];u[p].fn.apply(u[p].context,d)}}return!0};Ie.prototype.on=function(e,t,n){return Uc(this,e,t,n,!1)};Ie.prototype.once=function(e,t,n){return Uc(this,e,t,n,!0)};Ie.prototype.removeListener=function(e,t,n,i){var s=ke?ke+e:e;if(!this._events[s])return this;if(!t)return mi(this,s),this;var a=this._events[s];if(a.fn)a.fn===t&&(!i||a.once)&&(!n||a.context===n)&&mi(this,s);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||i&&!a[o].once||n&&a[o].context!==n)&&u.push(a[o]);u.length?this._events[s]=u.length===1?u[0]:u:mi(this,s)}return this};Ie.prototype.removeAllListeners=function(e){var t;return e?(t=ke?ke+e:e,this._events[t]&&mi(this,t)):(this._events=new Qr,this._eventsCount=0),this};Ie.prototype.off=Ie.prototype.removeListener;Ie.prototype.addListener=Ie.prototype.on;Ie.prefixed=ke;Ie.EventEmitter=Ie;typeof Ta<"u"&&(Ta.exports=Ie)});var Bc=j((TS,Fc)=>{"use strict";Fc.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var qc=j((OS,_i)=>{"use strict";var hg=Bc(),gi=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Gc=(r,e,t)=>new Promise((n,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let s=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){i(u)}return}let a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new gi(a);typeof r.cancel=="function"&&r.cancel(),i(o)},e);hg(r.then(n,i),()=>{clearTimeout(s)})});_i.exports=Gc;_i.exports.default=Gc;_i.exports.TimeoutError=gi});var Vc=j(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});function mg(r,e,t){let n=0,i=r.length;for(;i>0;){let s=i/2|0,a=n+s;t(r[a],e)<=0?(n=++a,i-=s+1):i=s}return n}Oa.default=mg});var Hc=j(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});var gg=Vc(),$a=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let i=gg.default(this._queue,n,(s,a)=>a.priority-s.priority);this._queue.splice(i,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};Ia.default=$a});var bi=j(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});var _g=Zc(),Jc=qc(),yg=Hc(),yi=()=>{},bg=new Jc.TimeoutError,Aa=class extends _g{constructor(e){var t,n,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=yi,this._resolveIdle=yi,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:yg.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=yi,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=yi,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}add(n){return f(this,arguments,function*(e,t={}){return new Promise((i,s)=>{let a=()=>f(this,null,function*(){this._pendingCount++,this._intervalCount++;try{let o=this._timeout===void 0&&t.timeout===void 0?e():Jc.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(bg)});i(yield o)}catch(o){s(o)}this._next()});this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})})}addAll(e,t){return f(this,null,function*(){return Promise.all(e.map(n=>f(this,null,function*(){return this.add(n,t)})))})}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}onEmpty(){return f(this,null,function*(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})})}onIdle(){return f(this,null,function*(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Pa.default=Aa});var tn=j((jS,Kc)=>{"use strict";var vg="2.0.0",xg=Number.MAX_SAFE_INTEGER||9007199254740991,Eg=16,Sg=250,Tg=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Kc.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Eg,MAX_SAFE_BUILD_LENGTH:Sg,MAX_SAFE_INTEGER:xg,RELEASE_TYPES:Tg,SEMVER_SPEC_VERSION:vg,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var rn=j((LS,Yc)=>{"use strict";var Og=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Yc.exports=Og});var Tr=j((vt,Xc)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Na,MAX_SAFE_BUILD_LENGTH:$g,MAX_LENGTH:Ig}=tn(),Ag=rn();vt=Xc.exports={};var Pg=vt.re=[],kg=vt.safeRe=[],A=vt.src=[],Rg=vt.safeSrc=[],P=vt.t={},Ng=0,Ca="[a-zA-Z0-9-]",Cg=[["\\s",1],["\\d",Ig],[Ca,$g]],jg=r=>{for(let[e,t]of Cg)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},W=(r,e,t)=>{let n=jg(e),i=Ng++;Ag(r,i,e),P[r]=i,A[i]=e,Rg[i]=n,Pg[i]=new RegExp(e,t?"g":void 0),kg[i]=new RegExp(n,t?"g":void 0)};W("NUMERICIDENTIFIER","0|[1-9]\\d*");W("NUMERICIDENTIFIERLOOSE","\\d+");W("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Ca}*`);W("MAINVERSION",`(${A[P.NUMERICIDENTIFIER]})\\.(${A[P.NUMERICIDENTIFIER]})\\.(${A[P.NUMERICIDENTIFIER]})`);W("MAINVERSIONLOOSE",`(${A[P.NUMERICIDENTIFIERLOOSE]})\\.(${A[P.NUMERICIDENTIFIERLOOSE]})\\.(${A[P.NUMERICIDENTIFIERLOOSE]})`);W("PRERELEASEIDENTIFIER",`(?:${A[P.NUMERICIDENTIFIER]}|${A[P.NONNUMERICIDENTIFIER]})`);W("PRERELEASEIDENTIFIERLOOSE",`(?:${A[P.NUMERICIDENTIFIERLOOSE]}|${A[P.NONNUMERICIDENTIFIER]})`);W("PRERELEASE",`(?:-(${A[P.PRERELEASEIDENTIFIER]}(?:\\.${A[P.PRERELEASEIDENTIFIER]})*))`);W("PRERELEASELOOSE",`(?:-?(${A[P.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${A[P.PRERELEASEIDENTIFIERLOOSE]})*))`);W("BUILDIDENTIFIER",`${Ca}+`);W("BUILD",`(?:\\+(${A[P.BUILDIDENTIFIER]}(?:\\.${A[P.BUILDIDENTIFIER]})*))`);W("FULLPLAIN",`v?${A[P.MAINVERSION]}${A[P.PRERELEASE]}?${A[P.BUILD]}?`);W("FULL",`^${A[P.FULLPLAIN]}$`);W("LOOSEPLAIN",`[v=\\s]*${A[P.MAINVERSIONLOOSE]}${A[P.PRERELEASELOOSE]}?${A[P.BUILD]}?`);W("LOOSE",`^${A[P.LOOSEPLAIN]}$`);W("GTLT","((?:<|>)?=?)");W("XRANGEIDENTIFIERLOOSE",`${A[P.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);W("XRANGEIDENTIFIER",`${A[P.NUMERICIDENTIFIER]}|x|X|\\*`);W("XRANGEPLAIN",`[v=\\s]*(${A[P.XRANGEIDENTIFIER]})(?:\\.(${A[P.XRANGEIDENTIFIER]})(?:\\.(${A[P.XRANGEIDENTIFIER]})(?:${A[P.PRERELEASE]})?${A[P.BUILD]}?)?)?`);W("XRANGEPLAINLOOSE",`[v=\\s]*(${A[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${A[P.XRANGEIDENTIFIERLOOSE]})(?:${A[P.PRERELEASELOOSE]})?${A[P.BUILD]}?)?)?`);W("XRANGE",`^${A[P.GTLT]}\\s*${A[P.XRANGEPLAIN]}$`);W("XRANGELOOSE",`^${A[P.GTLT]}\\s*${A[P.XRANGEPLAINLOOSE]}$`);W("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Na}})(?:\\.(\\d{1,${Na}}))?(?:\\.(\\d{1,${Na}}))?`);W("COERCE",`${A[P.COERCEPLAIN]}(?:$|[^\\d])`);W("COERCEFULL",A[P.COERCEPLAIN]+`(?:${A[P.PRERELEASE]})?(?:${A[P.BUILD]})?(?:$|[^\\d])`);W("COERCERTL",A[P.COERCE],!0);W("COERCERTLFULL",A[P.COERCEFULL],!0);W("LONETILDE","(?:~>?)");W("TILDETRIM",`(\\s*)${A[P.LONETILDE]}\\s+`,!0);vt.tildeTrimReplace="$1~";W("TILDE",`^${A[P.LONETILDE]}${A[P.XRANGEPLAIN]}$`);W("TILDELOOSE",`^${A[P.LONETILDE]}${A[P.XRANGEPLAINLOOSE]}$`);W("LONECARET","(?:\\^)");W("CARETTRIM",`(\\s*)${A[P.LONECARET]}\\s+`,!0);vt.caretTrimReplace="$1^";W("CARET",`^${A[P.LONECARET]}${A[P.XRANGEPLAIN]}$`);W("CARETLOOSE",`^${A[P.LONECARET]}${A[P.XRANGEPLAINLOOSE]}$`);W("COMPARATORLOOSE",`^${A[P.GTLT]}\\s*(${A[P.LOOSEPLAIN]})$|^$`);W("COMPARATOR",`^${A[P.GTLT]}\\s*(${A[P.FULLPLAIN]})$|^$`);W("COMPARATORTRIM",`(\\s*)${A[P.GTLT]}\\s*(${A[P.LOOSEPLAIN]}|${A[P.XRANGEPLAIN]})`,!0);vt.comparatorTrimReplace="$1$2$3";W("HYPHENRANGE",`^\\s*(${A[P.XRANGEPLAIN]})\\s+-\\s+(${A[P.XRANGEPLAIN]})\\s*$`);W("HYPHENRANGELOOSE",`^\\s*(${A[P.XRANGEPLAINLOOSE]})\\s+-\\s+(${A[P.XRANGEPLAINLOOSE]})\\s*$`);W("STAR","(<|>)?=?\\s*\\*");W("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");W("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var vi=j((zS,Qc)=>{"use strict";var Lg=Object.freeze({loose:!0}),zg=Object.freeze({}),Mg=r=>r?typeof r!="object"?Lg:r:zg;Qc.exports=Mg});var ja=j((MS,rl)=>{"use strict";var el=/^[0-9]+$/,tl=(r,e)=>{let t=el.test(r),n=el.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},Dg=(r,e)=>tl(e,r);rl.exports={compareIdentifiers:tl,rcompareIdentifiers:Dg}});var Ae=j((DS,al)=>{"use strict";var xi=rn(),{MAX_LENGTH:nl,MAX_SAFE_INTEGER:Ei}=tn(),{safeRe:il,safeSrc:sl,t:Si}=Tr(),Ug=vi(),{compareIdentifiers:Or}=ja(),La=class r{constructor(e,t){if(t=Ug(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>nl)throw new TypeError(`version is longer than ${nl} characters`);xi("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?il[Si.LOOSE]:il[Si.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ei||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ei||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ei||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<Ei)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(xi("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),Or(this.major,e.major)||Or(this.minor,e.minor)||Or(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(xi("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Or(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(xi("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Or(n,i)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=new RegExp(`^${this.options.loose?sl[Si.PRERELEASELOOSE]:sl[Si.PRERELEASE]}$`),s=`-${t}`.match(i);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),Or(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};al.exports=La});var nr=j((US,ul)=>{"use strict";var ol=Ae(),Zg=(r,e,t=!1)=>{if(r instanceof ol)return r;try{return new ol(r,e)}catch(n){if(!t)return null;throw n}};ul.exports=Zg});var ll=j((ZS,cl)=>{"use strict";var Fg=nr(),Bg=(r,e)=>{let t=Fg(r,e);return t?t.version:null};cl.exports=Bg});var fl=j((FS,dl)=>{"use strict";var Gg=nr(),qg=(r,e)=>{let t=Gg(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};dl.exports=qg});var ml=j((BS,hl)=>{"use strict";var pl=Ae(),Vg=(r,e,t,n,i)=>{typeof t=="string"&&(i=n,n=t,t=void 0);try{return new pl(r instanceof pl?r.version:r,t).inc(e,n,i).version}catch{return null}};hl.exports=Vg});var yl=j((GS,_l)=>{"use strict";var gl=nr(),Hg=(r,e)=>{let t=gl(r,null,!0),n=gl(e,null,!0),i=t.compare(n);if(i===0)return null;let s=i>0,a=s?t:n,o=s?n:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let d=u?"pre":"";return t.major!==n.major?d+"major":t.minor!==n.minor?d+"minor":t.patch!==n.patch?d+"patch":"prerelease"};_l.exports=Hg});var wl=j((qS,bl)=>{"use strict";var Jg=Ae(),Wg=(r,e)=>new Jg(r,e).major;bl.exports=Wg});var xl=j((VS,vl)=>{"use strict";var Kg=Ae(),Yg=(r,e)=>new Kg(r,e).minor;vl.exports=Yg});var Sl=j((HS,El)=>{"use strict";var Xg=Ae(),Qg=(r,e)=>new Xg(r,e).patch;El.exports=Qg});var Ol=j((JS,Tl)=>{"use strict";var e_=nr(),t_=(r,e)=>{let t=e_(r,e);return t&&t.prerelease.length?t.prerelease:null};Tl.exports=t_});var tt=j((WS,Il)=>{"use strict";var $l=Ae(),r_=(r,e,t)=>new $l(r,t).compare(new $l(e,t));Il.exports=r_});var Pl=j((KS,Al)=>{"use strict";var n_=tt(),i_=(r,e,t)=>n_(e,r,t);Al.exports=i_});var Rl=j((YS,kl)=>{"use strict";var s_=tt(),a_=(r,e)=>s_(r,e,!0);kl.exports=a_});var Ti=j((XS,Cl)=>{"use strict";var Nl=Ae(),o_=(r,e,t)=>{let n=new Nl(r,t),i=new Nl(e,t);return n.compare(i)||n.compareBuild(i)};Cl.exports=o_});var Ll=j((QS,jl)=>{"use strict";var u_=Ti(),c_=(r,e)=>r.sort((t,n)=>u_(t,n,e));jl.exports=c_});var Ml=j((eT,zl)=>{"use strict";var l_=Ti(),d_=(r,e)=>r.sort((t,n)=>l_(n,t,e));zl.exports=d_});var nn=j((tT,Dl)=>{"use strict";var f_=tt(),p_=(r,e,t)=>f_(r,e,t)>0;Dl.exports=p_});var Oi=j((rT,Ul)=>{"use strict";var h_=tt(),m_=(r,e,t)=>h_(r,e,t)<0;Ul.exports=m_});var za=j((nT,Zl)=>{"use strict";var g_=tt(),__=(r,e,t)=>g_(r,e,t)===0;Zl.exports=__});var Ma=j((iT,Fl)=>{"use strict";var y_=tt(),b_=(r,e,t)=>y_(r,e,t)!==0;Fl.exports=b_});var $i=j((sT,Bl)=>{"use strict";var w_=tt(),v_=(r,e,t)=>w_(r,e,t)>=0;Bl.exports=v_});var Ii=j((aT,Gl)=>{"use strict";var x_=tt(),E_=(r,e,t)=>x_(r,e,t)<=0;Gl.exports=E_});var Da=j((oT,ql)=>{"use strict";var S_=za(),T_=Ma(),O_=nn(),$_=$i(),I_=Oi(),A_=Ii(),P_=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return S_(r,t,n);case"!=":return T_(r,t,n);case">":return O_(r,t,n);case">=":return $_(r,t,n);case"<":return I_(r,t,n);case"<=":return A_(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};ql.exports=P_});var Hl=j((uT,Vl)=>{"use strict";var k_=Ae(),R_=nr(),{safeRe:Ai,t:Pi}=Tr(),N_=(r,e)=>{if(r instanceof k_)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?Ai[Pi.COERCEFULL]:Ai[Pi.COERCE]);else{let u=e.includePrerelease?Ai[Pi.COERCERTLFULL]:Ai[Pi.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let n=t[2],i=t[3]||"0",s=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return R_(`${n}.${i}.${s}${a}${o}`,e)};Vl.exports=N_});var Wl=j((cT,Jl)=>{"use strict";var Ua=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Jl.exports=Ua});var rt=j((lT,Ql)=>{"use strict";var C_=/\s+/g,Za=class r{constructor(e,t){if(t=L_(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Fa)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(C_," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!Yl(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&B_(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&Z_)|(this.options.loose&&F_))+":"+e,i=Kl.get(n);if(i)return i;let s=this.options.loose,a=s?Ue[Re.HYPHENRANGELOOSE]:Ue[Re.HYPHENRANGE];e=e.replace(a,Q_(this.options.includePrerelease)),ie("hyphen replace",e),e=e.replace(Ue[Re.COMPARATORTRIM],M_),ie("comparator trim",e),e=e.replace(Ue[Re.TILDETRIM],D_),ie("tilde trim",e),e=e.replace(Ue[Re.CARETTRIM],U_),ie("caret trim",e);let o=e.split(" ").map(p=>G_(p,this.options)).join(" ").split(/\s+/).map(p=>X_(p,this.options));s&&(o=o.filter(p=>(ie("loose invalid filter",p,this.options),!!p.match(Ue[Re.COMPARATORLOOSE])))),ie("range list",o);let u=new Map,c=o.map(p=>new Fa(p,this.options));for(let p of c){if(Yl(p))return[p];u.set(p.value,p)}u.size>1&&u.has("")&&u.delete("");let d=[...u.values()];return Kl.set(n,d),d}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Xl(n,t)&&e.set.some(i=>Xl(i,t)&&n.every(s=>i.every(a=>s.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new z_(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(ey(this.set[t],e,this.options))return!0;return!1}};Ql.exports=Za;var j_=Wl(),Kl=new j_,L_=vi(),Fa=sn(),ie=rn(),z_=Ae(),{safeRe:Ue,t:Re,comparatorTrimReplace:M_,tildeTrimReplace:D_,caretTrimReplace:U_}=Tr(),{FLAG_INCLUDE_PRERELEASE:Z_,FLAG_LOOSE:F_}=tn(),Yl=r=>r.value==="<0.0.0-0",B_=r=>r.value==="",Xl=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},G_=(r,e)=>(ie("comp",r,e),r=H_(r,e),ie("caret",r),r=q_(r,e),ie("tildes",r),r=W_(r,e),ie("xrange",r),r=Y_(r,e),ie("stars",r),r),Ne=r=>!r||r.toLowerCase()==="x"||r==="*",q_=(r,e)=>r.trim().split(/\s+/).map(t=>V_(t,e)).join(" "),V_=(r,e)=>{let t=e.loose?Ue[Re.TILDELOOSE]:Ue[Re.TILDE];return r.replace(t,(n,i,s,a,o)=>{ie("tilde",r,n,i,s,a,o);let u;return Ne(i)?u="":Ne(s)?u=`>=${i}.0.0 <${+i+1}.0.0-0`:Ne(a)?u=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:o?(ie("replaceTilde pr",o),u=`>=${i}.${s}.${a}-${o} <${i}.${+s+1}.0-0`):u=`>=${i}.${s}.${a} <${i}.${+s+1}.0-0`,ie("tilde return",u),u})},H_=(r,e)=>r.trim().split(/\s+/).map(t=>J_(t,e)).join(" "),J_=(r,e)=>{ie("caret",r,e);let t=e.loose?Ue[Re.CARETLOOSE]:Ue[Re.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,a,o,u)=>{ie("caret",r,i,s,a,o,u);let c;return Ne(s)?c="":Ne(a)?c=`>=${s}.0.0${n} <${+s+1}.0.0-0`:Ne(o)?s==="0"?c=`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:u?(ie("replaceCaret pr",u),s==="0"?a==="0"?c=`>=${s}.${a}.${o}-${u} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}-${u} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o}-${u} <${+s+1}.0.0-0`):(ie("no pr"),s==="0"?a==="0"?c=`>=${s}.${a}.${o}${n} <${s}.${a}.${+o+1}-0`:c=`>=${s}.${a}.${o}${n} <${s}.${+a+1}.0-0`:c=`>=${s}.${a}.${o} <${+s+1}.0.0-0`),ie("caret return",c),c})},W_=(r,e)=>(ie("replaceXRanges",r,e),r.split(/\s+/).map(t=>K_(t,e)).join(" ")),K_=(r,e)=>{r=r.trim();let t=e.loose?Ue[Re.XRANGELOOSE]:Ue[Re.XRANGE];return r.replace(t,(n,i,s,a,o,u)=>{ie("xRange",r,n,i,s,a,o,u);let c=Ne(s),d=c||Ne(a),p=d||Ne(o),h=p;return i==="="&&h&&(i=""),u=e.includePrerelease?"-0":"",c?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&h?(d&&(a=0),o=0,i===">"?(i=">=",d?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",d?s=+s+1:a=+a+1),i==="<"&&(u="-0"),n=`${i+s}.${a}.${o}${u}`):d?n=`>=${s}.0.0${u} <${+s+1}.0.0-0`:p&&(n=`>=${s}.${a}.0${u} <${s}.${+a+1}.0-0`),ie("xRange return",n),n})},Y_=(r,e)=>(ie("replaceStars",r,e),r.trim().replace(Ue[Re.STAR],"")),X_=(r,e)=>(ie("replaceGTE0",r,e),r.trim().replace(Ue[e.includePrerelease?Re.GTE0PRE:Re.GTE0],"")),Q_=r=>(e,t,n,i,s,a,o,u,c,d,p,h)=>(Ne(n)?t="":Ne(i)?t=`>=${n}.0.0${r?"-0":""}`:Ne(s)?t=`>=${n}.${i}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,Ne(c)?u="":Ne(d)?u=`<${+c+1}.0.0-0`:Ne(p)?u=`<${c}.${+d+1}.0-0`:h?u=`<=${c}.${d}.${p}-${h}`:r?u=`<${c}.${d}.${+p+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),ey=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(ie(r[n].semver),r[n].semver!==Fa.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var sn=j((dT,sd)=>{"use strict";var an=Symbol("SemVer ANY"),qa=class r{static get ANY(){return an}constructor(e,t){if(t=ed(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ga("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===an?this.value="":this.value=this.operator+this.semver.version,Ga("comp",this)}parse(e){let t=this.options.loose?td[rd.COMPARATORLOOSE]:td[rd.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new nd(n[2],this.options.loose):this.semver=an}toString(){return this.value}test(e){if(Ga("Comparator.test",e,this.options.loose),this.semver===an||e===an)return!0;if(typeof e=="string")try{e=new nd(e,this.options)}catch{return!1}return Ba(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new id(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new id(this.value,t).test(e.semver):(t=ed(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Ba(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Ba(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};sd.exports=qa;var ed=vi(),{safeRe:td,t:rd}=Tr(),Ba=Da(),Ga=rn(),nd=Ae(),id=rt()});var on=j((fT,ad)=>{"use strict";var ty=rt(),ry=(r,e,t)=>{try{e=new ty(e,t)}catch{return!1}return e.test(r)};ad.exports=ry});var ud=j((pT,od)=>{"use strict";var ny=rt(),iy=(r,e)=>new ny(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));od.exports=iy});var ld=j((hT,cd)=>{"use strict";var sy=Ae(),ay=rt(),oy=(r,e,t)=>{let n=null,i=null,s=null;try{s=new ay(e,t)}catch{return null}return r.forEach(a=>{s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new sy(n,t))}),n};cd.exports=oy});var fd=j((mT,dd)=>{"use strict";var uy=Ae(),cy=rt(),ly=(r,e,t)=>{let n=null,i=null,s=null;try{s=new cy(e,t)}catch{return null}return r.forEach(a=>{s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new uy(n,t))}),n};dd.exports=ly});var md=j((gT,hd)=>{"use strict";var Va=Ae(),dy=rt(),pd=nn(),fy=(r,e)=>{r=new dy(r,e);let t=new Va("0.0.0");if(r.test(t)||(t=new Va("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let i=r.set[n],s=null;i.forEach(a=>{let o=new Va(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||pd(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!t||pd(t,s))&&(t=s)}return t&&r.test(t)?t:null};hd.exports=fy});var _d=j((_T,gd)=>{"use strict";var py=rt(),hy=(r,e)=>{try{return new py(r,e).range||"*"}catch{return null}};gd.exports=hy});var ki=j((yT,vd)=>{"use strict";var my=Ae(),wd=sn(),{ANY:gy}=wd,_y=rt(),yy=on(),yd=nn(),bd=Oi(),by=Ii(),wy=$i(),vy=(r,e,t,n)=>{r=new my(r,n),e=new _y(e,n);let i,s,a,o,u;switch(t){case">":i=yd,s=by,a=bd,o=">",u=">=";break;case"<":i=bd,s=wy,a=yd,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(yy(r,e,n))return!1;for(let c=0;c<e.set.length;++c){let d=e.set[c],p=null,h=null;if(d.forEach(g=>{g.semver===gy&&(g=new wd(">=0.0.0")),p=p||g,h=h||g,i(g.semver,p.semver,n)?p=g:a(g.semver,h.semver,n)&&(h=g)}),p.operator===o||p.operator===u||(!h.operator||h.operator===o)&&s(r,h.semver))return!1;if(h.operator===u&&a(r,h.semver))return!1}return!0};vd.exports=vy});var Ed=j((bT,xd)=>{"use strict";var xy=ki(),Ey=(r,e,t)=>xy(r,e,">",t);xd.exports=Ey});var Td=j((wT,Sd)=>{"use strict";var Sy=ki(),Ty=(r,e,t)=>Sy(r,e,"<",t);Sd.exports=Ty});var Id=j((vT,$d)=>{"use strict";var Od=rt(),Oy=(r,e,t)=>(r=new Od(r,t),e=new Od(e,t),r.intersects(e,t));$d.exports=Oy});var Pd=j((xT,Ad)=>{"use strict";var $y=on(),Iy=tt();Ad.exports=(r,e,t)=>{let n=[],i=null,s=null,a=r.sort((d,p)=>Iy(d,p,t));for(let d of a)$y(d,e,t)?(s=d,i||(i=d)):(s&&n.push([i,s]),s=null,i=null);i&&n.push([i,null]);let o=[];for(let[d,p]of n)d===p?o.push(d):!p&&d===a[0]?o.push("*"):p?d===a[0]?o.push(`<=${p}`):o.push(`${d} - ${p}`):o.push(`>=${d}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Ld=j((ET,jd)=>{"use strict";var kd=rt(),Ja=sn(),{ANY:Ha}=Ja,un=on(),Wa=tt(),Ay=(r,e,t={})=>{if(r===e)return!0;r=new kd(r,t),e=new kd(e,t);let n=!1;e:for(let i of r.set){for(let s of e.set){let a=ky(i,s,t);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},Py=[new Ja(">=0.0.0-0")],Rd=[new Ja(">=0.0.0")],ky=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Ha){if(e.length===1&&e[0].semver===Ha)return!0;t.includePrerelease?r=Py:r=Rd}if(e.length===1&&e[0].semver===Ha){if(t.includePrerelease)return!0;e=Rd}let n=new Set,i,s;for(let g of r)g.operator===">"||g.operator===">="?i=Nd(i,g,t):g.operator==="<"||g.operator==="<="?s=Cd(s,g,t):n.add(g.semver);if(n.size>1)return null;let a;if(i&&s){if(a=Wa(i.semver,s.semver,t),a>0)return null;if(a===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let g of n){if(i&&!un(g,String(i),t)||s&&!un(g,String(s),t))return null;for(let _ of e)if(!un(g,String(_),t))return!1;return!0}let o,u,c,d,p=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,h=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;p&&p.prerelease.length===1&&s.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let g of e){if(d=d||g.operator===">"||g.operator===">=",c=c||g.operator==="<"||g.operator==="<=",i){if(h&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===h.major&&g.semver.minor===h.minor&&g.semver.patch===h.patch&&(h=!1),g.operator===">"||g.operator===">="){if(o=Nd(i,g,t),o===g&&o!==i)return!1}else if(i.operator===">="&&!un(i.semver,String(g),t))return!1}if(s){if(p&&g.semver.prerelease&&g.semver.prerelease.length&&g.semver.major===p.major&&g.semver.minor===p.minor&&g.semver.patch===p.patch&&(p=!1),g.operator==="<"||g.operator==="<="){if(u=Cd(s,g,t),u===g&&u!==s)return!1}else if(s.operator==="<="&&!un(s.semver,String(g),t))return!1}if(!g.operator&&(s||i)&&a!==0)return!1}return!(i&&c&&!s&&a!==0||s&&d&&!i&&a!==0||h||p)},Nd=(r,e,t)=>{if(!r)return e;let n=Wa(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},Cd=(r,e,t)=>{if(!r)return e;let n=Wa(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};jd.exports=Ay});var Ud=j((ST,Dd)=>{"use strict";var Ka=Tr(),zd=tn(),Ry=Ae(),Md=ja(),Ny=nr(),Cy=ll(),jy=fl(),Ly=ml(),zy=yl(),My=wl(),Dy=xl(),Uy=Sl(),Zy=Ol(),Fy=tt(),By=Pl(),Gy=Rl(),qy=Ti(),Vy=Ll(),Hy=Ml(),Jy=nn(),Wy=Oi(),Ky=za(),Yy=Ma(),Xy=$i(),Qy=Ii(),eb=Da(),tb=Hl(),rb=sn(),nb=rt(),ib=on(),sb=ud(),ab=ld(),ob=fd(),ub=md(),cb=_d(),lb=ki(),db=Ed(),fb=Td(),pb=Id(),hb=Pd(),mb=Ld();Dd.exports={parse:Ny,valid:Cy,clean:jy,inc:Ly,diff:zy,major:My,minor:Dy,patch:Uy,prerelease:Zy,compare:Fy,rcompare:By,compareLoose:Gy,compareBuild:qy,sort:Vy,rsort:Hy,gt:Jy,lt:Wy,eq:Ky,neq:Yy,gte:Xy,lte:Qy,cmp:eb,coerce:tb,Comparator:rb,Range:nb,satisfies:ib,toComparators:sb,maxSatisfying:ab,minSatisfying:ob,minVersion:ub,validRange:cb,outside:lb,gtr:db,ltr:fb,intersects:pb,simplifyRange:hb,subset:mb,SemVer:Ry,re:Ka.re,src:Ka.src,tokens:Ka.t,SEMVER_SPEC_VERSION:zd.SEMVER_SPEC_VERSION,RELEASE_TYPES:zd.RELEASE_TYPES,compareIdentifiers:Md.compareIdentifiers,rcompareIdentifiers:Md.rcompareIdentifiers}});var lf=j((pO,cf)=>{"use strict";var of=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,uf=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function Zb(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[i,s]of Object.entries(n))e[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},n[i]=e[i],r.set(s[0],s[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=of(),e.color.ansi16m=uf(),e.bgColor.ansi256=of(10),e.bgColor.ansi16m=uf(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,i)=>t===n&&n===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:i}=n.groups;i.length===3&&(i=i.split("").map(a=>a+a).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(cf,"exports",{enumerable:!0,get:Zb})});var ph={};we(ph,{BasePromptValue:()=>mr,ChatPromptValue:()=>Ns,ImagePromptValue:()=>Cs,StringPromptValue:()=>Gr});var oh={};we(oh,{Serializable:()=>Ke,get_lc_unique_name:()=>Pn});var du=gt(nu(),1),fu=gt(lu(),1);function pu(r,e){return e?.[r]||(0,du.default)(r)}function tx(r,e){return e?.[r]||(0,fu.default)(r)}function hu(r,e,t){let n={};for(let i in r)Object.hasOwn(r,i)&&(n[e(i,t)]=r[i]);return n}function mu(r){return Array.isArray(r)?[...r]:l({},r)}function ah(r,e){let t=mu(r);for(let[n,i]of Object.entries(e)){let[s,...a]=n.split(".").reverse(),o=t;for(let u of a.reverse()){if(o[u]===void 0)break;o[u]=mu(o[u]),o=o[u]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[i]})}return t}function Pn(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Ke=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Pn(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((i,s)=>(i[s]=s in this?this[s]:this.lc_kwargs[s],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(n,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let s=this,a=n,[o,...u]=i.split(".").reverse();for(let c of u.reverse()){if(!(c in s)||s[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof s[c]=="object"&&s[c]!=null?a[c]={}:Array.isArray(s[c])&&(a[c]=[])),s=s[c],a=a[c]}o in s&&s[o]!==void 0&&(a[o]=a[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:hu(Object.keys(t).length?ah(n,t):n,pu,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Ct(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function sx(r){return Ct(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function ax(r){return Ct(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function ox(r){return Ct(r)&&r.source_type==="text"&&"text"in r&&typeof r.text=="string"}function ux(r){return Ct(r)&&r.source_type==="id"&&"id"in r&&typeof r.id=="string"}function cx(r){if(Ct(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function lx(r){let e=r.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${r}" - does not match type/subtype format.`);let t=e[0].trim(),n=e[1].trim();if(t===""||n==="")throw new Error(`Invalid mime type: "${r}" - type or subtype is empty.`);let i={};for(let s of r.split(";").slice(1)){let a=s.split("=");if(a.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${r}".`);let o=a[0].trim(),u=a[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${r}".`);i[o]=u}return{type:t,subtype:n,parameters:i}}function dx({dataUrl:r,asTypedArray:e=!1}){let t=r.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/),n;if(t){n=t[1].toLowerCase();let i=e?Uint8Array.from(atob(t[2]),s=>s.charCodeAt(0)):t[2];return{mime_type:n,data:i}}}function fx(r,e){if(r.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(r)}if(r.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(r)}if(r.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(r)}if(r.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(r)}throw new Error(`Unable to convert content block type '${r.type}' to provider-specific format: not recognized.`)}function Ye(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>Ct(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?Zr(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Ct(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function gu(r,e){return r==="error"||e==="error"?"error":"success"}function uh(r,e){function t(n,i){if(typeof n!="object"||n===null||n===void 0)return n;if(i>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,i+1));let s={};for(let a of Object.keys(n))s[a]=t(n[a],i+1);return s}return JSON.stringify(t(r,0),null,2)}var Pe=class extends Ke{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=uh(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function gx(r){return Array.isArray(r)&&r.every(e=>typeof e.index=="number")}function le(r,e){let t=l({},r);for(let[n,i]of Object.entries(e))if(t[n]==null)t[n]=i;else{if(i==null)continue;if(typeof t[n]!=typeof i||Array.isArray(t[n])!==Array.isArray(i))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=i}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=le(t[n],i);else if(Array.isArray(t[n]))t[n]=Zr(t[n],i);else{if(t[n]===i)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function Zr(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{let t=[...r];for(let n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){let i=t.findIndex(s=>s.index===n.index);i!==-1?t[i]=le(t[i],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function _u(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return Zr(r,e);if(typeof r=="object"&&typeof e=="object")return le(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var De=class extends Pe{};function yu(r){return typeof r.role=="string"}function Ps(r){return typeof r?._getType=="function"}function _x(r){return Ps(r)&&typeof r.concat=="function"}var It=class extends Pe{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}},kn=class r extends De{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new r({content:Ye(this.content,e.content),additional_kwargs:le(this.additional_kwargs,e.additional_kwargs),response_metadata:le(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function vx(r){return r.getType()==="human"}function xx(r){return r.getType()==="human"}function Rn(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Cn(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}function Tx(r){return!!(r&&typeof r=="object"&&"toolCall"in r&&r.toolCall!=null&&typeof r.toolCall=="object"&&"id"in r.toolCall&&typeof r.toolCall.id=="string")}var Nn=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};function $x(r,e=ks){r=r.trim();let t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));let i=n.indexOf("```"),s=n;return i!==-1&&(s=n.substring(0,i)),e(s.trim())}function ks(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="",t=[],n=!1,i=!1;for(let s of r){if(n)s==='"'&&!i?n=!1:s===`
`&&!i?s="\\n":s==="\\"?i=!i:i=!1;else if(s==='"')n=!0,i=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}n&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}function Px(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var Fr=class extends Pe{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return m(l({},super._printableFields),{tool_call_id:this.tool_call_id,artifact:this.artifact})}},bu=class r extends De{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:Ye(this.content,e.content),additional_kwargs:le(this.additional_kwargs,e.additional_kwargs),response_metadata:le(this.response_metadata,e.response_metadata),artifact:_u(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:gu(this.status,e.status)})}get _printableFields(){return m(l({},super._printableFields),{tool_call_id:this.tool_call_id,artifact:this.artifact})}};function wu(r){let e=[],t=[];for(let n of r)if(n.function){let i=n.function.name;try{let s=JSON.parse(n.function.arguments),a={name:i||"",args:s||{},id:n.id};e.push(a)}catch{t.push({name:i,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}function kx(r){return r._getType()==="tool"}function Rx(r){return r._getType()==="tool"}var pr=class extends Pe{get lc_aliases(){return m(l({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"})}constructor(e,t){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;let i=n.additional_kwargs?.tool_calls,s=n.tool_calls;i!=null&&i.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&s===void 0){let[a,o]=wu(i);n.tool_calls=a??[],n.invalid_tool_calls=o??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return m(l({},super._printableFields),{tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata})}};function Mx(r){return r._getType()==="ai"}function Dx(r){return r._getType()==="ai"}var jt=class r extends De{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t=m(l({},e),{tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0});else{let n=e.tool_call_chunks.reduce((a,o)=>(o.id&&(a[o.id]=a[o.id]??[],a[o.id].push(o)),a),{}),i=[],s=[];for(let[a,o]of Object.entries(n)){let u={},c=o[0]?.name??"",d=o.map(h=>h.args||"").join(""),p=d.length?d:"{}";try{if(u=ks(p),u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");i.push({name:c,args:u,id:a,type:"tool_call"})}catch{s.push({name:c,args:p,id:a,error:"Malformed args.",type:"invalid_tool_call"})}}t=m(l({},e),{tool_calls:i,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0})}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return m(l({},super.lc_aliases),{tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"})}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return m(l({},super._printableFields),{tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata})}concat(e){let t={content:Ye(this.content,e.content),additional_kwargs:le(this.additional_kwargs,e.additional_kwargs),response_metadata:le(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=Zr(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(t.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let n=l(l(l({},(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)}),(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)}),(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}),i=l(l({},(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)}),(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}),s=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},o=l(l({input_tokens:s.input_tokens+a.input_tokens,output_tokens:s.output_tokens+a.output_tokens,total_tokens:s.total_tokens+a.total_tokens},Object.keys(n).length>0&&{input_token_details:n}),Object.keys(i).length>0&&{output_token_details:i});t.usage_metadata=o}return new r(t)}};var Br=class r extends Pe{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return m(l({},super._printableFields),{role:this.role})}},jn=class r extends De{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:Ye(this.content,e.content),additional_kwargs:le(this.additional_kwargs,e.additional_kwargs),response_metadata:le(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return m(l({},super._printableFields),{role:this.role})}};function Bx(r){return r._getType()==="generic"}function Gx(r){return r._getType()==="generic"}var Ln=class extends Pe{static lc_name(){return"FunctionMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,name:t}),super(e)}_getType(){return"function"}},zn=class r extends De{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new r({content:Ye(this.content,e.content),additional_kwargs:le(this.additional_kwargs,e.additional_kwargs),response_metadata:le(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function Jx(r){return r._getType()==="function"}function Wx(r){return r._getType()==="function"}var hr=class extends Pe{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}},Mn=class r extends De{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new r({content:Ye(this.content,e.content),additional_kwargs:le(this.additional_kwargs,e.additional_kwargs),response_metadata:le(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function Xx(r){return r._getType()==="system"}function Qx(r){return r._getType()==="system"}function ch(r){return Cn(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function lh(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Rs(r){let e,t;if(lh(r)){let s=r.id.at(-1);s==="HumanMessage"||s==="HumanMessageChunk"?e="user":s==="AIMessage"||s==="AIMessageChunk"?e="assistant":s==="SystemMessage"||s==="SystemMessageChunk"?e="system":s==="FunctionMessage"||s==="FunctionMessageChunk"?e="function":s==="ToolMessage"||s==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{let n=r,{type:s}=n,a=se(n,["type"]);e=s,t=a}if(e==="human"||e==="user")return new It(t);if(e==="ai"||e==="assistant"){let i=t,{tool_calls:s}=i,a=se(i,["tool_calls"]);if(!Array.isArray(s))return new pr(t);let o=s.map(ch);return new pr(m(l({},a),{tool_calls:o}))}else{if(e==="system")return new hr(t);if(e==="developer")return new hr(m(l({},t),{additional_kwargs:m(l({},t.additional_kwargs),{__openai_role__:"developer"})}));if(e==="tool"&&"tool_call_id"in t)return new Fr(m(l({},t),{content:t.content,tool_call_id:t.tool_call_id,name:t.name}));throw Rn(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function lE(r){if(typeof r=="string")return new It(r);if(Ps(r))return r;if(Array.isArray(r)){let[t,n]=r;return Rs({type:t,content:n})}else if(yu(r)){let e=r,{role:t}=e,n=se(e,["role"]);return Rs(m(l({},n),{type:t}))}else return Rs(r)}function Dn(r,e="Human",t="AI"){let n=[];for(let i of r){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=t;else if(i._getType()==="system")s="System";else if(i._getType()==="function")s="Function";else if(i._getType()==="tool")s="Tool";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);let a=i.name?`${i.name}, `:"",o=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);n.push(`${s}: ${a}${o}`)}return n.join(`
`)}function dh(r){if(r.data!==void 0)return r;{let e=r;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function fh(r){let e=dh(r);switch(e.type){case"human":return new It(e.data);case"ai":return new pr(e.data);case"system":return new hr(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new Ln(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new Fr(e.data);case"generic":{if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Br(e.data)}default:throw new Error(`Got unexpected type: ${e.type}`)}}function dE(r){return r.map(fh)}function fE(r){return r.map(e=>e.toDict())}function pE(r){let e=r._getType();if(e==="human")return new kn(l({},r));if(e==="ai"){let t=l({},r);return"tool_calls"in t&&(t=m(l({},t),{tool_call_chunks:t.tool_calls?.map(n=>m(l({},n),{type:"tool_call_chunk",index:void 0,args:JSON.stringify(n.args)}))})),new jt(l({},t))}else{if(e==="system")return new Mn(l({},r));if(e==="function")return new zn(l({},r));if(Br.isInstance(r))return new jn(l({},r));throw new Error("Unknown message type.")}}var mr=class extends Ke{},Gr=class extends mr{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new It(this.value)]}},Ns=class extends mr{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Dn(this.messages)}toChatMessages(){return this.messages}},Cs=class extends mr{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new It({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}};var Mt={};we(Mt,{BRAND:()=>Dh,DIRTY:()=>Wt,EMPTY_PATH:()=>_h,INVALID:()=>D,NEVER:()=>Em,OK:()=>Oe,ParseStatus:()=>xe,Schema:()=>Y,ZodAny:()=>Fn,ZodArray:()=>Hr,ZodBigInt:()=>Ms,ZodBoolean:()=>Ds,ZodBranded:()=>Jr,ZodCatch:()=>Ws,ZodDate:()=>Us,ZodDefault:()=>Js,ZodDiscriminatedUnion:()=>Bn,ZodEffects:()=>vr,ZodEnum:()=>Hn,ZodError:()=>yt,ZodFirstPartyTypeKind:()=>S,ZodFunction:()=>qn,ZodIntersection:()=>Gs,ZodIssueCode:()=>E,ZodLazy:()=>qs,ZodLiteral:()=>Vs,ZodMap:()=>Pu,ZodNaN:()=>Nu,ZodNativeEnum:()=>Hs,ZodNever:()=>Kt,ZodNull:()=>Fs,ZodNullable:()=>xr,ZodNumber:()=>zs,ZodObject:()=>br,ZodOptional:()=>zt,ZodParsedType:()=>I,ZodPipeline:()=>Wr,ZodPromise:()=>Jn,ZodReadonly:()=>Ks,ZodRecord:()=>Gn,ZodSchema:()=>Y,ZodSet:()=>ku,ZodString:()=>Vn,ZodSymbol:()=>Iu,ZodTransformer:()=>vr,ZodTuple:()=>wr,ZodType:()=>Y,ZodUndefined:()=>Zs,ZodUnion:()=>Bs,ZodUnknown:()=>Vr,ZodVoid:()=>Au,addIssueToContext:()=>O,any:()=>Jh,array:()=>Xh,bigint:()=>Bh,boolean:()=>zu,coerce:()=>xm,custom:()=>Cu,date:()=>Gh,datetimeRegex:()=>$u,defaultErrorMap:()=>At,discriminatedUnion:()=>rm,effect:()=>hm,enum:()=>dm,function:()=>um,getErrorMap:()=>gr,getParsedType:()=>_t,instanceof:()=>Zh,intersection:()=>nm,isAborted:()=>Un,isAsync:()=>_r,isDirty:()=>Zn,isValid:()=>Lt,late:()=>Uh,lazy:()=>cm,literal:()=>lm,makeIssue:()=>qr,map:()=>am,nan:()=>Fh,nativeEnum:()=>fm,never:()=>Kh,null:()=>Hh,nullable:()=>gm,number:()=>Lu,object:()=>Qh,objectUtil:()=>vu,oboolean:()=>vm,onumber:()=>wm,optional:()=>mm,ostring:()=>bm,pipeline:()=>ym,preprocess:()=>_m,promise:()=>pm,quotelessJson:()=>hh,record:()=>sm,set:()=>om,setErrorMap:()=>gh,strictObject:()=>em,string:()=>ju,symbol:()=>qh,transformer:()=>hm,tuple:()=>im,undefined:()=>Vh,union:()=>tm,unknown:()=>Wh,util:()=>Q,void:()=>Yh});var Q;(function(r){r.assertEqual=i=>{};function e(i){}r.assertIs=e;function t(i){throw new Error}r.assertNever=t,r.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},r.getValidEnumValues=i=>{let s=r.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return r.objectValues(a)},r.objectValues=i=>r.objectKeys(i).map(function(s){return i[s]}),r.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},r.find=(i,s)=>{for(let a of i)if(s(a))return a},r.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Q||(Q={}));var vu=function(r){return r.mergeShapes=(e,t)=>l(l({},e),t),r}(vu||{}),I=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_t=r=>{switch(typeof r){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(r)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(r)?I.array:r===null?I.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?I.promise:typeof Map<"u"&&r instanceof Map?I.map:typeof Set<"u"&&r instanceof Set?I.set:typeof Date<"u"&&r instanceof Date?I.date:I.object;default:return I.unknown}};var E=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),hh=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),yt=(()=>{class r extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){let n=t||function(a){return a.message},i={_errors:[]},s=a=>{for(let o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)i._errors.push(n(o));else{let u=i,c=0;for(;c<o.path.length;){let d=o.path[c];c===o.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(n(o))):u[d]=u[d]||{_errors:[]},u=u[d],c++}}};return s(this),i}static assert(t){if(!(t instanceof r))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){let n={},i=[];for(let s of this.issues)if(s.path.length>0){let a=s.path[0];n[a]=n[a]||[],n[a].push(t(s))}else i.push(t(s));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}}return r.create=e=>new r(e),r})();var mh=(r,e)=>{let t;switch(r.code){case E.invalid_type:r.received===I.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case E.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,Q.jsonStringifyReplacer)}`;break;case E.unrecognized_keys:t=`Unrecognized key(s) in object: ${Q.joinValues(r.keys,", ")}`;break;case E.invalid_union:t="Invalid input";break;case E.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Q.joinValues(r.options)}`;break;case E.invalid_enum_value:t=`Invalid enum value. Expected ${Q.joinValues(r.options)}, received '${r.received}'`;break;case E.invalid_arguments:t="Invalid function arguments";break;case E.invalid_return_type:t="Invalid function return type";break;case E.invalid_date:t="Invalid date";break;case E.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:Q.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case E.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case E.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case E.custom:t="Invalid input";break;case E.invalid_intersection_types:t="Intersection results could not be merged";break;case E.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case E.not_finite:t="Number must be finite";break;default:t=e.defaultError,Q.assertNever(r)}return{message:t}},At=mh;var xu=At;function gh(r){xu=r}function gr(){return xu}var qr=r=>{let{data:e,path:t,errorMaps:n,issueData:i}=r,s=[...t,...i.path||[]],a=m(l({},i),{path:s});if(i.message!==void 0)return m(l({},i),{path:s,message:i.message});let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return m(l({},i),{path:s,message:o})},_h=[];function O(r,e){let t=gr(),n=qr({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===At?void 0:At].filter(i=>!!i)});r.common.issues.push(n)}var xe=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let i of t){if(i.status==="aborted")return D;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static mergeObjectAsync(e,t){return f(this,null,function*(){let n=[];for(let i of t){let s=yield i.key,a=yield i.value;n.push({key:s,value:a})}return r.mergeObjectSync(e,n)})}static mergeObjectSync(e,t){let n={};for(let i of t){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return D;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},D=Object.freeze({status:"aborted"}),Wt=r=>({status:"dirty",value:r}),Oe=r=>({status:"valid",value:r}),Un=r=>r.status==="aborted",Zn=r=>r.status==="dirty",Lt=r=>r.status==="valid",_r=r=>typeof Promise<"u"&&r instanceof Promise;var C=function(r){return r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message,r}(C||{});var Xe=class{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Eu=(r,e)=>{if(Lt(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new yt(r.common.issues);return this._error=t,this._error}}};function K(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:i}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:i}}var Y=class{get description(){return this._def.description}_getType(e){return _t(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:_t(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new xe,ctx:{common:e.parent.common,data:e.data,parsedType:_t(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(_r(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)},i=this._parseSync({data:e,path:n.path,parent:n});return Eu(n,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return Lt(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>Lt(n)?{value:n.value}:{issues:t.common.issues})}parseAsync(e,t){return f(this,null,function*(){let n=yield this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error})}safeParseAsync(e,t){return f(this,null,function*(){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)},i=this._parse({data:e,path:n.path,parent:n}),s=yield _r(i)?i:Promise.resolve(i);return Eu(n,s)})}refine(e,t){let n=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue(l({code:E.custom},n(i)));return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof t=="function"?t(n,i):t),!1))}_refinement(e){return new vr({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return zt.create(this,this._def)}nullable(){return xr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Hr.create(this)}promise(){return Jn.create(this,this._def)}or(e){return Bs.create([this,e],this._def)}and(e){return Gs.create(this,e,this._def)}transform(e){return new vr(m(l({},K(this._def)),{schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){let t=typeof e=="function"?e:()=>e;return new Js(m(l({},K(this._def)),{innerType:this,defaultValue:t,typeName:S.ZodDefault}))}brand(){return new Jr(l({typeName:S.ZodBranded,type:this},K(this._def)))}catch(e){let t=typeof e=="function"?e:()=>e;return new Ws(m(l({},K(this._def)),{innerType:this,catchValue:t,typeName:S.ZodCatch}))}describe(e){let t=this.constructor;return new t(m(l({},this._def),{description:e}))}pipe(e){return Wr.create(this,e)}readonly(){return Ks.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},yh=/^c[^\s-]{8,}$/i,bh=/^[0-9a-z]+$/,wh=/^[0-9A-HJKMNP-TV-Z]{26}$/i,vh=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,xh=/^[a-z0-9_-]{21}$/i,Eh=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Sh=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Th=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Oh="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",js,$h=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ih=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ah=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ph=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,kh=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Rh=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Tu="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Nh=new RegExp(`^${Tu}$`);function Ou(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Ch(r){return new RegExp(`^${Ou(r)}$`)}function $u(r){let e=`${Tu}T${Ou(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function jh(r,e){return!!((e==="v4"||!e)&&$h.test(r)||(e==="v6"||!e)&&Ah.test(r))}function Lh(r,e){if(!Eh.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function zh(r,e){return!!((e==="v4"||!e)&&Ih.test(r)||(e==="v6"||!e)&&Ph.test(r))}var Vn=(()=>{class r extends Y{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==I.string){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_type,expected:I.string,received:a.parsedType}),D}let i=new xe,s;for(let a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),i.dirty());else if(a.kind==="max")t.data.length>a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),i.dirty());else if(a.kind==="length"){let o=t.data.length>a.value,u=t.data.length<a.value;(o||u)&&(s=this._getOrReturnCtx(t,s),o?O(s,{code:E.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):u&&O(s,{code:E.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),i.dirty())}else if(a.kind==="email")Th.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"email",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="emoji")js||(js=new RegExp(Oh,"u")),js.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"emoji",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="uuid")vh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"uuid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="nanoid")xh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"nanoid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="cuid")yh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"cuid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="cuid2")bh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"cuid2",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="ulid")wh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"ulid",code:E.invalid_string,message:a.message}),i.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),O(s,{validation:"url",code:E.invalid_string,message:a.message}),i.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"regex",code:E.invalid_string,message:a.message}),i.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),i.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:{startsWith:a.value},message:a.message}),i.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:{endsWith:a.value},message:a.message}),i.dirty()):a.kind==="datetime"?$u(a).test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:"datetime",message:a.message}),i.dirty()):a.kind==="date"?Nh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:"date",message:a.message}),i.dirty()):a.kind==="time"?Ch(a).test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{code:E.invalid_string,validation:"time",message:a.message}),i.dirty()):a.kind==="duration"?Sh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"duration",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="ip"?jh(t.data,a.version)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"ip",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="jwt"?Lh(t.data,a.alg)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"jwt",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="cidr"?zh(t.data,a.version)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"cidr",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="base64"?kh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"base64",code:E.invalid_string,message:a.message}),i.dirty()):a.kind==="base64url"?Rh.test(t.data)||(s=this._getOrReturnCtx(t,s),O(s,{validation:"base64url",code:E.invalid_string,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:t.data}}_regex(t,n,i){return this.refinement(s=>t.test(s),l({validation:n,code:E.invalid_string},C.errToObj(i)))}_addCheck(t){return new r(m(l({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(l({kind:"email"},C.errToObj(t)))}url(t){return this._addCheck(l({kind:"url"},C.errToObj(t)))}emoji(t){return this._addCheck(l({kind:"emoji"},C.errToObj(t)))}uuid(t){return this._addCheck(l({kind:"uuid"},C.errToObj(t)))}nanoid(t){return this._addCheck(l({kind:"nanoid"},C.errToObj(t)))}cuid(t){return this._addCheck(l({kind:"cuid"},C.errToObj(t)))}cuid2(t){return this._addCheck(l({kind:"cuid2"},C.errToObj(t)))}ulid(t){return this._addCheck(l({kind:"ulid"},C.errToObj(t)))}base64(t){return this._addCheck(l({kind:"base64"},C.errToObj(t)))}base64url(t){return this._addCheck(l({kind:"base64url"},C.errToObj(t)))}jwt(t){return this._addCheck(l({kind:"jwt"},C.errToObj(t)))}ip(t){return this._addCheck(l({kind:"ip"},C.errToObj(t)))}cidr(t){return this._addCheck(l({kind:"cidr"},C.errToObj(t)))}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(l({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1},C.errToObj(t?.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(l({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision},C.errToObj(t?.message)))}duration(t){return this._addCheck(l({kind:"duration"},C.errToObj(t)))}regex(t,n){return this._addCheck(l({kind:"regex",regex:t},C.errToObj(n)))}includes(t,n){return this._addCheck(l({kind:"includes",value:t,position:n?.position},C.errToObj(n?.message)))}startsWith(t,n){return this._addCheck(l({kind:"startsWith",value:t},C.errToObj(n)))}endsWith(t,n){return this._addCheck(l({kind:"endsWith",value:t},C.errToObj(n)))}min(t,n){return this._addCheck(l({kind:"min",value:t},C.errToObj(n)))}max(t,n){return this._addCheck(l({kind:"max",value:t},C.errToObj(n)))}length(t,n){return this._addCheck(l({kind:"length",value:t},C.errToObj(n)))}nonempty(t){return this.min(1,C.errToObj(t))}trim(){return new r(m(l({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new r(m(l({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new r(m(l({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}return r.create=e=>new r(l({checks:[],typeName:S.ZodString,coerce:e?.coerce??!1},K(e))),r})();function Mh(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,s=Number.parseInt(r.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}var zs=(()=>{class r extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==I.number){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_type,expected:I.number,received:a.parsedType}),D}let i,s=new xe;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(t.data)||(i=this._getOrReturnCtx(t,i),O(i,{code:E.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Mh(t.data,a.value)!==0&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(i=this._getOrReturnCtx(t,i),O(i,{code:E.not_finite,message:a.message}),s.dirty()):Q.assertNever(a);return{status:s.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,C.toString(n))}gt(t,n){return this.setLimit("min",t,!1,C.toString(n))}lte(t,n){return this.setLimit("max",t,!0,C.toString(n))}lt(t,n){return this.setLimit("max",t,!1,C.toString(n))}setLimit(t,n,i,s){return new r(m(l({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:i,message:C.toString(s)}]}))}_addCheck(t){return new r(m(l({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:C.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:C.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:C.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(t)})}get minValue(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Q.isInteger(t.value))}get isFinite(){let t=null,n=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(n)&&Number.isFinite(t)}}return r.create=e=>new r(l({checks:[],typeName:S.ZodNumber,coerce:e?.coerce||!1},K(e))),r})(),Ms=(()=>{class r extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==I.bigint)return this._getInvalidInput(t);let i,s=new xe;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(i=this._getOrReturnCtx(t,i),O(i,{code:E.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Q.assertNever(a);return{status:s.value,value:t.data}}_getInvalidInput(t){let n=this._getOrReturnCtx(t);return O(n,{code:E.invalid_type,expected:I.bigint,received:n.parsedType}),D}gte(t,n){return this.setLimit("min",t,!0,C.toString(n))}gt(t,n){return this.setLimit("min",t,!1,C.toString(n))}lte(t,n){return this.setLimit("max",t,!0,C.toString(n))}lt(t,n){return this.setLimit("max",t,!1,C.toString(n))}setLimit(t,n,i,s){return new r(m(l({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:i,message:C.toString(s)}]}))}_addCheck(t){return new r(m(l({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:C.toString(n)})}get minValue(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}return r.create=e=>new r(l({checks:[],typeName:S.ZodBigInt,coerce:e?.coerce??!1},K(e))),r})(),Ds=(()=>{class r extends Y{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==I.boolean){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.boolean,received:i.parsedType}),D}return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodBoolean,coerce:e?.coerce||!1},K(e))),r})(),Us=(()=>{class r extends Y{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==I.date){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_type,expected:I.date,received:a.parsedType}),D}if(Number.isNaN(t.data.getTime())){let a=this._getOrReturnCtx(t);return O(a,{code:E.invalid_date}),D}let i=new xe,s;for(let a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),i.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(s=this._getOrReturnCtx(t,s),O(s,{code:E.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),i.dirty()):Q.assertNever(a);return{status:i.value,value:new Date(t.data.getTime())}}_addCheck(t){return new r(m(l({},this._def),{checks:[...this._def.checks,t]}))}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:C.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:C.toString(n)})}get minDate(){let t=null;for(let n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}return r.create=e=>new r(l({checks:[],coerce:e?.coerce||!1,typeName:S.ZodDate},K(e))),r})(),Iu=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.symbol){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.symbol,received:i.parsedType}),D}return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodSymbol},K(e))),r})(),Zs=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.undefined){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.undefined,received:i.parsedType}),D}return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodUndefined},K(e))),r})(),Fs=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.null){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.null,received:i.parsedType}),D}return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodNull},K(e))),r})(),Fn=(()=>{class r extends Y{constructor(){super(...arguments),this._any=!0}_parse(t){return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodAny},K(e))),r})(),Vr=(()=>{class r extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodUnknown},K(e))),r})(),Kt=(()=>{class r extends Y{_parse(t){let n=this._getOrReturnCtx(t);return O(n,{code:E.invalid_type,expected:I.never,received:n.parsedType}),D}}return r.create=e=>new r(l({typeName:S.ZodNever},K(e))),r})(),Au=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.undefined){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.void,received:i.parsedType}),D}return Oe(t.data)}}return r.create=e=>new r(l({typeName:S.ZodVoid},K(e))),r})(),Hr=(()=>{class r extends Y{_parse(t){let{ctx:n,status:i}=this._processInputParams(t),s=this._def;if(n.parsedType!==I.array)return O(n,{code:E.invalid_type,expected:I.array,received:n.parsedType}),D;if(s.exactLength!==null){let o=n.data.length>s.exactLength.value,u=n.data.length<s.exactLength.value;(o||u)&&(O(n,{code:o?E.too_big:E.too_small,minimum:u?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),i.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(O(n,{code:E.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),i.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(O(n,{code:E.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((o,u)=>s.type._parseAsync(new Xe(n,o,n.path,u)))).then(o=>xe.mergeArray(i,o));let a=[...n.data].map((o,u)=>s.type._parseSync(new Xe(n,o,n.path,u)));return xe.mergeArray(i,a)}get element(){return this._def.type}min(t,n){return new r(m(l({},this._def),{minLength:{value:t,message:C.toString(n)}}))}max(t,n){return new r(m(l({},this._def),{maxLength:{value:t,message:C.toString(n)}}))}length(t,n){return new r(m(l({},this._def),{exactLength:{value:t,message:C.toString(n)}}))}nonempty(t){return this.min(1,t)}}return r.create=(e,t)=>new r(l({type:e,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray},K(t))),r})();function yr(r){if(r instanceof br){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=zt.create(yr(n))}return new br(m(l({},r._def),{shape:()=>e}))}else return r instanceof Hr?new Hr(m(l({},r._def),{type:yr(r.element)})):r instanceof zt?zt.create(yr(r.unwrap())):r instanceof xr?xr.create(yr(r.unwrap())):r instanceof wr?wr.create(r.items.map(e=>yr(e))):r}var br=(()=>{class r extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),n=Q.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==I.object){let d=this._getOrReturnCtx(t);return O(d,{code:E.invalid_type,expected:I.object,received:d.parsedType}),D}let{status:i,ctx:s}=this._processInputParams(t),{shape:a,keys:o}=this._getCached(),u=[];if(!(this._def.catchall instanceof Kt&&this._def.unknownKeys==="strip"))for(let d in s.data)o.includes(d)||u.push(d);let c=[];for(let d of o){let p=a[d],h=s.data[d];c.push({key:{status:"valid",value:d},value:p._parse(new Xe(s,h,s.path,d)),alwaysSet:d in s.data})}if(this._def.catchall instanceof Kt){let d=this._def.unknownKeys;if(d==="passthrough")for(let p of u)c.push({key:{status:"valid",value:p},value:{status:"valid",value:s.data[p]}});else if(d==="strict")u.length>0&&(O(s,{code:E.unrecognized_keys,keys:u}),i.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let p of u){let h=s.data[p];c.push({key:{status:"valid",value:p},value:d._parse(new Xe(s,h,s.path,p)),alwaysSet:p in s.data})}}return s.common.async?Promise.resolve().then(()=>f(this,null,function*(){let d=[];for(let p of c){let h=yield p.key,g=yield p.value;d.push({key:h,value:g,alwaysSet:p.alwaysSet})}return d})).then(d=>xe.mergeObjectSync(i,d)):xe.mergeObjectSync(i,c)}get shape(){return this._def.shape()}strict(t){return C.errToObj,new r(l(m(l({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(n,i)=>{let s=this._def.errorMap?.(n,i).message??i.defaultError;return n.code==="unrecognized_keys"?{message:C.errToObj(t).message??s}:{message:s}}}:{}))}strip(){return new r(m(l({},this._def),{unknownKeys:"strip"}))}passthrough(){return new r(m(l({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new r(m(l({},this._def),{shape:()=>l(l({},this._def.shape()),t)}))}merge(t){return new r({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>l(l({},this._def.shape()),t._def.shape()),typeName:S.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new r(m(l({},this._def),{catchall:t}))}pick(t){let n={};for(let i of Q.objectKeys(t))t[i]&&this.shape[i]&&(n[i]=this.shape[i]);return new r(m(l({},this._def),{shape:()=>n}))}omit(t){let n={};for(let i of Q.objectKeys(this.shape))t[i]||(n[i]=this.shape[i]);return new r(m(l({},this._def),{shape:()=>n}))}deepPartial(){return yr(this)}partial(t){let n={};for(let i of Q.objectKeys(this.shape)){let s=this.shape[i];t&&!t[i]?n[i]=s:n[i]=s.optional()}return new r(m(l({},this._def),{shape:()=>n}))}required(t){let n={};for(let i of Q.objectKeys(this.shape))if(t&&!t[i])n[i]=this.shape[i];else{let a=this.shape[i];for(;a instanceof zt;)a=a._def.innerType;n[i]=a}return new r(m(l({},this._def),{shape:()=>n}))}keyof(){return Ru(Q.objectKeys(this.shape))}}return r.create=(e,t)=>new r(l({shape:()=>e,unknownKeys:"strip",catchall:Kt.create(),typeName:S.ZodObject},K(t))),r.strictCreate=(e,t)=>new r(l({shape:()=>e,unknownKeys:"strict",catchall:Kt.create(),typeName:S.ZodObject},K(t))),r.lazycreate=(e,t)=>new r(l({shape:e,unknownKeys:"strip",catchall:Kt.create(),typeName:S.ZodObject},K(t))),r})(),Bs=(()=>{class r extends Y{_parse(t){let{ctx:n}=this._processInputParams(t),i=this._def.options;function s(a){for(let u of a)if(u.result.status==="valid")return u.result;for(let u of a)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;let o=a.map(u=>new yt(u.ctx.common.issues));return O(n,{code:E.invalid_union,unionErrors:o}),D}if(n.common.async)return Promise.all(i.map(a=>f(this,null,function*(){let o=m(l({},n),{common:m(l({},n.common),{issues:[]}),parent:null});return{result:yield a._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}}))).then(s);{let a,o=[];for(let c of i){let d=m(l({},n),{common:m(l({},n.common),{issues:[]}),parent:null}),p=c._parseSync({data:n.data,path:n.path,parent:d});if(p.status==="valid")return p;p.status==="dirty"&&!a&&(a={result:p,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;let u=o.map(c=>new yt(c));return O(n,{code:E.invalid_union,unionErrors:u}),D}}get options(){return this._def.options}}return r.create=(e,t)=>new r(l({options:e,typeName:S.ZodUnion},K(t))),r})(),Pt=r=>r instanceof qs?Pt(r.schema):r instanceof vr?Pt(r.innerType()):r instanceof Vs?[r.value]:r instanceof Hn?r.options:r instanceof Hs?Q.objectValues(r.enum):r instanceof Js?Pt(r._def.innerType):r instanceof Zs?[void 0]:r instanceof Fs?[null]:r instanceof zt?[void 0,...Pt(r.unwrap())]:r instanceof xr?[null,...Pt(r.unwrap())]:r instanceof Jr||r instanceof Ks?Pt(r.unwrap()):r instanceof Ws?Pt(r._def.innerType):[],Bn=class r extends Y{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.object)return O(t,{code:E.invalid_type,expected:I.object,received:t.parsedType}),D;let n=this.discriminator,i=t.data[n],s=this.optionsMap.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(O(t,{code:E.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),D)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let i=new Map;for(let s of t){let a=Pt(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,s)}}return new r(l({typeName:S.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i},K(n)))}};function Ls(r,e){let t=_t(r),n=_t(e);if(r===e)return{valid:!0,data:r};if(t===I.object&&n===I.object){let i=Q.objectKeys(e),s=Q.objectKeys(r).filter(o=>i.indexOf(o)!==-1),a=l(l({},r),e);for(let o of s){let u=Ls(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===I.array&&n===I.array){if(r.length!==e.length)return{valid:!1};let i=[];for(let s=0;s<r.length;s++){let a=r[s],o=e[s],u=Ls(a,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===I.date&&n===I.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Gs=(()=>{class r extends Y{_parse(t){let{status:n,ctx:i}=this._processInputParams(t),s=(a,o)=>{if(Un(a)||Un(o))return D;let u=Ls(a.value,o.value);return u.valid?((Zn(a)||Zn(o))&&n.dirty(),{status:n.value,value:u.data}):(O(i,{code:E.invalid_intersection_types}),D)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([a,o])=>s(a,o)):s(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}return r.create=(e,t,n)=>new r(l({left:e,right:t,typeName:S.ZodIntersection},K(n))),r})(),wr=(()=>{class r extends Y{_parse(t){let{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==I.array)return O(i,{code:E.invalid_type,expected:I.array,received:i.parsedType}),D;if(i.data.length<this._def.items.length)return O(i,{code:E.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),D;!this._def.rest&&i.data.length>this._def.items.length&&(O(i,{code:E.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let a=[...i.data].map((o,u)=>{let c=this._def.items[u]||this._def.rest;return c?c._parse(new Xe(i,o,i.path,u)):null}).filter(o=>!!o);return i.common.async?Promise.all(a).then(o=>xe.mergeArray(n,o)):xe.mergeArray(n,a)}get items(){return this._def.items}rest(t){return new r(m(l({},this._def),{rest:t}))}}return r.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new r(l({items:e,typeName:S.ZodTuple,rest:null},K(t)))},r})(),Gn=class r extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.object)return O(n,{code:E.invalid_type,expected:I.object,received:n.parsedType}),D;let i=[],s=this._def.keyType,a=this._def.valueType;for(let o in n.data)i.push({key:s._parse(new Xe(n,o,n.path,o)),value:a._parse(new Xe(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?xe.mergeObjectAsync(t,i):xe.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Y?new r(l({keyType:e,valueType:t,typeName:S.ZodRecord},K(n))):new r(l({keyType:Vn.create(),valueType:e,typeName:S.ZodRecord},K(t)))}},Pu=(()=>{class r extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==I.map)return O(i,{code:E.invalid_type,expected:I.map,received:i.parsedType}),D;let s=this._def.keyType,a=this._def.valueType,o=[...i.data.entries()].map(([u,c],d)=>({key:s._parse(new Xe(i,u,i.path,[d,"key"])),value:a._parse(new Xe(i,c,i.path,[d,"value"]))}));if(i.common.async){let u=new Map;return Promise.resolve().then(()=>f(this,null,function*(){for(let c of o){let d=yield c.key,p=yield c.value;if(d.status==="aborted"||p.status==="aborted")return D;(d.status==="dirty"||p.status==="dirty")&&n.dirty(),u.set(d.value,p.value)}return{status:n.value,value:u}}))}else{let u=new Map;for(let c of o){let d=c.key,p=c.value;if(d.status==="aborted"||p.status==="aborted")return D;(d.status==="dirty"||p.status==="dirty")&&n.dirty(),u.set(d.value,p.value)}return{status:n.value,value:u}}}}return r.create=(e,t,n)=>new r(l({valueType:t,keyType:e,typeName:S.ZodMap},K(n))),r})(),ku=(()=>{class r extends Y{_parse(t){let{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==I.set)return O(i,{code:E.invalid_type,expected:I.set,received:i.parsedType}),D;let s=this._def;s.minSize!==null&&i.data.size<s.minSize.value&&(O(i,{code:E.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&i.data.size>s.maxSize.value&&(O(i,{code:E.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());let a=this._def.valueType;function o(c){let d=new Set;for(let p of c){if(p.status==="aborted")return D;p.status==="dirty"&&n.dirty(),d.add(p.value)}return{status:n.value,value:d}}let u=[...i.data.values()].map((c,d)=>a._parse(new Xe(i,c,i.path,d)));return i.common.async?Promise.all(u).then(c=>o(c)):o(u)}min(t,n){return new r(m(l({},this._def),{minSize:{value:t,message:C.toString(n)}}))}max(t,n){return new r(m(l({},this._def),{maxSize:{value:t,message:C.toString(n)}}))}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}return r.create=(e,t)=>new r(l({valueType:e,minSize:null,maxSize:null,typeName:S.ZodSet},K(t))),r})(),qn=class r extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.function)return O(t,{code:E.invalid_type,expected:I.function,received:t.parsedType}),D;function n(o,u){return qr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,gr(),At].filter(c=>!!c),issueData:{code:E.invalid_arguments,argumentsError:u}})}function i(o,u){return qr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,gr(),At].filter(c=>!!c),issueData:{code:E.invalid_return_type,returnTypeError:u}})}let s={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Jn){let o=this;return Oe(function(...u){return f(this,null,function*(){let c=new yt([]),d=yield o._def.args.parseAsync(u,s).catch(g=>{throw c.addIssue(n(u,g)),c}),p=yield Reflect.apply(a,this,d);return yield o._def.returns._def.type.parseAsync(p,s).catch(g=>{throw c.addIssue(i(p,g)),c})})})}else{let o=this;return Oe(function(...u){let c=o._def.args.safeParse(u,s);if(!c.success)throw new yt([n(u,c.error)]);let d=Reflect.apply(a,this,c.data),p=o._def.returns.safeParse(d,s);if(!p.success)throw new yt([i(d,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r(m(l({},this._def),{args:wr.create(e).rest(Vr.create())}))}returns(e){return new r(m(l({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r(l({args:e||wr.create([]).rest(Vr.create()),returns:t||Vr.create(),typeName:S.ZodFunction},K(n)))}},qs=(()=>{class r extends Y{get schema(){return this._def.getter()}_parse(t){let{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}return r.create=(e,t)=>new r(l({getter:e,typeName:S.ZodLazy},K(t))),r})(),Vs=(()=>{class r extends Y{_parse(t){if(t.data!==this._def.value){let n=this._getOrReturnCtx(t);return O(n,{received:n.data,code:E.invalid_literal,expected:this._def.value}),D}return{status:"valid",value:t.data}}get value(){return this._def.value}}return r.create=(e,t)=>new r(l({value:e,typeName:S.ZodLiteral},K(t))),r})();function Ru(r,e){return new Hn(l({values:r,typeName:S.ZodEnum},K(e)))}var Hn=(()=>{class r extends Y{_parse(t){if(typeof t.data!="string"){let n=this._getOrReturnCtx(t),i=this._def.values;return O(n,{expected:Q.joinValues(i),received:n.parsedType,code:E.invalid_type}),D}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){let n=this._getOrReturnCtx(t),i=this._def.values;return O(n,{received:n.data,code:E.invalid_enum_value,options:i}),D}return Oe(t.data)}get options(){return this._def.values}get enum(){let t={};for(let n of this._def.values)t[n]=n;return t}get Values(){let t={};for(let n of this._def.values)t[n]=n;return t}get Enum(){let t={};for(let n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return r.create(t,l(l({},this._def),n))}exclude(t,n=this._def){return r.create(this.options.filter(i=>!t.includes(i)),l(l({},this._def),n))}}return r.create=Ru,r})(),Hs=(()=>{class r extends Y{_parse(t){let n=Q.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==I.string&&i.parsedType!==I.number){let s=Q.objectValues(n);return O(i,{expected:Q.joinValues(s),received:i.parsedType,code:E.invalid_type}),D}if(this._cache||(this._cache=new Set(Q.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let s=Q.objectValues(n);return O(i,{received:i.data,code:E.invalid_enum_value,options:s}),D}return Oe(t.data)}get enum(){return this._def.values}}return r.create=(e,t)=>new r(l({values:e,typeName:S.ZodNativeEnum},K(t))),r})(),Jn=(()=>{class r extends Y{unwrap(){return this._def.type}_parse(t){let{ctx:n}=this._processInputParams(t);if(n.parsedType!==I.promise&&n.common.async===!1)return O(n,{code:E.invalid_type,expected:I.promise,received:n.parsedType}),D;let i=n.parsedType===I.promise?n.data:Promise.resolve(n.data);return Oe(i.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}return r.create=(e,t)=>new r(l({type:e,typeName:S.ZodPromise},K(t))),r})(),vr=(()=>{class r extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:n,ctx:i}=this._processInputParams(t),s=this._def.effect||null,a={addIssue:o=>{O(i,o),o.fatal?n.abort():n.dirty()},get path(){return i.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){let o=s.transform(i.data,a);if(i.common.async)return Promise.resolve(o).then(u=>f(this,null,function*(){if(n.value==="aborted")return D;let c=yield this._def.schema._parseAsync({data:u,path:i.path,parent:i});return c.status==="aborted"?D:c.status==="dirty"?Wt(c.value):n.value==="dirty"?Wt(c.value):c}));{if(n.value==="aborted")return D;let u=this._def.schema._parseSync({data:o,path:i.path,parent:i});return u.status==="aborted"?D:u.status==="dirty"?Wt(u.value):n.value==="dirty"?Wt(u.value):u}}if(s.type==="refinement"){let o=u=>{let c=s.refinement(u,a);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(i.common.async===!1){let u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return u.status==="aborted"?D:(u.status==="dirty"&&n.dirty(),o(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>u.status==="aborted"?D:(u.status==="dirty"&&n.dirty(),o(u.value).then(()=>({status:n.value,value:u.value}))))}if(s.type==="transform")if(i.common.async===!1){let o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Lt(o))return D;let u=s.transform(o.value,a);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>Lt(o)?Promise.resolve(s.transform(o.value,a)).then(u=>({status:n.value,value:u})):D);Q.assertNever(s)}}return r.create=(e,t,n)=>new r(l({schema:e,typeName:S.ZodEffects,effect:t},K(n))),r.createWithPreprocess=(e,t,n)=>new r(l({schema:t,effect:{type:"preprocess",transform:e},typeName:S.ZodEffects},K(n))),r})();var zt=(()=>{class r extends Y{_parse(t){return this._getType(t)===I.undefined?Oe(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodOptional},K(t))),r})(),xr=(()=>{class r extends Y{_parse(t){return this._getType(t)===I.null?Oe(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodNullable},K(t))),r})(),Js=(()=>{class r extends Y{_parse(t){let{ctx:n}=this._processInputParams(t),i=n.data;return n.parsedType===I.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},K(t))),r})(),Ws=(()=>{class r extends Y{_parse(t){let{ctx:n}=this._processInputParams(t),i=m(l({},n),{common:m(l({},n.common),{issues:[]})}),s=this._def.innerType._parse({data:i.data,path:i.path,parent:l({},i)});return _r(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new yt(i.common.issues)},input:i.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new yt(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},K(t))),r})(),Nu=(()=>{class r extends Y{_parse(t){if(this._getType(t)!==I.nan){let i=this._getOrReturnCtx(t);return O(i,{code:E.invalid_type,expected:I.nan,received:i.parsedType}),D}return{status:"valid",value:t.data}}}return r.create=e=>new r(l({typeName:S.ZodNaN},K(e))),r})(),Dh=Symbol("zod_brand"),Jr=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Wr=class r extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return f(this,null,function*(){let s=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?D:s.status==="dirty"?(t.dirty(),Wt(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})});{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?D:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:S.ZodPipeline})}},Ks=(()=>{class r extends Y{_parse(t){let n=this._def.innerType._parse(t),i=s=>(Lt(s)&&(s.value=Object.freeze(s.value)),s);return _r(n)?n.then(s=>i(s)):i(n)}unwrap(){return this._def.innerType}}return r.create=(e,t)=>new r(l({innerType:e,typeName:S.ZodReadonly},K(t))),r})();function Su(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Cu(r,e={},t){return r?Fn.create().superRefine((n,i)=>{let s=r(n);if(s instanceof Promise)return s.then(a=>{if(!a){let o=Su(e,n),u=o.fatal??t??!0;i.addIssue(m(l({code:"custom"},o),{fatal:u}))}});if(!s){let a=Su(e,n),o=a.fatal??t??!0;i.addIssue(m(l({code:"custom"},a),{fatal:o}))}}):Fn.create()}var Uh={object:br.lazycreate},S=function(r){return r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly",r}(S||{});var Zh=(r,e={message:`Input not instance of ${r.name}`})=>Cu(t=>t instanceof r,e),ju=Vn.create,Lu=zs.create,Fh=Nu.create,Bh=Ms.create,zu=Ds.create,Gh=Us.create,qh=Iu.create,Vh=Zs.create,Hh=Fs.create,Jh=Fn.create,Wh=Vr.create,Kh=Kt.create,Yh=Au.create,Xh=Hr.create,Qh=br.create,em=br.strictCreate,tm=Bs.create,rm=Bn.create,nm=Gs.create,im=wr.create,sm=Gn.create,am=Pu.create,om=ku.create,um=qn.create,cm=qs.create,lm=Vs.create,dm=Hn.create,fm=Hs.create,pm=Jn.create,hm=vr.create,mm=zt.create,gm=xr.create,_m=vr.createWithPreprocess,ym=Wr.create,bm=()=>ju().optional(),wm=()=>Lu().optional(),vm=()=>zu().optional(),xm={string:r=>Vn.create(m(l({},r),{coerce:!0})),number:r=>zs.create(m(l({},r),{coerce:!0})),boolean:r=>Ds.create(m(l({},r),{coerce:!0})),bigint:r=>Ms.create(m(l({},r),{coerce:!0})),date:r=>Us.create(m(l({},r),{coerce:!0}))};var Em=D;var zo=gt(Yn(),1);var qu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Am(r){return typeof r=="string"&&qu.test(r)}var Dt=Am;function Pm(r){if(!Dt(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Xn=Pm;var Ee=[];for(Qn=0;Qn<256;++Qn)Ee.push((Qn+256).toString(16).slice(1));var Qn;function et(r,e=0){return(Ee[r[e+0]]+Ee[r[e+1]]+Ee[r[e+2]]+Ee[r[e+3]]+"-"+Ee[r[e+4]]+Ee[r[e+5]]+"-"+Ee[r[e+6]]+Ee[r[e+7]]+"-"+Ee[r[e+8]]+Ee[r[e+9]]+"-"+Ee[r[e+10]]+Ee[r[e+11]]+Ee[r[e+12]]+Ee[r[e+13]]+Ee[r[e+14]]+Ee[r[e+15]]).toLowerCase()}var ei,km=new Uint8Array(16);function Xt(){if(!ei&&(ei=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ei))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ei(km)}var Ys,ti,Xs=0,Qs=0;function Rm(r,e,t){var n=e&&t||0,i=e||new Array(16);r=r||{};var s=r.node,a=r.clockseq;if(r._v6||(s||(s=Ys),a==null&&(a=ti)),s==null||a==null){var o=r.random||(r.rng||Xt)();s==null&&(s=[o[0],o[1],o[2],o[3],o[4],o[5]],!Ys&&!r._v6&&(s[0]|=1,Ys=s)),a==null&&(a=(o[6]<<8|o[7])&16383,ti===void 0&&!r._v6&&(ti=a))}var u=r.msecs!==void 0?r.msecs:Date.now(),c=r.nsecs!==void 0?r.nsecs:Qs+1,d=u-Xs+(c-Qs)/1e4;if(d<0&&r.clockseq===void 0&&(a=a+1&16383),(d<0||u>Xs)&&r.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Xs=u,Qs=c,ti=a,u+=122192928e5;var p=((u&268435455)*1e4+c)%4294967296;i[n++]=p>>>24&255,i[n++]=p>>>16&255,i[n++]=p>>>8&255,i[n++]=p&255;var h=u/4294967296*1e4&268435455;i[n++]=h>>>8&255,i[n++]=h&255,i[n++]=h>>>24&15|16,i[n++]=h>>>16&255,i[n++]=a>>>8|128,i[n++]=a&255;for(var g=0;g<6;++g)i[n+g]=s[g];return e||et(i)}var Vu=Rm;function ea(r){var e=typeof r=="string"?Xn(r):r,t=Nm(e);return typeof r=="string"?et(t):t}function Nm(r,e=!1){return Uint8Array.of((r[6]&15)<<4|r[7]>>4&15,(r[7]&15)<<4|(r[4]&240)>>4,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,(r[1]&15)<<4|(r[2]&240)>>4,96|r[2]&15,r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function Cm(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var jm="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Lm="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function ta(r,e,t){function n(i,s,a,o){var u;if(typeof i=="string"&&(i=Cm(i)),typeof s=="string"&&(s=Xn(s)),((u=s)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,a){o=o||0;for(var d=0;d<16;++d)a[o+d]=c[d];return a}return et(c)}try{n.name=r}catch{}return n.DNS=jm,n.URL=Lm,n}var zm=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ra={randomUUID:zm};function Mm(r,e,t){if(ra.randomUUID&&!e&&!r)return ra.randomUUID();r=r||{};var n=r.random||(r.rng||Xt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return et(n)}var de=Mm;function Dm(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function na(r,e){return r<<e|r>>>32-e}function Um(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var i=0;i<n.length;++i)r.push(n.charCodeAt(i))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var s=r.length/4+2,a=Math.ceil(s/16),o=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=r[u*64+d*4]<<24|r[u*64+d*4+1]<<16|r[u*64+d*4+2]<<8|r[u*64+d*4+3];o[u]=c}o[a-1][14]=(r.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(r.length-1)*8&4294967295;for(var p=0;p<a;++p){for(var h=new Uint32Array(80),g=0;g<16;++g)h[g]=o[p][g];for(var _=16;_<80;++_)h[_]=na(h[_-3]^h[_-8]^h[_-14]^h[_-16],1);for(var b=t[0],y=t[1],v=t[2],w=t[3],T=t[4],N=0;N<80;++N){var U=Math.floor(N/20),M=na(b,5)+Dm(U,y,v,w)+T+e[U]+h[N]>>>0;T=w,w=v,v=na(y,30)>>>0,y=b,b=M}t[0]=t[0]+b>>>0,t[1]=t[1]+y>>>0,t[2]=t[2]+v>>>0,t[3]=t[3]+w>>>0,t[4]=t[4]+T>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Hu=Um;var Zm=ta("v5",80,Hu),Fm=Zm;function Ju(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Wu(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ju(Object(t),!0).forEach(function(n){Bm(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ju(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Bm(r,e,t){return(e=Gm(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Gm(r){var e=qm(r,"string");return typeof e=="symbol"?e:e+""}function qm(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Ku(r={},e,t=0){var n=Vu(Wu(Wu({},r),{},{_v6:!0}),new Uint8Array(16));if(n=ea(n),e){for(var i=0;i<16;i++)e[t+i]=n[i];return e}return et(n)}var Yu=null,Xu=null,ut=0;function Vm(r,e,t){r=r||{};var n=e&&t||0,i=e||new Uint8Array(16),s=r.random||(r.rng||Xt)(),a=r.msecs!==void 0?r.msecs:Date.now(),o=r.seq!==void 0?r.seq:null,u=Xu,c=Yu;return a>ut&&r.msecs===void 0&&(ut=a,o!==null&&(u=null,c=null)),o!==null&&(o>2147483647&&(o=2147483647),u=o>>>19&4095,c=o&524287),(u===null||c===null)&&(u=s[6]&127,u=u<<8|s[7],c=s[8]&63,c=c<<8|s[9],c=c<<5|s[10]>>>3),a+1e4>ut&&o===null?++c>524287&&(c=0,++u>4095&&(u=0,ut++)):ut=a,Xu=u,Yu=c,i[n++]=ut/1099511627776&255,i[n++]=ut/4294967296&255,i[n++]=ut/16777216&255,i[n++]=ut/65536&255,i[n++]=ut/256&255,i[n++]=ut&255,i[n++]=u>>>4&15|112,i[n++]=u&255,i[n++]=c>>>13&63|128,i[n++]=c>>>5&255,i[n++]=c<<3&255|s[10]&7,i[n++]=s[11],i[n++]=s[12],i[n++]=s[13],i[n++]=s[14],i[n++]=s[15],e||et(i)}var ia=Vm;var aa=class{getStore(){}run(e,t){return t()}},sa=Symbol.for("ls:tracing_async_local_storage"),Hm=new aa,oa=class{getInstance(){return globalThis[sa]??Hm}initializeGlobalInstance(e){globalThis[sa]===void 0&&(globalThis[sa]=e)}},Jm=new oa;function ec(r=!1){let e=Jm.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}var j0=Symbol.for("langsmith:traceable:root");function ri(r){return typeof r=="function"&&"langsmith:traceable"in r}var rw={};we(rw,{LogStreamCallbackHandler:()=>kr,RunLog:()=>Pr,RunLogPatch:()=>at,isLogStreamHandler:()=>ho});var ua={};we(ua,{JsonPatchError:()=>ue,_areEquals:()=>Yr,applyOperation:()=>er,applyPatch:()=>tr,applyReducer:()=>Xm,deepClone:()=>Km,getValueByPointer:()=>oi,validate:()=>rc,validator:()=>ui});var Wm=Object.prototype.hasOwnProperty;function ii(r,e){return Wm.call(r,e)}function si(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)ii(r,t)&&e.push(t);return e}function $e(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function ai(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function bt(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function Kr(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function ni(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(ni(r[t]))return!0}else if(typeof r=="object"){let t=si(r),n=t.length;for(var e=0;e<n;e++)if(ni(r[t[e]]))return!0}}return!1}function tc(r,e){let t=[r];for(let n in e){let i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&t.push(`${n}: ${i}`)}return t.join(`
`)}var Qt=class extends Error{constructor(e,t,n,i,s){super(tc(e,{name:t,index:n,operation:i,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=tc(e,{name:t,index:n,operation:i,tree:s})}};var ue=Qt,Km=$e,Er={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=oi(t,this.path);n&&(n=$e(n));let i=er(t,{op:"remove",path:this.from}).removed;return er(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=oi(t,this.from);return er(t,{op:"add",path:this.path,value:$e(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:Yr(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},Ym={add:function(r,e,t){return ai(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Er.move,copy:Er.copy,test:Er.test,_get:Er._get};function oi(r,e){if(e=="")return r;var t={op:"_get",path:e};return er(r,t),t.value}function er(r,e,t=!1,n=!0,i=!0,s=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):ui(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=oi(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=Yr(r,e.value),a.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,r);return a}}else{n||(r=$e(r));let o=(e.path||"").split("/"),u=r,c=1,d=o.length,p,h,g;for(typeof t=="function"?g=t:g=ui;;){if(h=o[c],h&&h.indexOf("~")!=-1&&(h=Kr(h)),i&&(h=="__proto__"||h=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&p===void 0&&(u[h]===void 0?p=o.slice(0,c).join("/"):c==d-1&&(p=e.path),p!==void 0&&g(e,0,r,p)),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(t&&!ai(h))throw new ue("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,r);ai(h)&&(h=~~h)}if(c>=d){if(t&&e.op==="add"&&h>u.length)throw new ue("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,r);let _=Ym[e.op].call(e,u,h,r);if(_.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return _}}else if(c>=d){let _=Er[e.op].call(e,u,h,r);if(_.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return _}if(u=u[h],t&&c<d&&(!u||typeof u!="object"))throw new ue("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,r)}}}function tr(r,e,t,n=!0,i=!0){if(t&&!Array.isArray(e))throw new ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=$e(r));let s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=er(r,e[a],t,!0,i,a),r=s[a].newDocument;return s.newDocument=r,s}function Xm(r,e,t){let n=er(r,e);if(n.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function ui(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new ue("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Er[r.op]){if(typeof r.path!="string")throw new ue("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new ue('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new ue("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&ni(r.value))throw new ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var i=r.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new ue("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new ue("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=rc([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ue("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function rc(r,e,t){try{if(!Array.isArray(r))throw new ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)tr($e(e),$e(r),t||!0);else{t=t||ui;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(i){if(i instanceof ue)return i;throw i}}function Yr(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),i,s,a;if(t&&n){if(s=r.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!Yr(r[i],e[i]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(s=o.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=s;i--!==0;)if(a=o[i],!Yr(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}function nc(r,e,t,n,i){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=si(e),a=si(r),o=!1,u=!1,c=a.length-1;c>=0;c--){var d=a[c],p=r[d];if(ii(e,d)&&!(e[d]===void 0&&p!==void 0&&Array.isArray(e)===!1)){var h=e[d];typeof p=="object"&&p!=null&&typeof h=="object"&&h!=null&&Array.isArray(p)===Array.isArray(h)?nc(p,h,t,n+"/"+bt(d),i):p!==h&&(o=!0,i&&t.push({op:"test",path:n+"/"+bt(d),value:$e(p)}),t.push({op:"replace",path:n+"/"+bt(d),value:$e(h)}))}else Array.isArray(r)===Array.isArray(e)?(i&&t.push({op:"test",path:n+"/"+bt(d),value:$e(p)}),t.push({op:"remove",path:n+"/"+bt(d)}),u=!0):(i&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),o=!0)}if(!(!u&&s.length==a.length))for(var c=0;c<s.length;c++){var d=s[c];!ii(r,d)&&e[d]!==void 0&&t.push({op:"add",path:n+"/"+bt(d),value:$e(e[d])})}}}function B0(r,e,t=!1){var n=[];return nc(r,e,n,"",t),n}var V0=m(l({},ua),{JsonPatchError:Qt,deepClone:$e,escapePathComponent:bt,unescapePathComponent:Kr});var Ub={};we(Ub,{BaseTracer:()=>Ve,isBaseTracer:()=>ir});var ic="gen_ai.operation.name",sc="gen_ai.system",ca="gen_ai.request.model",ac="gen_ai.response.model",la="gen_ai.usage.input_tokens",da="gen_ai.usage.output_tokens",fa="gen_ai.usage.total_tokens",oc="gen_ai.request.max_tokens",uc="gen_ai.request.temperature",cc="gen_ai.request.top_p",lc="gen_ai.request.frequency_penalty",dc="gen_ai.request.presence_penalty",fc="gen_ai.response.finish_reasons",pc="gen_ai.prompt",hc="gen_ai.completion",mc="gen_ai.request.extra_query",gc="gen_ai.request.extra_body",_c="gen_ai.serialized.name",yc="gen_ai.serialized.signature",bc="gen_ai.serialized.doc",wc="gen_ai.response.id",vc="gen_ai.response.service_tier",xc="gen_ai.response.system_fingerprint",Ec="gen_ai.usage.input_token_details",Sc="gen_ai.usage.output_token_details",Tc="langsmith.trace.session_id",Oc="langsmith.trace.session_name",$c="langsmith.span.kind",Ic="langsmith.trace.name",Ac="langsmith.metadata",pa="langsmith.span.tags";var Pc="langsmith.request.streaming",kc="langsmith.request.headers";var eg=(...r)=>fetch(...r),Rc=Symbol.for("ls:fetch_implementation");var Nc=()=>{let r=globalThis[Rc];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},Cc=r=>(...e)=>f(null,null,function*(){if(r||fe("DEBUG")==="true"){let[n,i]=e;console.log(`\u2192 ${i?.method||"GET"} ${n}`)}let t=yield(globalThis[Rc]??eg)(...e);return(r||fe("DEBUG")==="true")&&console.log(`\u2190 ${t.status} ${t.statusText} ${t.url}`),t});var Xr=()=>fe("PROJECT")??qe("LANGCHAIN_SESSION")??"default";var jc={};function Sr(r){jc[r]||(console.warn(r),jc[r]=!0)}var tg=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function J(r,e){if(!tg.test(r)){let t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}function ci(r){let e=typeof r=="string"?Date.parse(r):r;return ia({msecs:e,seq:0})}var li="0.3.81";var wt,rg=()=>typeof window<"u"&&typeof window.document<"u",ng=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ig=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Lc=()=>typeof Deno<"u",sg=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Lc(),ga=()=>wt||(typeof Bun<"u"?wt="bun":rg()?wt="browser":sg()?wt="node":ng()?wt="webworker":ig()?wt="jsdom":Lc()?wt="deno":wt="other",wt),ha;function di(){if(ha===void 0){let r=ga(),e=og();ha=l({library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:li},e)}return ha}function _a(){let r=ag(),e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,i]of Object.entries(r))typeof i=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[n]=i);return e}function ag(){let r={};try{if(typeof process<"u"&&process.env)for(let[e,t]of Object.entries(process.env))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&t!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof t=="string"?r[e]=t.slice(0,2)+"*".repeat(t.length-4)+t.slice(-2):r[e]=t)}catch{}return r}function qe(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}function fe(r){return qe(`LANGSMITH_${r}`)||qe(`LANGCHAIN_${r}`)}var ma;function og(){if(ma!==void 0)return ma;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=qe(t);n!==void 0&&(e[t]=n)}return ma=e,e}function fi(){return qe("OTEL_ENABLED")==="true"||fe("OTEL_ENABLED")==="true"}var wa=class{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&fi()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}},va=class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new wa})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},xa=class{active(){return{}}with(e,t){return t()}},ya=Symbol.for("ls:otel_trace"),ba=Symbol.for("ls:otel_context"),zc=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),ug=new va,cg=new xa,Ea=class{getTraceInstance(){return globalThis[ya]??ug}getContextInstance(){return globalThis[ba]??cg}initializeGlobalInstances(e){globalThis[ya]===void 0&&(globalThis[ya]=e.trace),globalThis[ba]===void 0&&(globalThis[ba]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[zc]=e}getDefaultOTLPTracerComponents(){return globalThis[zc]??void 0}},Sa=new Ea;function pi(){return Sa.getTraceInstance()}function Mc(){return Sa.getContextInstance()}function Dc(){return Sa.getDefaultOTLPTracerComponents()}var lg={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function dg(r){return lg[r]||r}var hi=class{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let n of e)try{if(!n.run)continue;if(n.operation==="post"){let i=this.createSpanForRun(n,n.run,t.get(n.id));i&&!n.run.end_time&&this.spans.set(n.id,i)}else this.updateSpanForRun(n,n.run)}catch(i){console.error(`Error processing operation ${n.id}:`,i)}}createSpanForRun(e,t,n){let i=n&&pi().getSpan(n);if(i)try{return this.finishSpanSetup(i,t,e)}catch(s){console.error(`Failed to create span for run ${e.id}:`,s);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});let i=t.end_time;i&&(n.end(new Date(i)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let n=t.invocation_params;if(n.model)return n.model;if(n.model_name)return n.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute($c,t.run_type);let o=dg(t.run_type||"chain");e.setAttribute(ic,o)}"name"in t&&t.name&&e.setAttribute(Ic,t.name),"session_id"in t&&t.session_id&&e.setAttribute(Tc,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(Oc,t.session_name),this.setGenAiSystem(e,t);let i=this.extractModelName(t);i&&e.setAttribute(ca,i),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(la,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(da,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(fa,t.total_tokens),this.setInvocationParameters(e,t);let s=t.extra?.metadata||{};for(let[o,u]of Object.entries(s))u!=null&&e.setAttribute(`${Ac}.${o}`,String(u));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(pa,a.join(", ")):a&&e.setAttribute(pa,String(a)),"serialized"in t&&typeof t.serialized=="object"){let o=t.serialized;o.name&&e.setAttribute(_c,String(o.name)),o.signature&&e.setAttribute(yc,String(o.signature)),o.doc&&e.setAttribute(bc,String(o.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain",i=this.extractModelName(t);if(i){let s=i.toLowerCase();s.includes("anthropic")||s.startsWith("claude")?n="anthropic":s.includes("bedrock")?n="aws.bedrock":s.includes("azure")&&s.includes("openai")?n="az.ai.openai":s.includes("azure")&&s.includes("inference")?n="az.ai.inference":s.includes("cohere")?n="cohere":s.includes("deepseek")?n="deepseek":s.includes("gemini")?n="gemini":s.includes("groq")?n="groq":s.includes("watson")||s.includes("ibm")?n="ibm.watsonx.ai":s.includes("mistral")?n="mistral_ai":s.includes("gpt")||s.includes("openai")?n="openai":s.includes("perplexity")||s.includes("sonar")?n="perplexity":s.includes("vertex")?n="vertex_ai":(s.includes("xai")||s.includes("grok"))&&(n="xai")}e.setAttribute(sc,n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(oc,n.max_tokens),n.temperature!==void 0&&e.setAttribute(uc,n.temperature),n.top_p!==void 0&&e.setAttribute(cc,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(lc,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(dc,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(ca,n.model),n.stream!==void 0&&e.setAttribute(Pc,n.stream),n.extra_headers&&e.setAttribute(kc,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(mc,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(gc,JSON.stringify(n.extra_body))),e.setAttribute(pc,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{let n=t.run.outputs,i=this.getUnifiedRunTokens(n);if(i&&(e.setAttribute(la,i[0]),e.setAttribute(da,i[1]),e.setAttribute(fa,i[0]+i[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(ac,String(n.model)),n.id&&e.setAttribute(wc,n.id),n.choices&&Array.isArray(n.choices)){let s=n.choices.map(a=>a.finish_reason).filter(a=>a).map(String);s.length>0&&e.setAttribute(fc,s.join(", "))}if(n.service_tier&&e.setAttribute(vc,n.service_tier),n.system_fingerprint&&e.setAttribute(xc,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){let s=n.usage_metadata;s.input_token_details&&e.setAttribute(Ec,JSON.stringify(s.input_token_details)),s.output_token_details&&e.setAttribute(Sc,JSON.stringify(s.output_token_details))}}e.setAttribute(hc,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;let n=Object.keys(e);for(let a of n){let o=e[a];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}let i=e.generations||[];if(!Array.isArray(i))return null;let s=Array.isArray(i[0])?i.flat():i;for(let a of s)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}};var Wc=gt(Yn(),1),wi=gt(bi(),1);var wg=[408,425,429,500,502,503,504],en=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in wi.default?this.queue=new wi.default.default({concurrency:this.maxConcurrency}):this.queue=new wi.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){return this.callWithOptions({},e,...t)}callWithOptions(e,t,...n){let i=e.sizeBytes??0;if(this.maxQueueSizeBytes!==void 0&&i>0&&this.queueSizeBytes+i>this.maxQueueSizeBytes)return Promise.reject(new Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${i} bytes.`));i>0&&(this.queueSizeBytes+=i);let s=this.onFailedResponseHook,a=this.queue.add(()=>(0,Wc.default)(()=>t(...n).catch(u=>{throw u instanceof Error?u:new Error(u)}),{onFailedAttempt(u){return f(this,null,function*(){if(u.message.startsWith("Cancel")||u.message.startsWith("TimeoutError")||u.name==="TimeoutError"||u.message.startsWith("AbortError")||u?.code==="ECONNABORTED")throw u;let c=u?.response;if(s&&(yield s(c)))return;let d=c?.status??u?.status;if(d&&!wg.includes(+d))throw u})},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return i>0&&(a=a.finally(()=>{this.queueSizeBytes-=i})),e.signal?Promise.race([a,new Promise((o,u)=>{e.signal?.addEventListener("abort",()=>{u(new Error("AbortError"))})})]):a}};function ka(r){return typeof r?._getType=="function"}function Ra(r){let e={type:r._getType(),data:{content:r.content}};return r?.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs=l({},r.additional_kwargs)),e}var gb=gt(Ud(),1);function kt(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);let[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){let[i,s]=e.split("/",2);if(!i||!s)throw new Error(`Invalid identifier format: ${r}`);return[i,s,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}var Ya=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}};function L(r,e,t){return f(this,null,function*(){let n;if(r.ok){t&&(n=yield r.text());return}if(r.status===403)try{(yield r.json())?.error==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{let o=new Error(`${r.status} ${r.statusText}`);throw o.status=r?.status,o}if(n===void 0)try{n=yield r.text()}catch{n=""}let i=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Message: ${n}`;if(r.status===409)throw new Ya(i);let s=new Error(i);throw s.status=r.status,s})}var Zd="ERR_CONFLICTING_ENDPOINTS",Ri=class extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:Zd}),this.name="ConflictingEndpointsError"}};function Fd(r){return typeof r=="object"&&r!==null&&r.code===Zd}var Bd="[...]",_b={result:"[Circular]"},Ci=[],$r=[],yb=new TextEncoder;function bb(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Ni(r){return yb.encode(r)}function Gd(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function wb(r){return function(e,t){if(r){let n=r.call(this,e,t);if(n!==void 0)return n}return Gd(t)}}function Ze(r,e,t,n,i){try{let s=JSON.stringify(r,wb(t),n);return Ni(s)}catch(s){if(!s.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Ni("[Unserializable]");fe("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof i>"u"&&(i=bb()),Qa(r,"",0,[],void 0,0,i);let a;try{$r.length===0?a=JSON.stringify(r,t,n):a=JSON.stringify(r,vb(t),n)}catch{return Ni("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Ci.length!==0;){let o=Ci.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return Ni(a)}}function Xa(r,e,t,n){var i=Object.getOwnPropertyDescriptor(n,t);i.get!==void 0?i.configurable?(Object.defineProperty(n,t,{value:r}),Ci.push([n,t,e,i])):$r.push([e,t,r]):(n[t]=r,Ci.push([n,t,e]))}function Qa(r,e,t,n,i,s,a){s+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Xa(_b,r,e,i);return}if(typeof a.depthLimit<"u"&&s>a.depthLimit){Xa(Bd,r,e,i);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){Xa(Bd,r,e,i);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Qa(r[o],o,o,n,r,s,a);else{r=Gd(r);var u=Object.keys(r);for(o=0;o<u.length;o++){var c=u[o];Qa(r[c],c,o,n,r,s,a)}}n.pop()}}function vb(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if($r.length>0)for(var n=0;n<$r.length;n++){var i=$r[n];if(i[1]===e&&i[0]===t){t=i[2],$r.splice(n,1);break}}return r.call(this,e,t)}}function qd(r,e){let t=di(),n=e??_a(),i=r.extra??{},s=i.metadata;return r.extra=m(l({},i),{runtime:l(l({},t),i?.runtime),metadata:l(l(l({},n),n.revision_id||"revision_id"in r&&r.revision_id?{revision_id:("revision_id"in r?r.revision_id:void 0)??n.revision_id}:{}),s)}),r}var xb=r=>{let e=r?.toString()??fe("TRACING_SAMPLING_RATE");if(e===void 0)return;let t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},Eb=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};function Sb(r){return f(this,null,function*(){let e=[];try{for(var t=X(r),n,i,s;n=!(i=yield t.next()).done;n=!1){let a=i.value;e.push(a)}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield i.call(t))}finally{if(s)throw s[0]}}return e})}function ji(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var Tb=r=>f(null,null,function*(){if(r?.status===429){let e=parseInt(r.headers.get("retry-after")??"10",10)*1e3;if(e>0)return yield new Promise(t=>setTimeout(t,e)),!0}return!1});function Vd(r){return typeof r=="number"?Number(r.toFixed(4)):r}var Ob=24*1024*1024,Wd=1024*1024*1024,$b=1e4,Ib=100,Hd="https://api.smith.langchain.com",eo=class{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??Wd}peek(){return this.items[0]}push(e){let t,n=new Promise(s=>{t=s}),i=Ze(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+i>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${i} bytes.`),t(),n):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:i}),this.sizeBytes+=i,n)}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let n=[],i=0;for(;i+(this.peek()?.size??0)<e&&this.items.length>0&&n.length<t;){let s=this.items.shift();s&&(n.push(s),i+=s.size,this.sizeBytes-=s.size)}if(n.length===0&&this.items.length>0){let s=this.items.shift();n.push(s),i+=s.size,this.sizeBytes-=s.size}return[n.map(s=>({action:s.action,item:s.payload,otelContext:s.otelContext,apiKey:s.apiKey,apiUrl:s.apiUrl,size:s.size})),()=>n.forEach(s=>s.itemPromiseResolve())]}},rr=class r{get _fetch(){return this.fetchImplementation||Cc(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:qe("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:qe("LANGSMITH_DEBUG")==="true"});let t=r.getDefaultClientConfig();if(this.tracingSampleRate=xb(e.tracingSamplingRate),this.apiUrl=ji(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ji(e.apiKey??t.apiKey),this.webUrl=ji(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=ji(e.workspaceId??fe("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new en(m(l({},e.callerOptions??{}),{maxRetries:4,debug:e.debug??this.debug})),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;let n=e.maxIngestMemoryBytes??Wd;this.batchIngestCaller=new en(m(l({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:n},e.callerOptions??{}),{onFailedResponseHook:Tb,debug:e.debug??this.debug})),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new eo(n),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,fi()&&(this.langSmithToOTELTranslator=new hi),this.cachedLSEnvVarsForMetadata=_a()}static getDefaultClientConfig(){let e=fe("API_KEY"),t=fe("ENDPOINT")??Hd,n=fe("HIDE_INPUTS")==="true",i=fe("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:Eb(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${li}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}processInputs(e){return f(this,null,function*(){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e})}processOutputs(e){return f(this,null,function*(){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e})}prepareRunCreateOrUpdateInputs(e){return f(this,null,function*(){let t=l({},e);return t.inputs!==void 0&&(t.inputs=yield this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=yield this.processOutputs(t.outputs)),t})}_getResponse(e,t){return f(this,null,function*(){let n=t?.toString()??"",i=`${this.apiUrl}${e}?${n}`;return yield this.caller.call(()=>f(this,null,function*(){let a=yield this._fetch(i,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(a,`fetch ${e}`),a}))})}_get(e,t){return f(this,null,function*(){return(yield this._getResponse(e,t)).json()})}_getPaginated(i){return H(this,arguments,function*(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));let o=`${this.apiUrl}${e}?${t}`,u=yield new x(this.caller.call(()=>f(this,null,function*(){let d=yield this._fetch(o,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(d,`fetch ${e}`),d}))),c=n?n(yield new x(u.json())):yield new x(u.json());if(c.length===0||(yield c,c.length<a))break;s+=c.length}})}_getCursorPaginatedList(e,t=null,n="POST",i="runs"){return H(this,null,function*(){let s=t?l({},t):{};for(;;){let a=JSON.stringify(s),o=yield new x(this.caller.call(()=>f(this,null,function*(){let d=yield this._fetch(`${this.apiUrl}${e}`,m(l({method:n,headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:a}));return yield L(d,`fetch ${e}`),d}))),u=yield new x(o.json());if(!u||!u[i])break;yield u[i];let c=u.cursors;if(!c||!c.next)break;s.cursor=c.next}})}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let i of e)this.filteredPostUuids.has(i.trace_id)?i.id===i.trace_id&&this.filteredPostUuids.delete(i.trace_id):n.push(i);return n}else{let n=[];for(let i of e){let s=i.trace_id??i.id;this.filteredPostUuids.has(s)||(i.id===s?this._shouldSample()?n.push(i):this.filteredPostUuids.add(s):n.push(i))}return n}}_getBatchSizeLimitBytes(){return f(this,null,function*(){let e=yield this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??Ob})}_getBatchSizeLimit(){return f(this,null,function*(){let e=yield this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??Ib})}_getDatasetExamplesMultiPartSupport(){return f(this,null,function*(){return(yield this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1})}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let n=[];for(;this.autoBatchQueue.items.length>0;){let[i,s]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!i.length){s();break}let a=i.reduce((c,d)=>{let p=d.apiUrl??this.apiUrl,h=d.apiKey??this.apiKey,_=d.apiKey===this.apiKey&&d.apiUrl===this.apiUrl?"default":`${p}|${h}`;return c[_]||(c[_]=[]),c[_].push(d),c},{}),o=[];for(let[c,d]of Object.entries(a)){let p=this._processBatch(d,{apiUrl:c==="default"?void 0:c.split("|")[0],apiKey:c==="default"?void 0:c.split("|")[1]});o.push(p)}let u=Promise.all(o).finally(s);n.push(u)}return Promise.all(n)}_processBatch(e,t){return f(this,null,function*(){if(!e.length)return;let n=e.reduce((i,s)=>i+(s.size??0),0);try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{let i={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)},s=yield this._ensureServerInfo();if(s?.batch_ingest_config?.use_multipart_endpoint){let a=s?.instance_flags?.gzip_body_enabled;yield this.multipartIngestRuns(i,m(l({},t),{useGzip:a,sizeBytes:n}))}else yield this.batchIngestRuns(i,m(l({},t),{sizeBytes:n}))}}catch(i){console.error("Error exporting batch:",i)}})}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){let t=new Map,n=[];for(let i of e)i.item.id&&i.otelContext&&(t.set(i.item.id,i.otelContext),i.action==="create"?n.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):n.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}processRunOperation(e){return f(this,null,function*(){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=qd(e.item,this.cachedLSEnvVarsForMetadata);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let n=yield this._getBatchSizeLimitBytes(),i=yield this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>i)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:i}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:i})},this.autoBatchAggregationDelayMs)),t})}_getServerInfo(){return f(this,null,function*(){let t=yield(yield this.caller.call(()=>f(this,null,function*(){let n=yield this._fetch(`${this.apiUrl}/info`,l({method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout($b)},this.fetchOptions));return yield L(n,"get server info"),n}))).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t})}_ensureServerInfo(){return f(this,null,function*(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=f(this,null,function*(){if(this._serverInfo===void 0)try{this._serverInfo=yield this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))})}_getSettings(){return f(this,null,function*(){return this.settings||(this.settings=this._get("/settings")),yield this.settings})}flush(){return f(this,null,function*(){let e=yield this._getBatchSizeLimitBytes(),t=yield this._getBatchSizeLimit();yield this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})})}_cloneCurrentOTELContext(){let e=pi(),t=Mc();if(this.langSmithToOTELTranslator!==void 0){let n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}createRun(e,t){return f(this,null,function*(){if(!this._filterForSampling([e]).length)return;let n=m(l({},this.headers),{"Content-Type":"application/json"}),i=e.project_name;delete e.project_name;let s=yield this.prepareRunCreateOrUpdateInputs(m(l({session_name:i},e),{start_time:e.start_time??Date.now()}));if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){let u=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:s,otelContext:u,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=qd(s,this.cachedLSEnvVarsForMetadata);t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(n["x-tenant-id"]=t.workspaceId);let o=Ze(a,`Creating run with id: ${a.id}`);yield this.caller.call(()=>f(this,null,function*(){let u=yield this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,m(l({method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:o}));return yield L(u,"create run",!0),u}))})}batchIngestRuns(i,s){return f(this,arguments,function*({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let a=yield Promise.all(e?.map(d=>this.prepareRunCreateOrUpdateInputs(d))??[]),o=yield Promise.all(t?.map(d=>this.prepareRunCreateOrUpdateInputs(d))??[]);if(a.length>0&&o.length>0){let d=a.reduce((h,g)=>(g.id&&(h[g.id]=g),h),{}),p=[];for(let h of o)h.id!==void 0&&d[h.id]?d[h.id]=l(l({},d[h.id]),h):p.push(h);a=Object.values(d),o=p}let u={post:a,patch:o};if(!u.post.length&&!u.patch.length)return;let c={post:[],patch:[]};for(let d of["post","patch"]){let p=d,h=u[p].reverse(),g=h.pop();for(;g!==void 0;)c[p].push(g),g=h.pop()}if(c.post.length>0||c.patch.length>0){let d=c.post.map(p=>p.id).concat(c.patch.map(p=>p.id)).join(",");yield this._postBatchIngestRuns(Ze(c,`Ingesting runs with ids: ${d}`),n)}})}_postBatchIngestRuns(e,t){return f(this,null,function*(){let n=m(l({},this.headers),{"Content-Type":"application/json",Accept:"application/json"});t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),yield this.batchIngestCaller.callWithOptions({sizeBytes:t?.sizeBytes},()=>f(this,null,function*(){let i=yield this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,m(l({method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:e}));return yield L(i,"batch create run",!0),i}))})}multipartIngestRuns(i,s){return f(this,arguments,function*({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let a={},o=[];for(let _ of e??[]){let b=yield this.prepareRunCreateOrUpdateInputs(_);b.id!==void 0&&b.attachments!==void 0&&(a[b.id]=b.attachments),delete b.attachments,o.push(b)}let u=[];for(let _ of t??[])u.push(yield this.prepareRunCreateOrUpdateInputs(_));if(o.find(_=>_.trace_id===void 0||_.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(u.find(_=>_.trace_id===void 0||_.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(o.length>0&&u.length>0){let _=o.reduce((y,v)=>(v.id&&(y[v.id]=v),y),{}),b=[];for(let y of u)y.id!==void 0&&_[y.id]?_[y.id]=l(l({},_[y.id]),y):b.push(y);o=Object.values(_),u=b}if(o.length===0&&u.length===0)return;let p=[],h=[];for(let[_,b]of[["post",o],["patch",u]])for(let y of b){let g=y,{inputs:v,outputs:w,events:T,extra:N,error:U,serialized:M,attachments:ee}=g,G=se(g,["inputs","outputs","events","extra","error","serialized","attachments"]),re={inputs:v,outputs:w,events:T,extra:N,error:U,serialized:M},Ge=Ze(G,`Serializing for multipart ingestion of run with id: ${G.id}`);h.push({name:`${_}.${G.id}`,payload:new Blob([Ge],{type:`application/json; length=${Ge.length}`})});for(let[We,pe]of Object.entries(re)){if(pe===void 0)continue;let be=Ze(pe,`Serializing ${We} for multipart ingestion of run with id: ${G.id}`);h.push({name:`${_}.${G.id}.${We}`,payload:new Blob([be],{type:`application/json; length=${be.length}`})})}if(G.id!==void 0){let We=a[G.id];if(We){delete a[G.id];for(let[pe,be]of Object.entries(We)){let Ot,mt;if(Array.isArray(be)?[Ot,mt]=be:(Ot=be.mimeType,mt=be.data),pe.includes(".")){console.warn(`Skipping attachment '${pe}' for run ${G.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}h.push({name:`attachment.${G.id}.${pe}`,payload:new Blob([mt],{type:`${Ot}; length=${mt.byteLength}`})})}}}p.push(`trace=${G.trace_id},id=${G.id}`)}yield this._sendMultipartRequest(h,p.join("; "),n)})}_createNodeFetchBody(e,t){return f(this,null,function*(){let n=[];for(let a of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),yield new Blob(n).arrayBuffer()})}_createMultipartStream(e,t){return f(this,null,function*(){let n=new TextEncoder;return new ReadableStream({start(a){return f(this,null,function*(){let o=u=>f(null,null,function*(){typeof u=="string"?a.enqueue(n.encode(u)):a.enqueue(u)});for(let u of e){yield o(`--${t}\r
`),yield o(`Content-Disposition: form-data; name="${u.name}"\r
`),yield o(`Content-Type: ${u.payload.type}\r
\r
`);let d=u.payload.stream().getReader();try{let p;for(;!(p=yield d.read()).done;)a.enqueue(p.value)}finally{d.releaseLock()}yield o(`\r
`)}yield o(`--${t}--\r
`),a.close()})}})})}_sendMultipartRequest(e,t,n){return f(this,null,function*(){let i="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=Nc(),a=()=>this._createNodeFetchBody(e,i),o=()=>this._createMultipartStream(e,i),u=c=>f(this,null,function*(){return this.batchIngestCaller.callWithOptions({sizeBytes:n?.sizeBytes},()=>f(this,null,function*(){let d=yield c(),p=m(l({},this.headers),{"Content-Type":`multipart/form-data; boundary=${i}`});n?.apiKey!==void 0&&(p["x-api-key"]=n.apiKey);let h=d;n?.useGzip&&typeof d=="object"&&"pipeThrough"in d&&(h=d.pipeThrough(new CompressionStream("gzip")),p["Content-Encoding"]="gzip");let g=yield this._fetch(`${n?.apiUrl??this.apiUrl}/runs/multipart`,l({method:"POST",headers:p,body:h,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(g,"Failed to send multipart request",!0),g}))});try{let c,d=!1;!s&&!this.multipartStreamingDisabled&&ga()!=="bun"?(d=!0,c=yield u(o)):c=yield u(a),(!this.multipartStreamingDisabled||d)&&c.status===422&&(n?.apiUrl??this.apiUrl)!==Hd&&(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,c=yield u(a))}catch(c){console.warn(`${c.message.trim()}

Context: ${t}`)}})}updateRun(e,t,n){return f(this,null,function*(){J(e),t.inputs&&(t.inputs=yield this.processInputs(t.inputs)),t.outputs&&(t.outputs=yield this.processOutputs(t.outputs));let i=m(l({},t),{id:e});if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){let o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&i.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){yield this.processRunOperation({action:"update",item:i,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:i,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}let s=m(l({},this.headers),{"Content-Type":"application/json"});n?.apiKey!==void 0&&(s["x-api-key"]=n.apiKey),n?.workspaceId!==void 0&&(s["x-tenant-id"]=n.workspaceId);let a=Ze(t,`Serializing payload to update run with id: ${e}`);yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${n?.apiUrl??this.apiUrl}/runs/${e}`,m(l({method:"PATCH",headers:s,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:a}));return yield L(o,"update run",!0),o}))})}readRun(n){return f(this,arguments,function*(e,{loadChildRuns:t}={loadChildRuns:!1}){J(e);let i=yield this._get(`/runs/${e}`);return t&&(i=yield this._loadChildRuns(i)),i})}getRunUrl(i){return f(this,arguments,function*({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n?.projectName?s=(yield this.readProject({projectName:n?.projectName})).id:n?.projectId?s=n?.projectId:s=(yield this.readProject({projectName:fe("PROJECT")||"default"})).id;let a=yield this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=yield this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")})}_loadChildRuns(e){return f(this,null,function*(){let t=yield Sb(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},i={};t.sort((s,a)=>(s?.dotted_order??"").localeCompare(a?.dotted_order??""));for(let s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.dotted_order?.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in n||(n[s.parent_run_id]=[]),n[s.parent_run_id].push(s),i[s.id]=s)}e.child_runs=n[e.id]||[];for(let s in n)s!==e.id&&(i[s].child_runs=n[s]);return e})}listRuns(e){return H(this,null,function*(){let{projectId:t,projectName:n,parentRunId:i,traceId:s,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:c,runType:d,error:p,id:h,query:g,filter:_,traceFilter:b,treeFilter:y,limit:v,select:w,order:T}=e,N=[];if(t&&(N=Array.isArray(t)?t:[t]),n){let pe=Array.isArray(n)?n:[n],be=yield new x(Promise.all(pe.map(Ot=>this.readProject({projectName:Ot}).then(mt=>mt.id))));N.push(...be)}let U=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],M={session:N.length?N:null,run_type:d,reference_example:a,query:g,filter:_,trace_filter:b,tree_filter:y,execution_order:u,parent_run:i,start_time:o?o.toISOString():null,error:p,id:h,limit:v,trace:s,select:w||U,is_root:c,order:T};M.select.includes("child_run_ids")&&Sr("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let ee=0;try{for(var G=X(this._getCursorPaginatedList("/runs/query",M)),re,Ge,We;re=!(Ge=yield new x(G.next())).done;re=!1){let pe=Ge.value;if(v){if(ee>=v)break;if(pe.length+ee>v){let be=pe.slice(0,v-ee);yield*ve(be);break}ee+=pe.length,yield*ve(pe)}else yield*ve(pe)}}catch{We=[Ge]}finally{try{re&&(Ge=G.return)&&(yield new x(Ge.call(G)))}finally{if(We)throw We[0]}}})}listGroupRuns(e){return H(this,null,function*(){let{projectId:t,projectName:n,groupBy:i,filter:s,startTime:a,endTime:o,limit:u,offset:c}=e,p={session_id:t||(yield new x(this.readProject({projectName:n}))).id,group_by:i,filter:s,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100},h=Number(c)||0,g="/runs/group",_=`${this.apiUrl}${g}`;for(;;){let b=m(l({},p),{offset:h}),y=Object.fromEntries(Object.entries(b).filter(([M,ee])=>ee!==void 0)),v=JSON.stringify(y),w=yield new x(this.caller.call(()=>f(this,null,function*(){let M=yield this._fetch(_,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:v}));return yield L(M,`Failed to fetch ${g}`),M}))),T=yield new x(w.json()),{groups:N,total:U}=T;if(N.length===0)break;for(let M of N)yield M;if(h+=N.length,h>=U)break}})}getRunStats(v){return f(this,arguments,function*({id:e,trace:t,parentRun:n,runType:i,projectNames:s,projectIds:a,referenceExampleIds:o,startTime:u,endTime:c,error:d,query:p,filter:h,traceFilter:g,treeFilter:_,isRoot:b,dataSourceType:y}){let w=a||[];s&&(w=[...a||[],...yield Promise.all(s.map(G=>this.readProject({projectName:G}).then(re=>re.id)))]);let N=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:i,session:w,reference_example:o,start_time:u,end_time:c,error:d,query:p,filter:h,trace_filter:g,tree_filter:_,is_root:b,data_source_type:y}).filter(([G,re])=>re!==void 0)),U=JSON.stringify(N);return yield(yield this.caller.call(()=>f(this,null,function*(){let G=yield this._fetch(`${this.apiUrl}/runs/stats`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:U}));return yield L(G,"get run stats"),G}))).json()})}shareRun(n){return f(this,arguments,function*(e,{shareId:t}={}){let i={run_id:e,share_token:t||de()};J(e);let s=JSON.stringify(i),o=yield(yield this.caller.call(()=>f(this,null,function*(){let u=yield this._fetch(`${this.apiUrl}/runs/${e}/share`,m(l({method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:s}));return yield L(u,"share run"),u}))).json();if(o===null||!("share_token"in o))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${o.share_token}/r`})}unshareRun(e){return f(this,null,function*(){J(e),yield this.caller.call(()=>f(this,null,function*(){let t=yield this._fetch(`${this.apiUrl}/runs/${e}/share`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(t,"unshare run",!0),t}))})}readRunSharedLink(e){return f(this,null,function*(){J(e);let n=yield(yield this.caller.call(()=>f(this,null,function*(){let i=yield this._fetch(`${this.apiUrl}/runs/${e}/share`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(i,"read run shared link"),i}))).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`})}listSharedRuns(n){return f(this,arguments,function*(e,{runIds:t}={}){let i=new URLSearchParams({share_token:e});if(t!==void 0)for(let o of t)i.append("id",o);return J(e),yield(yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}/public/${e}/runs${i}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(o,"list shared runs"),o}))).json()})}readDatasetSharedSchema(e,t){return f(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id),J(e);let i=yield(yield this.caller.call(()=>f(this,null,function*(){let s=yield this._fetch(`${this.apiUrl}/datasets/${e}/share`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(s,"read dataset shared schema"),s}))).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i})}shareDataset(e,t){return f(this,null,function*(){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(yield this.readDataset({datasetName:t})).id);let n={dataset_id:e};J(e);let i=JSON.stringify(n),a=yield(yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}/datasets/${e}/share`,m(l({method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:i}));return yield L(o,"share dataset"),o}))).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a})}unshareDataset(e){return f(this,null,function*(){J(e),yield this.caller.call(()=>f(this,null,function*(){let t=yield this._fetch(`${this.apiUrl}/datasets/${e}/share`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(t,"unshare dataset",!0),t}))})}readSharedDataset(e){return f(this,null,function*(){return J(e),yield(yield this.caller.call(()=>f(this,null,function*(){let i=yield this._fetch(`${this.apiUrl}/public/${e}/datasets`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(i,"read shared dataset"),i}))).json()})}listSharedExamples(e,t){return f(this,null,function*(){let n={};t?.exampleIds&&(n.id=t.exampleIds);let i=new URLSearchParams;Object.entries(n).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>i.append(o,c)):i.append(o,u)});let s=yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}/public/${e}/examples?${i.toString()}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(o,"list shared examples"),o})),a=yield s.json();if(!s.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return a.map(o=>m(l({},o),{_hostUrl:this.getHostUrl()}))})}createProject(o){return f(this,arguments,function*({projectName:e,description:t=null,metadata:n=null,upsert:i=!1,projectExtra:s=null,referenceDatasetId:a=null}){let u=i?"?upsert=true":"",c=`${this.apiUrl}/sessions${u}`,d=s||{};n&&(d.metadata=n);let p={name:e,extra:d,description:t};a!==null&&(p.reference_dataset_id=a);let h=JSON.stringify(p);return yield(yield this.caller.call(()=>f(this,null,function*(){let b=yield this._fetch(c,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:h}));return yield L(b,"create project"),b}))).json()})}updateProject(o,u){return f(this,arguments,function*(e,{name:t=null,description:n=null,metadata:i=null,projectExtra:s=null,endTime:a=null}){let c=`${this.apiUrl}/sessions/${e}`,d=s;i&&(d=m(l({},d||{}),{metadata:i}));let p=JSON.stringify({name:t,extra:d,description:n,end_time:a?new Date(a).toISOString():null});return yield(yield this.caller.call(()=>f(this,null,function*(){let _=yield this._fetch(c,m(l({method:"PATCH",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:p}));return yield L(_,"update project"),_}))).json()})}hasProject(n){return f(this,arguments,function*({projectId:e,projectName:t}){let i="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)J(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let a=yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}${i}?${s}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(o,"has project"),o}));try{let o=yield a.json();return a.ok?Array.isArray(o)?o.length>0:!0:!1}catch{return!1}})}readProject(i){return f(this,arguments,function*({projectId:e,projectName:t,includeStats:n}){let s="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)J(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&a.append("include_stats",n.toString());let o=yield this._get(s,a),u;if(Array.isArray(o)){if(o.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);u=o[0]}else u=o;return u})}getProjectUrl(n){return f(this,arguments,function*({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let i=yield this.readProject({projectId:e,projectName:t}),s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i.id}`})}getDatasetUrl(n){return f(this,arguments,function*({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let i=yield this.readDataset({datasetId:e,datasetName:t}),s=yield this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${i.id}`})}_getTenantId(){return f(this,null,function*(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});try{for(var t=X(this._getPaginated("/sessions",e)),n,i,s;n=!(i=yield t.next()).done;n=!1){let a=i.value;return this._tenantId=a[0].tenant_id,a[0].tenant_id}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield i.call(t))}finally{if(s)throw s[0]}}throw new Error("No projects found to resolve tenant.")})}listProjects(){return H(this,arguments,function*({projectIds:e,name:t,nameContains:n,referenceDatasetId:i,referenceDatasetName:s,includeStats:a,datasetVersion:o,referenceFree:u,metadata:c}={}){let d=new URLSearchParams;if(e!==void 0)for(let b of e)d.append("id",b);if(t!==void 0&&d.append("name",t),n!==void 0&&d.append("name_contains",n),i!==void 0)d.append("reference_dataset",i);else if(s!==void 0){let b=yield new x(this.readDataset({datasetName:s}));d.append("reference_dataset",b.id)}a!==void 0&&d.append("include_stats",a.toString()),o!==void 0&&d.append("dataset_version",o),u!==void 0&&d.append("reference_free",u.toString()),c!==void 0&&d.append("metadata",JSON.stringify(c));try{for(var p=X(this._getPaginated("/sessions",d)),h,g,_;h=!(g=yield new x(p.next())).done;h=!1){let b=g.value;yield*ve(b)}}catch{_=[g]}finally{try{h&&(g=p.return)&&(yield new x(g.call(p)))}finally{if(_)throw _[0]}}})}deleteProject(n){return f(this,arguments,function*({projectId:e,projectName:t}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?i=(yield this.readProject({projectName:t})).id:i=e,J(i),yield this.caller.call(()=>f(this,null,function*(){let s=yield this._fetch(`${this.apiUrl}/sessions/${i}`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(s,`delete session ${i} (${t})`,!0),s}))})}uploadCsv(u){return f(this,arguments,function*({csvFile:e,fileName:t,inputKeys:n,outputKeys:i,description:s,dataType:a,name:o}){let c=`${this.apiUrl}/datasets/upload`,d=new FormData;return d.append("file",e,t),n.forEach(g=>{d.append("input_keys",g)}),i.forEach(g=>{d.append("output_keys",g)}),s&&d.append("description",s),a&&d.append("data_type",a),o&&d.append("name",o),yield(yield this.caller.call(()=>f(this,null,function*(){let g=yield this._fetch(c,m(l({method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:d}));return yield L(g,"upload CSV"),g}))).json()})}createDataset(o){return f(this,arguments,function*(e,{description:t,dataType:n,inputsSchema:i,outputsSchema:s,metadata:a}={}){let u={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(u.data_type=n),i&&(u.inputs_schema_definition=i),s&&(u.outputs_schema_definition=s);let c=JSON.stringify(u);return yield(yield this.caller.call(()=>f(this,null,function*(){let h=yield this._fetch(`${this.apiUrl}/datasets`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:c}));return yield L(h,"create dataset"),h}))).json()})}readDataset(n){return f(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets",s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)J(e),i+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let a=yield this._get(i,s),o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o})}hasDataset(n){return f(this,arguments,function*({datasetId:e,datasetName:t}){try{return yield this.readDataset({datasetId:e,datasetName:t}),!0}catch(i){if(i instanceof Error&&i.message.toLocaleLowerCase().includes("not found"))return!1;throw i}})}diffDatasetVersions(s){return f(this,arguments,function*({datasetId:e,datasetName:t,fromVersion:n,toVersion:i}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(yield this.readDataset({datasetName:t})).id);let o=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return yield this._get(`/datasets/${a}/versions/diff`,o)})}readDatasetOpenaiFinetuning(n){return f(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets";if(e===void 0)if(t!==void 0)e=(yield this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(yield(yield this._getResponse(`${i}/${e}/openai_ft`)).text()).trim().split(`
`).map(u=>JSON.parse(u))})}listDatasets(){return H(this,arguments,function*({limit:e=100,offset:t=0,datasetIds:n,datasetName:i,datasetNameContains:s,metadata:a}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let g of n)u.append("id",g);i!==void 0&&u.append("name",i),s!==void 0&&u.append("name_contains",s),a!==void 0&&u.append("metadata",JSON.stringify(a));try{for(var c=X(this._getPaginated(o,u)),d,p,h;d=!(p=yield new x(c.next())).done;d=!1){let g=p.value;yield*ve(g)}}catch{h=[p]}finally{try{d&&(p=c.return)&&(yield new x(p.call(c)))}finally{if(h)throw h[0]}}})}updateDataset(e){return f(this,null,function*(){let u=e,{datasetId:t,datasetName:n}=u,i=se(u,["datasetId","datasetName"]);if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let s=t??(yield this.readDataset({datasetName:n})).id;J(s);let a=JSON.stringify(i);return yield(yield this.caller.call(()=>f(this,null,function*(){let c=yield this._fetch(`${this.apiUrl}/datasets/${s}`,m(l({method:"PATCH",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:a}));return yield L(c,"update dataset"),c}))).json()})}updateDatasetTag(e){return f(this,null,function*(){let{datasetId:t,datasetName:n,asOf:i,tag:s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let a=t??(yield this.readDataset({datasetName:n})).id;J(a);let o=JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:s});yield this.caller.call(()=>f(this,null,function*(){let u=yield this._fetch(`${this.apiUrl}/datasets/${a}/tags`,m(l({method:"PUT",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:o}));return yield L(u,"update dataset tags",!0),u}))})}deleteDataset(n){return f(this,arguments,function*({datasetId:e,datasetName:t}){let i="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(yield this.readDataset({datasetName:t})).id),s!==void 0)J(s),i+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");yield this.caller.call(()=>f(this,null,function*(){let a=yield this._fetch(this.apiUrl+i,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(a,`delete ${i}`,!0),a}))})}indexDataset(i){return f(this,arguments,function*({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(yield this.readDataset({datasetName:t})).id),J(s);let o=JSON.stringify({tag:n});yield(yield this.caller.call(()=>f(this,null,function*(){let c=yield this._fetch(`${this.apiUrl}/datasets/${s}/index`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:o}));return yield L(c,"index dataset"),c}))).json()})}similarExamples(s,a,o){return f(this,arguments,function*(e,t,n,{filter:i}={}){let u={limit:n,inputs:e};i!==void 0&&(u.filter=i),J(t);let c=JSON.stringify(u);return(yield(yield this.caller.call(()=>f(this,null,function*(){let h=yield this._fetch(`${this.apiUrl}/datasets/${t}/search`,m(l({headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{method:"POST",body:c}));return yield L(h,"fetch similar examples"),h}))).json()).examples})}createExample(e,t,n){return f(this,null,function*(){if(Jd(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let i=t?n?.datasetId:e.dataset_id,s=t?n?.datasetName:e.dataset_name;if(i===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(yield this.readDataset({datasetName:s})).id);let a=(t?n?.createdAt:e.created_at)||new Date,o;Jd(e)?o=e:o={inputs:e,outputs:t,created_at:a?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let u=yield this._uploadExamplesMultipart(i,[o]);return yield this.readExample(u.example_ids?.[0]??de())})}createExamples(e){return f(this,null,function*(){if(Array.isArray(e)){if(e.length===0)return[];let w=e,T=w[0].dataset_id,N=w[0].dataset_name;if(T===void 0&&N===void 0)throw new Error("Must provide either datasetName or datasetId");if(T!==void 0&&N!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");T===void 0&&(T=(yield this.readDataset({datasetName:N})).id);let U=yield this._uploadExamplesMultipart(T,w);return yield Promise.all(U.example_ids.map(ee=>this.readExample(ee)))}let{inputs:t,outputs:n,metadata:i,splits:s,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:d,datasetId:p,datasetName:h}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let g=p,_=h;if(g===void 0&&_===void 0)throw new Error("Must provide either datasetName or datasetId");if(g!==void 0&&_!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");g===void 0&&(g=(yield this.readDataset({datasetName:_})).id);let b=t.map((w,T)=>({dataset_id:g,inputs:w,outputs:n?.[T],metadata:i?.[T],split:s?.[T],id:d?.[T],attachments:c?.[T],source_run_id:a?.[T],use_source_run_io:o?.[T],use_source_run_attachments:u?.[T]})),y=yield this._uploadExamplesMultipart(g,b);return yield Promise.all(y.example_ids.map(w=>this.readExample(w)))})}createLLMExample(e,t,n){return f(this,null,function*(){return this.createExample({input:e},{output:t},n)})}createChatExample(e,t,n){return f(this,null,function*(){let i=e.map(a=>ka(a)?Ra(a):a),s=ka(t)?Ra(t):t;return this.createExample({input:i},{output:s},n)})}readExample(e){return f(this,null,function*(){J(e);let t=`/examples/${e}`,o=yield this._get(t),{attachment_urls:i}=o,a=se(o,["attachment_urls"]);return i&&(a.attachments=Object.entries(i).reduce((u,[c,d])=>(u[c.slice(11)]={presigned_url:d.presigned_url,mime_type:d.mime_type},u),{})),a})}listExamples(){return H(this,arguments,function*({datasetId:e,datasetName:t,exampleIds:n,asOf:i,splits:s,inlineS3Urls:a,metadata:o,limit:u,offset:c,filter:d,includeAttachments:p}={}){let h;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(t!==void 0)h=(yield new x(this.readDataset({datasetName:t}))).id;else throw new Error("Must provide a datasetName or datasetId");let g=new URLSearchParams({dataset:h}),_=i?typeof i=="string"?i:i?.toISOString():void 0;_&&g.append("as_of",_);let b=a??!0;if(g.append("inline_s3_urls",b.toString()),n!==void 0)for(let M of n)g.append("id",M);if(s!==void 0)for(let M of s)g.append("splits",M);if(o!==void 0){let M=JSON.stringify(o);g.append("metadata",M)}u!==void 0&&g.append("limit",u.toString()),c!==void 0&&g.append("offset",c.toString()),d!==void 0&&g.append("filter",d),p===!0&&["attachment_urls","outputs","metadata"].forEach(M=>g.append("select",M));let y=0;try{for(var w=X(this._getPaginated("/examples",g)),T,N,U;T=!(N=yield new x(w.next())).done;T=!1){let M=N.value;for(let ee of M){let v=ee,{attachment_urls:G}=v,Ge=se(v,["attachment_urls"]);G&&(Ge.attachments=Object.entries(G).reduce((We,[pe,be])=>(We[pe.slice(11)]={presigned_url:be.presigned_url,mime_type:be.mime_type||void 0},We),{})),yield Ge,y++}if(u!==void 0&&y>=u)break}}catch{U=[N]}finally{try{T&&(N=w.return)&&(yield new x(N.call(w)))}finally{if(U)throw U[0]}}})}deleteExample(e){return f(this,null,function*(){J(e);let t=`/examples/${e}`;yield this.caller.call(()=>f(this,null,function*(){let n=yield this._fetch(this.apiUrl+t,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(n,`delete ${t}`,!0),n}))})}updateExample(e,t){return f(this,null,function*(){let n;t?n=e:n=e.id,J(n);let i;t?i=l({id:n},t):i=e;let s;return i.dataset_id!==void 0?s=i.dataset_id:s=(yield this.readExample(n)).dataset_id,this._updateExamplesMultipart(s,[i])})}updateExamples(e){return f(this,null,function*(){let t;return e[0].dataset_id===void 0?t=(yield this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)})}readDatasetVersion(s){return f(this,arguments,function*({datasetId:e,datasetName:t,asOf:n,tag:i}){let a;if(e?a=e:a=(yield this.readDataset({datasetName:t})).id,J(a),n&&i||!n&&!i)throw new Error("Exactly one of asOf and tag must be specified.");let o=new URLSearchParams;return n!==void 0&&o.append("as_of",typeof n=="string"?n:n.toISOString()),i!==void 0&&o.append("tag",i),yield(yield this.caller.call(()=>f(this,null,function*(){let c=yield this._fetch(`${this.apiUrl}/datasets/${a}/version?${o.toString()}`,l({method:"GET",headers:l({},this.headers),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(c,"read dataset version"),c}))).json()})}listDatasetSplits(i){return f(this,arguments,function*({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(yield this.readDataset({datasetName:t})).id:s=e,J(s);let a=new URLSearchParams,o=n?typeof n=="string"?n:n?.toISOString():void 0;return o&&a.append("as_of",o),yield this._get(`/datasets/${s}/splits`,a)})}updateDatasetSplits(a){return f(this,arguments,function*({datasetId:e,datasetName:t,splitName:n,exampleIds:i,remove:s=!1}){let o;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?o=(yield this.readDataset({datasetName:t})).id:o=e,J(o);let u={split_name:n,examples:i.map(d=>(J(d),d)),remove:s},c=JSON.stringify(u);yield this.caller.call(()=>f(this,null,function*(){let d=yield this._fetch(`${this.apiUrl}/datasets/${o}/splits`,m(l({method:"PUT",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:c}));return yield L(d,"update dataset splits",!0),d}))})}evaluateRun(a,o){return f(this,arguments,function*(e,t,{sourceInfo:n,loadChildRuns:i,referenceExample:s}={loadChildRuns:!1}){Sr("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let u;if(typeof e=="string")u=yield this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)u=e;else throw new Error(`Invalid run type: ${typeof e}`);u.reference_example_id!==null&&u.reference_example_id!==void 0&&(s=yield this.readExample(u.reference_example_id));let c=yield t.evaluateRun(u,s),[d,p]=yield this._logEvaluationFeedback(c,u,n);return p[0]})}createFeedback(_,b,y){return f(this,arguments,function*(e,t,{score:n,value:i,correction:s,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:p,projectId:h,comparativeExperimentId:g}){if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");let v={type:u??"api",metadata:o??{}};c!==void 0&&v?.metadata!==void 0&&!v.metadata.__run&&(v.metadata.__run={run_id:c}),v?.metadata!==void 0&&v.metadata.__run?.run_id!==void 0&&J(v.metadata.__run.run_id);let w={id:d??de(),run_id:e,key:t,score:Vd(n),value:i,correction:s,comment:a,feedback_source:v,comparative_experiment_id:g,feedbackConfig:p,session_id:h},T=JSON.stringify(w),N=`${this.apiUrl}/feedback`;return yield this.caller.call(()=>f(this,null,function*(){let U=yield this._fetch(N,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:T}));return yield L(U,"create feedback",!0),U})),w})}updateFeedback(a,o){return f(this,arguments,function*(e,{score:t,value:n,correction:i,comment:s}){let u={};t!=null&&(u.score=Vd(t)),n!=null&&(u.value=n),i!=null&&(u.correction=i),s!=null&&(u.comment=s),J(e);let c=JSON.stringify(u);yield this.caller.call(()=>f(this,null,function*(){let d=yield this._fetch(`${this.apiUrl}/feedback/${e}`,m(l({method:"PATCH",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:c}));return yield L(d,"update feedback",!0),d}))})}readFeedback(e){return f(this,null,function*(){J(e);let t=`/feedback/${e}`;return yield this._get(t)})}deleteFeedback(e){return f(this,null,function*(){J(e);let t=`/feedback/${e}`;yield this.caller.call(()=>f(this,null,function*(){let n=yield this._fetch(this.apiUrl+t,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(n,`delete ${t}`,!0),n}))})}listFeedback(){return H(this,arguments,function*({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let i=new URLSearchParams;if(e)for(let c of e)J(c),i.append("run",c);if(t)for(let c of t)i.append("key",c);if(n)for(let c of n)i.append("source",c);try{for(var s=X(this._getPaginated("/feedback",i)),a,o,u;a=!(o=yield new x(s.next())).done;a=!1){let c=o.value;yield*ve(c)}}catch{u=[o]}finally{try{a&&(o=s.return)&&(yield new x(o.call(s)))}finally{if(u)throw u[0]}}})}createPresignedFeedbackToken(s,a){return f(this,arguments,function*(e,t,{expiration:n,feedbackConfig:i}={}){let o={run_id:e,feedback_key:t,feedback_config:i};n?typeof n=="string"?o.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(o.expires_in=n):o.expires_in={hours:3};let u=JSON.stringify(o);return yield(yield this.caller.call(()=>f(this,null,function*(){let d=yield this._fetch(`${this.apiUrl}/feedback/tokens`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:u}));return yield L(d,"create presigned feedback token"),d}))).json()})}createComparativeExperiment(u){return f(this,arguments,function*({name:e,experimentIds:t,referenceDatasetId:n,createdAt:i,description:s,metadata:a,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(yield this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let c={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:s,created_at:(i??new Date)?.toISOString(),extra:{}};a&&(c.extra.metadata=a);let d=JSON.stringify(c);return(yield this.caller.call(()=>f(this,null,function*(){let h=yield this._fetch(`${this.apiUrl}/datasets/comparative`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:d}));return yield L(h,"create comparative experiment"),h}))).json()})}listPresignedFeedbackTokens(e){return H(this,null,function*(){J(e);let t=new URLSearchParams({run_id:e});try{for(var n=X(this._getPaginated("/feedback/tokens",t)),i,s,a;i=!(s=yield new x(n.next())).done;i=!1){let o=s.value;yield*ve(o)}}catch{a=[s]}finally{try{i&&(s=n.return)&&(yield new x(s.call(n)))}finally{if(a)throw a[0]}}})}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}_logEvaluationFeedback(e,t,n){return f(this,null,function*(){let i=this._selectEvalResults(e),s=[];for(let a of i){let o=n||{};a.evaluatorInfo&&(o=l(l({},a.evaluatorInfo),o));let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),s.push(yield this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[i,s]})}logEvaluationFeedback(e,t,n){return f(this,null,function*(){let[i]=yield this._logEvaluationFeedback(e,t,n);return i})}listAnnotationQueues(){return H(this,arguments,function*(e={}){let{queueIds:t,name:n,nameContains:i,limit:s}=e,a=new URLSearchParams;t&&t.forEach((h,g)=>{J(h,`queueIds[${g}]`),a.append("ids",h)}),n&&a.append("name",n),i&&a.append("name_contains",i),a.append("limit",(s!==void 0?Math.min(s,100):100).toString());let o=0;try{for(var u=X(this._getPaginated("/annotation-queues",a)),c,d,p;c=!(d=yield new x(u.next())).done;c=!1){let h=d.value;if(yield*ve(h),o++,s!==void 0&&o>=s)break}}catch{p=[d]}finally{try{c&&(d=u.return)&&(yield new x(d.call(u)))}finally{if(p)throw p[0]}}})}createAnnotationQueue(e){return f(this,null,function*(){let{name:t,description:n,queueId:i,rubricInstructions:s}=e,a={name:t,description:n,id:i||de(),rubric_instructions:s},o=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([c,d])=>d!==void 0)));return(yield this.caller.call(()=>f(this,null,function*(){let c=yield this._fetch(`${this.apiUrl}/annotation-queues`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:o}));return yield L(c,"create annotation queue"),c}))).json()})}readAnnotationQueue(e){return f(this,null,function*(){return(yield this.caller.call(()=>f(this,null,function*(){let n=yield this._fetch(`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(n,"read annotation queue"),n}))).json()})}updateAnnotationQueue(e,t){return f(this,null,function*(){let{name:n,description:i,rubricInstructions:s}=t,a=JSON.stringify({name:n,description:i,rubric_instructions:s});yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,m(l({method:"PATCH",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:a}));return yield L(o,"update annotation queue",!0),o}))})}deleteAnnotationQueue(e){return f(this,null,function*(){yield this.caller.call(()=>f(this,null,function*(){let t=yield this._fetch(`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,l({method:"DELETE",headers:m(l({},this.headers),{Accept:"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(t,"delete annotation queue",!0),t}))})}addRunsToAnnotationQueue(e,t){return f(this,null,function*(){let n=JSON.stringify(t.map((i,s)=>J(i,`runIds[${s}]`).toString()));yield this.caller.call(()=>f(this,null,function*(){let i=yield this._fetch(`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/runs`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:n}));return yield L(i,"add runs to annotation queue",!0),i}))})}getRunFromAnnotationQueue(e,t){return f(this,null,function*(){let n=`/annotation-queues/${J(e,"queueId")}/run`;return(yield this.caller.call(()=>f(this,null,function*(){let s=yield this._fetch(`${this.apiUrl}${n}/${t}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(s,"get run from annotation queue"),s}))).json()})}deleteRunFromAnnotationQueue(e,t){return f(this,null,function*(){yield this.caller.call(()=>f(this,null,function*(){let n=yield this._fetch(`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/runs/${J(t,"queueRunId")}`,l({method:"DELETE",headers:m(l({},this.headers),{Accept:"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(n,"delete run from annotation queue",!0),n}))})}getSizeFromAnnotationQueue(e){return f(this,null,function*(){return(yield this.caller.call(()=>f(this,null,function*(){let n=yield this._fetch(`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/size`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(n,"get size from annotation queue"),n}))).json()})}_currentTenantIsOwner(e){return f(this,null,function*(){let t=yield this._getSettings();return e=="-"||t.tenant_handle===e})}_ownerConflictError(e,t){return f(this,null,function*(){let n=yield this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)})}_getLatestCommitHash(e){return f(this,null,function*(){let n=yield(yield this.caller.call(()=>f(this,null,function*(){let i=yield this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(i,"get latest commit hash"),i}))).json();if(n.commits.length!==0)return n.commits[0].commit_hash})}_likeOrUnlikePrompt(e,t){return f(this,null,function*(){let[n,i,s]=kt(e),a=JSON.stringify({like:t});return(yield this.caller.call(()=>f(this,null,function*(){let u=yield this._fetch(`${this.apiUrl}/likes/${n}/${i}`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:a}));return yield L(u,`${t?"like":"unlike"} prompt`),u}))).json()})}_getPromptUrl(e){return f(this,null,function*(){let[t,n,i]=kt(e);if(yield this._currentTenantIsOwner(t)){let s=yield this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${n}/${i.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${s.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`})}promptExists(e){return f(this,null,function*(){return!!(yield this.getPrompt(e))})}likePrompt(e){return f(this,null,function*(){return this._likeOrUnlikePrompt(e,!0)})}unlikePrompt(e){return f(this,null,function*(){return this._likeOrUnlikePrompt(e,!1)})}listCommits(e){return H(this,null,function*(){try{for(var t=X(this._getPaginated(`/commits/${e}/`,new URLSearchParams,o=>o.commits)),n,i,s;n=!(i=yield new x(t.next())).done;n=!1){let a=i.value;yield*ve(a)}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield new x(i.call(t)))}finally{if(s)throw s[0]}}})}listPrompts(e){return H(this,null,function*(){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);try{for(var n=X(this._getPaginated("/repos",t,u=>u.repos)),i,s,a;i=!(s=yield new x(n.next())).done;i=!1){let o=s.value;yield*ve(o)}}catch{a=[s]}finally{try{i&&(s=n.return)&&(yield new x(s.call(n)))}finally{if(a)throw a[0]}}})}getPrompt(e){return f(this,null,function*(){let[t,n,i]=kt(e),a=yield(yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}/repos/${t}/${n}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return o?.status===404?null:(yield L(o,"get prompt"),o)})))?.json();return a?.repo?a.repo:null})}createPrompt(e,t){return f(this,null,function*(){let n=yield this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,s,a]=kt(e);if(!(yield this._currentTenantIsOwner(i)))throw yield this._ownerConflictError("create a prompt",i);let o=m(l(l(l({repo_handle:s},t?.description&&{description:t.description}),t?.readme&&{readme:t.readme}),t?.tags&&{tags:t.tags}),{is_public:!!t?.isPublic}),u=JSON.stringify(o),c=yield this.caller.call(()=>f(this,null,function*(){let p=yield this._fetch(`${this.apiUrl}/repos/`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:u}));return yield L(p,"create prompt"),p})),{repo:d}=yield c.json();return d})}createCommit(e,t,n){return f(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[i,s,a]=kt(e),o=n?.parentCommitHash==="latest"||!n?.parentCommitHash?yield this._getLatestCommitHash(`${i}/${s}`):n?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=JSON.stringify(u),p=yield(yield this.caller.call(()=>f(this,null,function*(){let h=yield this._fetch(`${this.apiUrl}/commits/${i}/${s}`,m(l({method:"POST",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:c}));return yield L(h,"create commit"),h}))).json();return this._getPromptUrl(`${i}/${s}${p.commit_hash?`:${p.commit_hash}`:""}`)})}updateExamplesMultipart(n){return f(this,arguments,function*(e,t=[]){return this._updateExamplesMultipart(e,t)})}_updateExamplesMultipart(n){return f(this,arguments,function*(e,t=[]){if(!(yield this._getDatasetExamplesMultiPartSupport()))throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let o of t){let u=o.id,c=l(l({},o.metadata&&{metadata:o.metadata}),o.split&&{split:o.split}),d=Ze(c,`Serializing body for example with id: ${u}`),p=new Blob([d],{type:"application/json"});if(i.append(u,p),o.inputs){let h=Ze(o.inputs,`Serializing inputs for example with id: ${u}`),g=new Blob([h],{type:"application/json"});i.append(`${u}.inputs`,g)}if(o.outputs){let h=Ze(o.outputs,`Serializing outputs whle updating example with id: ${u}`),g=new Blob([h],{type:"application/json"});i.append(`${u}.outputs`,g)}if(o.attachments)for(let[h,g]of Object.entries(o.attachments)){let _,b;Array.isArray(g)?[_,b]=g:(_=g.mimeType,b=g.data);let y=new Blob([b],{type:`${_}; length=${b.byteLength}`});i.append(`${u}.attachment.${h}`,y)}if(o.attachments_operations){let h=Ze(o.attachments_operations,`Serializing attachments while updating example with id: ${u}`),g=new Blob([h],{type:"application/json"});i.append(`${u}.attachments_operations`,g)}}let s=e??t[0]?.dataset_id;return(yield this.caller.call(()=>f(this,null,function*(){let o=yield this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,m(l({method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:i}));return yield L(o,"update examples"),o}))).json()})}uploadExamplesMultipart(n){return f(this,arguments,function*(e,t=[]){return this._uploadExamplesMultipart(e,t)})}_uploadExamplesMultipart(n){return f(this,arguments,function*(e,t=[]){if(!(yield this._getDatasetExamplesMultiPartSupport()))throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let a of t){let o=(a.id??de()).toString(),u=l(l(l(l(l({created_at:a.created_at},a.metadata&&{metadata:a.metadata}),a.split&&{split:a.split}),a.source_run_id&&{source_run_id:a.source_run_id}),a.use_source_run_io&&{use_source_run_io:a.use_source_run_io}),a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}),c=Ze(u,`Serializing body for uploaded example with id: ${o}`),d=new Blob([c],{type:"application/json"});if(i.append(o,d),a.inputs){let p=Ze(a.inputs,`Serializing inputs for uploaded example with id: ${o}`),h=new Blob([p],{type:"application/json"});i.append(`${o}.inputs`,h)}if(a.outputs){let p=Ze(a.outputs,`Serializing outputs for uploaded example with id: ${o}`),h=new Blob([p],{type:"application/json"});i.append(`${o}.outputs`,h)}if(a.attachments)for(let[p,h]of Object.entries(a.attachments)){let g,_;Array.isArray(h)?[g,_]=h:(g=h.mimeType,_=h.data);let b=new Blob([_],{type:`${g}; length=${_.byteLength}`});i.append(`${o}.attachment.${p}`,b)}}return(yield this.caller.call(()=>f(this,null,function*(){let a=yield this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,m(l({method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:i}));return yield L(a,"upload examples"),a}))).json()})}updatePrompt(e,t){return f(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[n,i]=kt(e);if(!(yield this._currentTenantIsOwner(n)))throw yield this._ownerConflictError("update a prompt",n);let s={};if(t?.description!==void 0&&(s.description=t.description),t?.readme!==void 0&&(s.readme=t.readme),t?.tags!==void 0&&(s.tags=t.tags),t?.isPublic!==void 0&&(s.is_public=t.isPublic),t?.isArchived!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");let a=JSON.stringify(s);return(yield this.caller.call(()=>f(this,null,function*(){let u=yield this._fetch(`${this.apiUrl}/repos/${n}/${i}`,m(l({method:"PATCH",headers:m(l({},this.headers),{"Content-Type":"application/json"}),signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions),{body:a}));return yield L(u,"update prompt"),u}))).json()})}deletePrompt(e){return f(this,null,function*(){if(!(yield this.promptExists(e)))throw new Error("Prompt does not exist, you must create it first.");let[t,n,i]=kt(e);if(!(yield this._currentTenantIsOwner(t)))throw yield this._ownerConflictError("delete a prompt",t);return(yield this.caller.call(()=>f(this,null,function*(){let a=yield this._fetch(`${this.apiUrl}/repos/${t}/${n}`,l({method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(a,"delete prompt"),a}))).json()})}pullPromptCommit(e,t){return f(this,null,function*(){let[n,i,s]=kt(e),o=yield(yield this.caller.call(()=>f(this,null,function*(){let u=yield this._fetch(`${this.apiUrl}/commits/${n}/${i}/${s}${t?.includeModel?"?include_model=true":""}`,l({method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)},this.fetchOptions));return yield L(u,"pull prompt commit"),u}))).json();return{owner:n,repo:i,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}})}_pullPrompt(e,t){return f(this,null,function*(){let n=yield this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)})}pushPrompt(e,t){return f(this,null,function*(){return(yield this.promptExists(e))?t&&Object.keys(t).some(i=>i!=="object")&&(yield this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic})):yield this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?yield this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):yield this._getPromptUrl(e)})}clonePublicDataset(n){return f(this,arguments,function*(e,t={}){let{sourceApiUrl:i=this.apiUrl,datasetName:s}=t,[a,o]=this.parseTokenOrUrl(e,i),u=new r({apiUrl:a,apiKey:"placeholder"}),c=yield u.readSharedDataset(o),d=s||c.name;try{if(yield this.hasDataset({datasetId:d})){console.log(`Dataset ${d} already exists in your tenant. Skipping.`);return}}catch{}let p=yield u.listSharedExamples(o),h=yield this.createDataset(d,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{yield this.createExamples({inputs:p.map(g=>g.inputs),outputs:p.flatMap(g=>g.outputs?[g.outputs]:[]),datasetId:h.id})}catch(g){throw console.error(`An error occurred while creating dataset ${d}. You should delete it manually.`),g}})}parseTokenOrUrl(e,t,n=2,i="dataset"){try{return J(e),[t,e]}catch{}try{let a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){let o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return f(this,null,function*(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();yield Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&(yield Dc()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush())})}};function Jd(r){return"dataset_id"in r||"dataset_name"in r}var Kd=r=>r!==void 0?r:!!["TRACING_V2","TRACING"].find(t=>fe(t)==="true");var Li=Symbol.for("lc:context_variables");function Ab(r){return r.replace(/[-:.]/g,"")}function Xd(r,e=1){let t=e.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(r).toISOString().slice(0,-1)}${t}Z`}function to(r,e,t=1){let n=Xd(r,t);return{dottedOrder:Ab(n)+e,microsecondPrecisionDatestring:n}}var zi=class r{constructor(e,t,n,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=i}static fromHeader(e){let t=e.split(","),n={},i=[],s,a;for(let o of t){let[u,c]=o.split("="),d=decodeURIComponent(c);u==="langsmith-metadata"?n=JSON.parse(d):u==="langsmith-tags"?i=d.split(","):u==="langsmith-project"?s=d:u==="langsmith-replicas"&&(a=JSON.parse(d))}return new r(n,i,s,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},ct=class r{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Qd(e)){Object.assign(this,l({},e));return}let t=r.getDefaultConfig(),o=e,{metadata:n}=o,i=se(o,["metadata"]),s=i.client??r.getSharedClient(),a=l(l({},n),i?.extra?.metadata);if(i.extra=m(l({},i.extra),{metadata:a}),"id"in i&&i.id==null&&delete i.id,Object.assign(this,m(l(l({},t),i),{client:s})),this.execution_order??=1,this.child_execution_order??=1,this.dotted_order||(this._serialized_start_time=Xd(this.start_time,this.execution_order)),this.id||(this.id=ci(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=Nb(this.replicas),!this.dotted_order){let{dottedOrder:u}=to(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}set metadata(e){this.extra=m(l({},this.extra),{metadata:l(l({},this.extra?.metadata),e)})}get metadata(){return this.extra?.metadata}static getDefaultConfig(){let e=Date.now();return{run_type:"chain",project_name:Xr(),child_runs:[],api_url:qe("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:qe("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return r.sharedClient||(r.sharedClient=new rr),r.sharedClient}createChild(e){let t=this.child_execution_order+1,n=new r(m(l({},e),{parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t}));Li in this&&(n[Li]=this[Li]);let i=Symbol.for("lc:child_config"),s=e.extra?.[i]??this.extra[i];if(kb(s)){let u=l({},s),c=Pb(u.callbacks)?u.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:n.id}),c.handlers?.find(ef)?.updateFromRunTree?.(n),u.callbacks=c),n.extra[i]=u}let a=new Set,o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}end(s,a){return f(this,arguments,function*(e,t,n=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,i&&Object.keys(i).length>0&&(this.extra=this.extra?m(l({},this.extra),{metadata:l(l({},this.extra.metadata),i)}):{metadata:i})})}_convertToCreate(e,t,n=!0){let i=e.extra??{};if(i?.runtime?.library===void 0&&(i.runtime||(i.runtime={}),t))for(let[o,u]of Object.entries(t))i.runtime[o]||(i.runtime[o]=u);let s,a;return n?(a=e.parent_run?.id??e.parent_run_id,s=[]):(s=e.child_runs.map(o=>this._convertToCreate(o,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){let i=this._convertToCreate(this,t,n);return m(l({},i),{session_name:e})}postRun(e=!0){return f(this,null,function*(){try{let t=di();if(this.replicas&&this.replicas.length>0)for(let{projectName:n,apiKey:i,apiUrl:s,workspaceId:a}of this.replicas){let o=this._remapForProject(n??this.project_name,t,!0);yield this.client.createRun(o,{apiKey:i,apiUrl:s,workspaceId:a})}else{let n=this._convertToCreate(this,t,e);yield this.client.createRun(n)}if(!e){Sr("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let n of this.child_runs)yield n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}})}patchRun(e){return f(this,null,function*(){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:n,apiUrl:i,workspaceId:s,updates:a}of this.replicas){let o=this._remapForProject(t??this.project_name),u=l({id:o.id,name:o.name,run_type:o.run_type,start_time:o.start_time,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments},a);e?.excludeInputs||(u.inputs=o.inputs),yield this.client.updateRun(o.id,u,{apiKey:n,apiUrl:i,workspaceId:s})}else try{let t={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),yield this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}})}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push(m(l({},e),{time:e.time??new Date().toISOString()}))}static fromRunnableConfig(e,t){let n=e?.callbacks,i,s,a,o=Kd();if(n){let c=n?.getParentRunId?.()??"",d=n?.handlers?.find(p=>p?.name=="langchain_tracer");i=d?.getRun?.(c),s=d?.projectName,a=d?.client,o=o||!!d}return i?new r({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:o,project_name:s,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:l(l({},i?.extra?.metadata),e?.metadata)}}).createChild(t):new r(m(l({},t),{client:a,tracingEnabled:o,project_name:s}))}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=n["langsmith-trace"];if(!i||typeof i!="string")return;let s=i.trim(),a=s.split(".").map(c=>{let[d,p]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:p}}),o=a[0].uuid,u=m(l({},t),{name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:o,dotted_order:s});if(n.baggage&&typeof n.baggage=="string"){let c=zi.fromHeader(n.baggage);u.metadata=c.metadata,u.tags=c.tags,u.project_name=c.project_name,u.replicas=c.replicas}return new r(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new zi(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[n,i]of Object.entries(t))e.set(n,i);return t}};Object.defineProperty(ct,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function Qd(r){return r!=null&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function ef(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function Yd(r){return Array.isArray(r)&&r.some(e=>ef(e))}function Pb(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function kb(r){return r!=null&&typeof r.callbacks=="object"&&(Yd(r.callbacks?.handlers)||Yd(r.callbacks))}function Rb(){let r=qe("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{let e=JSON.parse(r);if(Array.isArray(e)){let t=[];for(let n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}t.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return t}else if(typeof e=="object"&&e!==null){Cb(e);let t=[];for(let[n,i]of Object.entries(e)){let s=n.replace(/\/$/,"");if(typeof i=="string")t.push({apiUrl:s,apiKey:i});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof i}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(Fd(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function Nb(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):Rb()}function Cb(r){if(Object.keys(r).length>0&&fe("ENDPOINT"))throw new Ri}var Mb={};we(Mb,{BaseCallbackHandler:()=>Ut,callbackHandlerPrefersStreaming:()=>zb,isBaseCallbackHandler:()=>io});var Lb={};we(Lb,{getEnv:()=>af,getEnvironmentVariable:()=>lt,getRuntimeEnvironment:()=>jb,getRuntimeEnvironmentSync:()=>Di,isBrowser:()=>tf,isDeno:()=>Mi,isJsDom:()=>nf,isNode:()=>sf,isWebWorker:()=>rf});var tf=()=>typeof window<"u"&&typeof window.document<"u",rf=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",nf=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Mi=()=>typeof Deno<"u",sf=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Mi(),af=()=>{let r;return tf()?r="browser":sf()?r="node":rf()?r="webworker":nf()?r="jsdom":Mi()?r="deno":r="other",r},ro;function jb(){return f(this,null,function*(){return Di()})}function Di(){return ro===void 0&&(ro={library:"langchain-js",runtime:af()}),ro}function lt(r){try{return typeof process<"u"?process.env?.[r]:Mi()?Deno?.env.get(r):void 0}catch{return}}var no=class{};function zb(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var Ut=class r extends no{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Pn(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:lt("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Ke.prototype.toJSON.call(this)}toJSONNotImplemented(){return Ke.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:de()}),Object.assign(this,e)}}return new t}},io=r=>{let e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};var Db=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function ao(r,e){if(r)return new ct(m(l({},r),{start_time:r._serialized_start_time??r.start_time,parent_run:ao(e),child_runs:r.child_runs.map(t=>ao(t)).filter(t=>t!==void 0),extra:m(l({},r.extra),{runtime:Di()}),tracingEnabled:!1}))}function so(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function ir(r){return typeof r._addRunToRunMap=="function"}var Ve=class extends Ut{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?Db(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:n}=to(new Date(e.start_time).getTime(),e.id,e.execution_order),i=l({},e),s=this.getRunById(i.parent_run_id);if(i.parent_run_id!==void 0?s&&(this._addChildRun(s,i),s.child_execution_order=Math.max(s.child_execution_order,i.child_execution_order),i.trace_id=s.trace_id,s.dotted_order!==void 0&&(i.dotted_order=[s.dotted_order,t].join("."),i._serialized_start_time=n)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=n),this.usesRunTreeMap){let a=ao(i,s);a!==void 0&&this.runTreeMap.set(i.id,a)}else this.runMap.set(i.id,i);return i}_endTrace(e){return f(this,null,function*(){let t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):yield this.persistRun(e),yield this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)})}_getExecutionOrder(e){let t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,i,s,a,o,u){let c=this._getExecutionOrder(i),d=Date.now(),p=o?m(l({},s),{metadata:o}):s,h={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:p??{},tags:a||[]};return this._addRunToRunMap(h)}handleLLMStart(e,t,n,i,s,a,o,u){return f(this,null,function*(){let c=this.getRunById(n)??this._createRunForLLMStart(e,t,n,i,s,a,o,u);return yield this.onRunCreate?.(c),yield this.onLLMStart?.(c),c})}_createRunForChatModelStart(e,t,n,i,s,a,o,u){let c=this._getExecutionOrder(i),d=Date.now(),p=o?m(l({},s),{metadata:o}):s,h={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:p??{},tags:a||[]};return this._addRunToRunMap(h)}handleChatModelStart(e,t,n,i,s,a,o,u){return f(this,null,function*(){let c=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,i,s,a,o,u);return yield this.onRunCreate?.(c),yield this.onLLMStart?.(c),c})}handleLLMEnd(e,t,n,i,s){return f(this,null,function*(){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra=l(l({},a.extra),s),yield this.onLLMEnd?.(a),yield this._endTrace(a),a})}handleLLMError(e,t,n,i,s){return f(this,null,function*(){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra=l(l({},a.extra),s),yield this.onLLMError?.(a),yield this._endTrace(a),a})}_createRunForChainStart(e,t,n,i,s,a,o,u){let c=this._getExecutionOrder(i),d=Date.now(),p={id:n,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(p)}handleChainStart(e,t,n,i,s,a,o,u){return f(this,null,function*(){let c=this.getRunById(n)??this._createRunForChainStart(e,t,n,i,s,a,o,u);return yield this.onRunCreate?.(c),yield this.onChainStart?.(c),c})}handleChainEnd(e,t,n,i,s){return f(this,null,function*(){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=so(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=so(s.inputs,"input")),yield this.onChainEnd?.(a),yield this._endTrace(a),a})}handleChainError(e,t,n,i,s){return f(this,null,function*(){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=so(s.inputs,"input")),yield this.onChainError?.(a),yield this._endTrace(a),a})}_createRunForToolStart(e,t,n,i,s,a,o){let u=this._getExecutionOrder(i),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(d)}handleToolStart(e,t,n,i,s,a,o){return f(this,null,function*(){let u=this.getRunById(n)??this._createRunForToolStart(e,t,n,i,s,a,o);return yield this.onRunCreate?.(u),yield this.onToolStart?.(u),u})}handleToolEnd(e,t){return f(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onToolEnd?.(n),yield this._endTrace(n),n})}handleToolError(e,t){return f(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onToolError?.(n),yield this._endTrace(n),n})}handleAgentAction(e,t){return f(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="chain")return;let i=n;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentAction?.(n)})}handleAgentEnd(e,t){return f(this,null,function*(){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),yield this.onAgentEnd?.(n))})}_createRunForRetrieverStart(e,t,n,i,s,a,o){let u=this._getExecutionOrder(i),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(d)}handleRetrieverStart(e,t,n,i,s,a,o){return f(this,null,function*(){let u=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,i,s,a,o);return yield this.onRunCreate?.(u),yield this.onRetrieverStart?.(u),u})}handleRetrieverEnd(e,t){return f(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),yield this.onRetrieverEnd?.(n),yield this._endTrace(n),n})}handleRetrieverError(e,t){return f(this,null,function*(){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),yield this.onRetrieverError?.(n),yield this._endTrace(n),n})}handleText(e,t){return f(this,null,function*(){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),yield this.onText?.(n))})}handleLLMNewToken(e,t,n,i,s,a){return f(this,null,function*(){let o=this.getRunById(n);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),yield this.onLLMNewToken?.(o,e,{chunk:a?.chunk}),o})}};var ew={};we(ew,{AsyncGeneratorWithSetup:()=>Et,IterableReadableStream:()=>Te,atee:()=>Wi,concat:()=>dt,pipeGeneratorWithSetup:()=>po});var Yb={};we(Yb,{BaseCallbackManager:()=>Fi,BaseRunManager:()=>or,CallbackManager:()=>it,CallbackManagerForChainRun:()=>Gi,CallbackManagerForLLMRun:()=>cn,CallbackManagerForRetrieverRun:()=>Bi,CallbackManagerForToolRun:()=>qi,TraceGroup:()=>Vi,ensureHandler:()=>Ar,parseCallbackConfigArg:()=>Jb,traceAsGroup:()=>Kb});var Fb={};we(Fb,{ConsoleCallbackHandler:()=>Ir});var oo=gt(lf(),1);function Ce(r,e){return`${r.open}${e}${r.close}`}function nt(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function df(r){return typeof r=="string"?r.trim():r==null?r:nt(r,r.toString())}function Zt(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:Fe}=oo.default,Ir=class extends Ve{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let i=this.runMap.get(n.parent_run_id);if(i)t.push(i),n=i;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((i,s,a)=>{let o=`${i.execution_order}:${i.run_type}:${i.name}`;return s===a.length-1?Ce(oo.default.bold,o):o}).join(" > ");return Ce(Fe.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.green,"[chain/start]")} [${t}] Entering Chain run with input: ${nt(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[chain/end]")} [${t}] [${Zt(e)}] Exiting Chain run with output: ${nt(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[chain/error]")} [${t}] [${Zt(e)}] Chain run errored with error: ${nt(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Ce(Fe.green,"[llm/start]")} [${t}] Entering LLM run with input: ${nt(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[llm/end]")} [${t}] [${Zt(e)}] Exiting LLM run with output: ${nt(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[llm/error]")} [${t}] [${Zt(e)}] LLM run errored with error: ${nt(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.green,"[tool/start]")} [${t}] Entering Tool run with input: "${df(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[tool/end]")} [${t}] [${Zt(e)}] Exiting Tool run with output: "${df(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[tool/error]")} [${t}] [${Zt(e)}] Tool run errored with error: ${nt(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${nt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[retriever/end]")} [${t}] [${Zt(e)}] Exiting Retriever run with output: ${nt(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[retriever/error]")} [${t}] [${Zt(e)}] Retriever run errored with error: ${nt(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Ce(Fe.blue,"[agent/action]")} [${n}] Agent selected action: ${nt(t.actions[t.actions.length-1],"[action]")}`)}};var Bb={};we(Bb,{LangChainTracer:()=>Ft});var uo,Ui=()=>{if(uo===void 0){let r=lt("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};uo=new rr(r)}return uo};var Ft=class r extends Ve{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:n,client:i,replicas:s}=e;this.projectName=n??Xr(),this.replicas=s,this.exampleId=t,this.client=i??Ui();let a=r.getTraceableRunTree();a&&this.updateFromRunTree(a)}persistRun(e){return f(this,null,function*(){})}onRunCreate(e){return f(this,null,function*(){yield this.getRunTreeWithTracingConfig(e.id)?.postRun()})}onRunUpdate(e){return f(this,null,function*(){yield this.getRunTreeWithTracingConfig(e.id)?.patchRun()})}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e,n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();let i=[t];for(;i.length>0;){let s=i.shift();!s||n.has(s.id)||(n.add(s.id),this.runTreeMap.set(s.id,s),s.child_runs&&i.push(...s.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new ct(m(l({},t),{client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0}))}static getTraceableRunTree(){try{return ec(!0)}catch{return}}};var Vb={};we(Vb,{awaitAllCallbacks:()=>hf,consumeCallback:()=>ce});var Zi=gt(bi(),1);var ff=Symbol.for("ls:tracing_async_local_storage"),sr=Symbol.for("lc:context_variables"),pf=r=>{globalThis[ff]=r},Bt=()=>globalThis[ff];var ar;function Gb(){let r="default"in Zi.default?Zi.default.default:Zi.default;return new r({autoStart:!0,concurrency:1})}function qb(){return typeof ar>"u"&&(ar=Gb()),ar}function ce(r,e){return f(this,null,function*(){if(e===!0){let t=Bt();t!==void 0?yield t.run(void 0,()=>f(null,null,function*(){return r()})):yield r()}else ar=qb(),ar.add(()=>f(null,null,function*(){let t=Bt();t!==void 0?yield t.run(void 0,()=>f(null,null,function*(){return r()})):yield r()}))})}function hf(){return f(this,null,function*(){let r=Ui();yield Promise.allSettled([typeof ar<"u"?ar.onIdle():Promise.resolve(),r.awaitPendingTraceBatches()])})}var mf=r=>r!==void 0?r:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>lt(t)==="true");function co(r){let e=Bt();return e===void 0?void 0:e.getStore()?.[sr]?.[r]}var Hb=Symbol("lc:configure_hooks"),gf=()=>co(Hb)||[];function Jb(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var Fi=class{setHandler(e){return this.setHandlers([e])}},or=class{constructor(e,t,n,i,s,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}handleText(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){try{yield t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleCustomEvent(e,t,n,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(a=>ce(()=>f(this,null,function*(){try{yield a.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}},Bi=class extends or{getChild(e){let t=new it(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleRetrieverEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleRetrieverError(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){if(!t.ignoreRetriever)try{yield t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}}),t.awaitHandlers)))})}},cn=class extends or{handleLLMNewToken(e,t,n,i,s,a){return f(this,null,function*(){yield Promise.all(this.handlers.map(o=>ce(()=>f(this,null,function*(){if(!o.ignoreLLM)try{yield o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}}),o.awaitHandlers)))})}handleLLMError(e,t,n,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(a=>ce(()=>f(this,null,function*(){if(!a.ignoreLLM)try{yield a.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}handleLLMEnd(e,t,n,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(a=>ce(()=>f(this,null,function*(){if(!a.ignoreLLM)try{yield a.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}},Gi=class extends or{getChild(e){let t=new it(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleChainError(e,t,n,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(a=>ce(()=>f(this,null,function*(){if(!a.ignoreChain)try{yield a.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}handleChainEnd(e,t,n,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(a=>ce(()=>f(this,null,function*(){if(!a.ignoreChain)try{yield a.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}handleAgentAction(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleAgentEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}},qi=class extends or{getChild(e){let t=new it(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}handleToolError(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}handleToolEnd(e){return f(this,null,function*(){yield Promise.all(this.handlers.map(t=>ce(()=>f(this,null,function*(){if(!t.ignoreAgent)try{yield t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}}),t.awaitHandlers)))})}},it=class r extends Fi{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}handleLLMStart(e,t,n=void 0,i=void 0,s=void 0,a=void 0,o=void 0,u=void 0){return f(this,null,function*(){return Promise.all(t.map((c,d)=>f(this,null,function*(){let p=d===0&&n?n:de();return yield Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return ir(h)&&h._createRunForLLMStart(e,[c],p,this._parentRunId,s,this.tags,this.metadata,u),ce(()=>f(this,null,function*(){try{yield h.handleLLMStart?.(e,[c],p,this._parentRunId,s,this.tags,this.metadata,u)}catch(g){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${g}`),h.raiseError)throw g}}),h.awaitHandlers)})),new cn(p,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChatModelStart(e,t,n=void 0,i=void 0,s=void 0,a=void 0,o=void 0,u=void 0){return f(this,null,function*(){return Promise.all(t.map((c,d)=>f(this,null,function*(){let p=d===0&&n?n:de();return yield Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return ir(h)&&h._createRunForChatModelStart(e,[c],p,this._parentRunId,s,this.tags,this.metadata,u),ce(()=>f(this,null,function*(){try{if(h.handleChatModelStart)yield h.handleChatModelStart?.(e,[c],p,this._parentRunId,s,this.tags,this.metadata,u);else if(h.handleLLMStart){let g=Dn(c);yield h.handleLLMStart?.(e,[g],p,this._parentRunId,s,this.tags,this.metadata,u)}}catch(g){if((h.raiseError?console.error:console.warn)(`Error in handler ${h.constructor.name}, handleLLMStart: ${g}`),h.raiseError)throw g}}),h.awaitHandlers)})),new cn(p,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))})}handleChainStart(u,c){return f(this,arguments,function*(e,t,n=de(),i=void 0,s=void 0,a=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreChain)return ir(d)&&d._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,i,o),ce(()=>f(this,null,function*(){try{yield d.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,i,o)}catch(p){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleChainStart: ${p}`),d.raiseError)throw p}}),d.awaitHandlers)})),new Gi(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleToolStart(u,c){return f(this,arguments,function*(e,t,n=de(),i=void 0,s=void 0,a=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreAgent)return ir(d)&&d._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),ce(()=>f(this,null,function*(){try{yield d.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(p){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleToolStart: ${p}`),d.raiseError)throw p}}),d.awaitHandlers)})),new qi(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleRetrieverStart(u,c){return f(this,arguments,function*(e,t,n=de(),i=void 0,s=void 0,a=void 0,o=void 0){return yield Promise.all(this.handlers.map(d=>{if(!d.ignoreRetriever)return ir(d)&&d._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),ce(()=>f(this,null,function*(){try{yield d.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(p){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleRetrieverStart: ${p}`),d.raiseError)throw p}}),d.awaitHandlers)})),new Bi(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})}handleCustomEvent(e,t,n,i,s){return f(this,null,function*(){yield Promise.all(this.handlers.map(a=>ce(()=>f(this,null,function*(){if(!a.ignoreCustomEvent)try{yield a.handleCustomEvent?.(e,t,n,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}}),a.awaitHandlers)))})}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata=l(l({},this.metadata),e),t&&(this.inheritableMetadata=l(l({},this.inheritableMetadata),e))}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let i of this.handlers){let s=this.inheritableHandlers.includes(i);n.addHandler(i,s)}for(let i of this.tags){let s=this.inheritableTags.includes(i);n.addTags([i],s)}for(let i of Object.keys(this.metadata)){let s=Object.keys(this.inheritableMetadata).includes(i);n.addMetadata({[i]:this.metadata[i]},s)}for(let i of e)n.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||n.addHandler(i,t);return n}static fromHandlers(e){class t extends Ut{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:de()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static configure(e,t,n,i,s,a,o){return this._configureSync(e,t,n,i,s,a,o)}static _configureSync(e,t,n,i,s,a,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers(e?.map(Ar)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Ar):t?.handlers,!1));let c=lt("LANGCHAIN_VERBOSE")==="true"||o?.verbose,d=Ft.getTraceableRunTree()?.tracingEnabled||mf(),p=d||(lt("LANGCHAIN_TRACING")??!1);if(c||p){if(u||(u=new r),c&&!u.handlers.some(h=>h.name===Ir.prototype.name)){let h=new Ir;u.addHandler(h,!0)}if(p&&!u.handlers.some(h=>h.name==="langchain_tracer")&&d){let h=new Ft;u.addHandler(h,!0),u._parentRunId=Ft.getTraceableRunTree()?.id??u._parentRunId}}for(let{contextVar:h,inheritable:g=!0,handlerClass:_,envVar:b}of gf()){let y=b&&lt(b)==="true"&&_,v,w=h!==void 0?co(h):void 0;w&&io(w)?v=w:y&&(v=new _({})),v!==void 0&&(u||(u=new r),u.handlers.some(T=>T.name===v.name)||u.addHandler(v,g))}return(n||i)&&u&&(u.addTags(n??[]),u.addTags(i??[],!1)),(s||a)&&u&&(u.addMetadata(s??{}),u.addMetadata(a??{},!1)),u}};function Ar(r){return"name"in r?r:Ut.fromMethods(r)}var Vi=class{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getTraceGroupCallbackManager(e,t,n){return f(this,null,function*(){let i=new Ft(n),a=yield(yield it.configure([i]))?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{});if(!a)throw new Error("Failed to create run group callback manager.");return a})}start(e){return f(this,null,function*(){return this.runManager||(this.runManager=yield this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()})}error(e){return f(this,null,function*(){this.runManager&&(yield this.runManager.handleChainError(e),this.runManager=void 0)})}end(e){return f(this,null,function*(){this.runManager&&(yield this.runManager.handleChainEnd(e??{}),this.runManager=void 0)})}};function Wb(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Kb(r,e,...t){return f(this,null,function*(){let n=new Vi(r.name,r),i=yield n.start(l({},t));try{let s=yield e(i,...t);return yield n.end(Wb(s,"output")),s}catch(s){throw yield n.error(s),s}})}var Hi=class{getStore(){}run(e,t){return t()}enterWith(e){}},Xb=new Hi,_f=Symbol.for("lc:child_config"),lo=class{getInstance(){return Bt()??Xb}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[_f]}runWithConfig(e,t,n){let i=it._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),a=s.getStore(),o=i?.getParentRunId(),u=i?.handlers?.find(d=>d?.name==="langchain_tracer"),c;return u&&o?c=u.getRunTreeWithTracingConfig(o):n||(c=new ct({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra=m(l({},c.extra),{[_f]:e})),a!==void 0&&a[sr]!==void 0&&(c===void 0&&(c={}),c[sr]=a[sr]),s.run(c,t)}initializeGlobalInstance(e){Bt()===void 0&&pf(e)}},He=new lo;var Ji=25;function st(r){return f(this,null,function*(){return it._configureSync(r?.callbacks,void 0,r?.tags,void 0,r?.metadata)})}function fo(...r){let e={};for(let t of r.filter(n=>!!n))for(let n of Object.keys(t))if(n==="metadata")e[n]=l(l({},e[n]),t[n]);else if(n==="tags"){let i=e[n]??[];e[n]=[...new Set(i.concat(t[n]??[]))]}else if(n==="configurable")e[n]=l(l({},e[n]),t[n]);else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){let i=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!i)e.callbacks=s;else if(Array.isArray(i))e.callbacks=i.concat(s);else{let a=i.copy();for(let o of s)a.addHandler(Ar(o),!0);e.callbacks=a}else if(s)if(!i)e.callbacks=s;else if(Array.isArray(i)){let a=s.copy();for(let o of i)a.addHandler(Ar(o),!0);e.callbacks=a}else e.callbacks=new it(s._parentRunId,{handlers:i.handlers.concat(s.handlers),inheritableHandlers:i.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(s.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(s.inheritableTags))),metadata:l(l({},i.metadata),s.metadata)})}else{let i=n;e[i]=t[i]??e[i]}return e}var Qb=new Set(["string","number","boolean"]);function ne(r){let e=He.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let n=e,{runId:i,runName:s}=n,a=se(n,["runId","runName"]);t=Object.entries(a).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),t)}if(r&&(t=Object.entries(r).reduce((i,[s,a])=>(a!==void 0&&(i[s]=a),i),t)),t?.configurable)for(let i of Object.keys(t.configurable))Qb.has(typeof t.configurable[i])&&!t.metadata?.[i]&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function Se(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:i,configurable:s,runId:a}={}){let o=ne(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),s!==void 0&&(o.configurable=l(l({},o.configurable),s)),a!==void 0&&delete o.runId,o}function Rt(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}function xt(r,e){return f(this,null,function*(){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))})}var Te=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}next(){return f(this,null,function*(){this.ensureReader();try{let e=yield this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}})}return(){return f(this,null,function*(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),yield e}return{done:!0,value:void 0}})}throw(e){return f(this,null,function*(){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),yield t}throw e})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return f(this,null,function*(){yield this.return()})}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return i();function i(){return t.read().then(({done:s,value:a})=>{if(s){n.close();return}return n.enqueue(a),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({pull(n){return f(this,null,function*(){let{value:i,done:s}=yield e.next();s&&n.close(),n.enqueue(i)})},cancel(n){return f(this,null,function*(){yield e.return(n)})}})}};function Wi(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(function(i){return H(this,null,function*(){for(;;)if(i.length===0){let s=yield new x(r.next());for(let a of t)a.push(s)}else{if(i[0].done)return;yield i.shift().value}})})}function dt(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t=l({},r);for(let[n,i]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=dt(t[n],i):t[n]=i;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var Et=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{He.runWithConfig(Rt(e.config),()=>f(this,null,function*(){this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(i=>t(void 0),n)}),!0)})}next(...e){return f(this,null,function*(){return this.signal?.throwIfAborted(),this.firstResultUsed?He.runWithConfig(Rt(this.config),this.signal?()=>f(this,null,function*(){return xt(this.generator.next(...e),this.signal)}):()=>f(this,null,function*(){return this.generator.next(...e)}),!0):(this.firstResultUsed=!0,this.firstResult)})}return(e){return f(this,null,function*(){return this.generator.return(e)})}throw(e){return f(this,null,function*(){return this.generator.throw(e)})}[Symbol.asyncIterator](){return this}[Symbol.asyncDispose](){return f(this,null,function*(){yield this.return()})}};function po(r,e,t,n,...i){return f(this,null,function*(){let s=new Et({generator:e,startSetup:t,signal:n}),a=yield s.setup;return{output:r(s,a,...i),setup:a}})}var at=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),n=tr({},t);return new Pr({ops:t,state:n[n.length-1].newDocument})}},Pr=class r extends at{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=tr(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=tr({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}},ho=r=>r.name==="log_stream_tracer";function yf(r,e){return f(this,null,function*(){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input})}function bf(r,e){return f(this,null,function*(){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t})}function tw(r){return r!==void 0&&r.message!==void 0}var kr=class extends Ve{constructor(e){super(l({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Te.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return f(this,null,function*(){})}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(i=>!this.excludeTags?.includes(i))),n}tapOutputIterable(e,t){return H(this,null,function*(){try{for(var n=X(t),i,s,a;i=!(s=yield new x(n.next())).done;i=!1){let o=s.value;if(e!==this.rootId){let u=this.keyMapByRunId[e];u&&(yield new x(this.writer.write(new at({ops:[{op:"add",path:`/logs/${u}/streamed_output/-`,value:o}]}))))}yield o}}catch{a=[s]}finally{try{i&&(s=n.return)&&(yield new x(s.call(n)))}finally{if(a)throw a[0]}}})}onRunCreate(e){return f(this,null,function*(){if(this.rootId===void 0&&(this.rootId=e.id,yield this.writer.write(new at({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=yield yf(e,this._schemaFormat)),yield this.writer.write(new at({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))})}onRunUpdate(e){return f(this,null,function*(){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:yield yf(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:yield bf(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new at({ops:n});yield this.writer.write(i)}finally{if(e.id===this.rootId){let t=new at({ops:[{op:"replace",path:"/final_output",value:yield bf(e,this._schemaFormat)}]});yield this.writer.write(t),this.autoClose&&(yield this.writer.close())}}})}onLLMNewToken(e,t,n){return f(this,null,function*(){let i=this.keyMapByRunId[e.id];if(i===void 0)return;let s=e.inputs.messages!==void 0,a;s?tw(n?.chunk)?a=n?.chunk:a=new jt({id:`run-${e.id}`,content:t}):a=t;let o=new at({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});yield this.writer.write(o)})}};var iw={};we(iw,{ChatGenerationChunk:()=>mo,GenerationChunk:()=>ur,RUN_KEY:()=>nw});var nw="__run",ur=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:l(l({},this.generationInfo),e.generationInfo)})}},mo=class r extends ur{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:l(l({},this.generationInfo),e.generationInfo),message:this.message.concat(e.message)})}};function Ki({name:r,serialized:e}){return r!==void 0?r:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var wf=r=>r.name==="event_stream_tracer",Yi=class extends Ve{constructor(e){super(l({_awaitHandler:!0},e)),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Te.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}persistRun(e){return f(this,null,function*(){})}_includeRun(e){let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(i=>!this.excludeTags?.includes(i))),n}tapOutputIterable(e,t){return H(this,null,function*(){let n=yield new x(t.next());if(n.done)return;let i=this.runInfoMap.get(e);if(i===void 0){yield n.value;return}function s(b,y){return b==="llm"&&typeof y=="string"?new ur({text:y}):y}let a=this.tappedPromises.get(e);if(a===void 0){let b;a=new Promise(y=>{b=y}),this.tappedPromises.set(e,a);try{let y={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};yield new x(this.send(m(l({},y),{data:{chunk:s(i.runType,n.value)}}),i)),yield n.value;try{for(var o=X(t),u,c,d;u=!(c=yield new x(o.next())).done;u=!1){let v=c.value;i.runType!=="tool"&&i.runType!=="retriever"&&(yield new x(this.send(m(l({},y),{data:{chunk:s(i.runType,v)}}),i))),yield v}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield new x(c.call(o)))}finally{if(d)throw d[0]}}}finally{b()}}else{yield n.value;try{for(var p=X(t),h,g,_;h=!(g=yield new x(p.next())).done;h=!1){let b=g.value;yield b}}catch{_=[g]}finally{try{h&&(g=p.return)&&(yield new x(g.call(p)))}finally{if(_)throw _[0]}}}})}send(e,t){return f(this,null,function*(){this._includeRun(t)&&(yield this.writer.write(e))})}sendEndEvent(e,t){return f(this,null,function*(){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):yield this.send(e,t)})}onLLMStart(e){return f(this,null,function*(){let t=Ki(e),n=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,i);let s=`on_${n}_start`;yield this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onLLMNewToken(e,t,n){return f(this,null,function*(){let i=this.runInfoMap.get(e.id),s,a;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")a="on_chat_model_stream",n?.chunk===void 0?s=new jt({content:t,id:`run-${e.id}`}):s=n.chunk.message;else if(i.runType==="llm")a="on_llm_stream",n?.chunk===void 0?s=new ur({text:t}):s=n.chunk;else throw new Error(`Unexpected run type ${i.runType}`);yield this.send({event:a,data:{chunk:s},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}})}onLLMEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations,s;if(t.runType==="chat_model"){for(let a of i??[]){if(s!==void 0)break;s=a[0]?.message}n="on_chat_model_end"}else if(t.runType==="llm")s={generations:i?.map(a=>a.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);yield this.sendEndEvent({event:n,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onChainStart(e){return f(this,null,function*(){let t=Ki(e),n=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},i.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,i.inputs=e.inputs.input):(s.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),yield this.send({event:`on_${n}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onChainEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(a.input=i.input,t.inputs=i.input),yield this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)})}onToolStart(e){return f(this,null,function*(){let t=Ki(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),yield this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)})}onToolEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;yield this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}onRetrieverStart(e){return f(this,null,function*(){let t=Ki(e),i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),yield this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)})}onRetrieverEnd(e){return f(this,null,function*(){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);yield this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)})}handleCustomEvent(e,t,n){return f(this,null,function*(){let i=this.runInfoMap.get(n);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);yield this.send({event:"on_custom_event",run_id:n,name:e,tags:i.tags,metadata:i.metadata,data:t},i)})}finish(){return f(this,null,function*(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})})}};var ow={};we(ow,{AsyncCaller:()=>ln});var vf=gt(Yn(),1),Xi=gt(bi(),1),sw=[400,401,402,403,404,405,406,407,409],aw=r=>{if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r?.code==="ECONNABORTED")throw r;let e=r?.response?.status??r?.status;if(e&&sw.includes(+e))throw r;if(r?.error?.code==="insufficient_quota"){let t=new Error(r?.message);throw t.name="InsufficientQuotaError",t}},ln=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??aw;let t="default"in Xi.default?Xi.default.default:Xi.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,vf.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((i,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var dn=class extends Ve{constructor({config:e,onStart:t,onEnd:n,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=i}persistRun(e){return Promise.resolve()}onRunCreate(e){return f(this,null,function*(){this.rootId||(this.rootId=e.id,this.argOnStart&&(yield this.argOnStart(e,this.config)))})}onRunUpdate(e){return f(this,null,function*(){e.id===this.rootId&&(e.error?this.argOnError&&(yield this.argOnError(e,this.config)):this.argOnEnd&&(yield this.argOnEnd(e,this.config)))})}};function fn(r){return r?r.lc_runnable:!1}var Qi=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,i=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||i.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&i.every(s=>!this.excludeTags?.includes(s))),n}};function go(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}var uw=["*","_","`"];function cw(r){let e="";for(let[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function xf(r,e,t){let{firstNode:n,lastNode:i,nodeColors:s,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){let g="default",_={[g]:"{0}({1})"};n!==void 0&&(_[n]="{0}([{1}]):::first"),i!==void 0&&(_[i]="{0}([{1}]):::last");for(let[b,y]of Object.entries(r)){let v=y.name.split(":").pop()??"",T=uw.some(U=>v.startsWith(U)&&v.endsWith(U))?`<p>${v}</p>`:v;Object.keys(y.metadata??{}).length&&(T+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([U,M])=>`${U} = ${M}`).join(`
`)}</em></small>`);let N=(_[b]??_[g]).replace("{0}",go(b)).replace("{1}",T);c+=`	${N}
`}}let d={};for(let g of e){let _=g.source.split(":"),b=g.target.split(":"),y=_.filter((v,w)=>v===b[w]).join(":");d[y]||(d[y]=[]),d[y].push(g)}let p=new Set;function h(g,_){let b=g.length===1&&g[0].source===g[0].target;if(_&&!b){let y=_.split(":").pop();if(p.has(y))throw new Error(`Found duplicate subgraph '${y}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);p.add(y),c+=`	subgraph ${y}
`}for(let y of g){let{source:v,target:w,data:T,conditional:N}=y,U="";if(T!==void 0){let M=T,ee=M.split(" ");ee.length>u&&(M=Array.from({length:Math.ceil(ee.length/u)},(G,re)=>ee.slice(re*u,(re+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),U=N?` -. &nbsp;${M}&nbsp; .-> `:` -- &nbsp;${M}&nbsp; --> `}else U=N?" -.-> ":" --> ";c+=`	${go(v)}${U}${go(w)};
`}for(let y in d)y.startsWith(`${_}:`)&&y!==_&&h(d[y],y);_&&!b&&(c+=`	end
`)}h(d[""]??[],"");for(let g in d)!g.includes(":")&&g!==""&&h(d[g],g);return a&&(c+=cw(s??{})),c}function Ef(r,e){return f(this,null,function*(){let{backgroundColor:t="white"}=e??{},n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let i=`https://mermaid.ink/img/${n}?bgColor=${t}`,s=yield fetch(i);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join(`
`));return yield s.blob()})}var Tv={};we(Tv,{Validator:()=>cs,deepCompareStrict:()=>Vt,toJsonSchema:()=>Co,validatesOnlyStrings:()=>ds});var k$=Object.freeze({status:"aborted"});function qt(r,e,t){function n(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(r),e(o,u);for(let d in a.prototype)d in o||Object.defineProperty(o,d,{value:a.prototype[d].bind(o)});o._zod.constr=a,o._zod.def=u}let i=t?.Parent??Object;class s extends i{}Object.defineProperty(s,"name",{value:r});function a(o){var u;let c=t?.Parent?new s:this;n(c,o),(u=c._zod).deferred??(u.deferred=[]);for(let d of c._zod.deferred)d();return c}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>t?.Parent&&o instanceof t.Parent?!0:o?._zod?.traits?.has(r)}),Object.defineProperty(a,"name",{value:r}),a}var R$=Symbol("zod_brand"),Gt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},_o={};function Rr(r){return r&&Object.assign(_o,r),_o}var Nt={};we(Nt,{BIGINT_FORMAT_RANGES:()=>Tw,Class:()=>yo,NUMBER_FORMAT_RANGES:()=>Sw,aborted:()=>hn,allowsEval:()=>Of,assert:()=>hw,assertEqual:()=>lw,assertIs:()=>fw,assertNever:()=>pw,assertNotEqual:()=>dw,assignProp:()=>xo,cached:()=>wo,captureStackTrace:()=>ns,cleanEnum:()=>Cw,cleanRegex:()=>vo,clone:()=>je,createTransparentProxy:()=>Ew,defineLazy:()=>rs,esc:()=>Tf,escapeRegex:()=>Af,extend:()=>Iw,finalizeIssue:()=>cr,floatSafeRemainder:()=>_w,getElementAtPath:()=>yw,getEnumValues:()=>ts,getLengthableOrigin:()=>Nw,getParsedType:()=>xw,getSizableOrigin:()=>Rw,isObject:()=>es,isPlainObject:()=>Eo,issue:()=>Nf,joinValues:()=>mw,jsonStringifyReplacer:()=>bo,merge:()=>Aw,normalizeParams:()=>So,nullish:()=>gw,numKeys:()=>vw,omit:()=>$w,optionalKeys:()=>kf,partial:()=>Pw,pick:()=>Ow,prefixIssues:()=>Rf,primitiveTypes:()=>If,promiseAllObject:()=>bw,propertyKeyTypes:()=>$f,randomString:()=>ww,required:()=>kw,stringifyPrimitive:()=>Pf,unwrapMessage:()=>pn});function lw(r){return r}function dw(r){return r}function fw(r){}function pw(r){throw new Error}function hw(r){}function ts(r){let e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,i])=>e.indexOf(+n)===-1).map(([n,i])=>i)}function mw(r,e="|"){return r.map(t=>Pf(t)).join(e)}function bo(r,e){return typeof e=="bigint"?e.toString():e}function wo(r){return{get value(){{let t=r();return Object.defineProperty(this,"value",{value:t}),t}throw new Error("cached value already set")}}}function gw(r){return r==null}function vo(r){let e=r.startsWith("^")?1:0,t=r.endsWith("$")?r.length-1:r.length;return r.slice(e,t)}function _w(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=t>n?t:n,s=Number.parseInt(r.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return s%a/10**i}function rs(r,e,t){Object.defineProperty(r,e,{get(){{let i=t();return r[e]=i,i}throw new Error("cached value already set")},set(i){Object.defineProperty(r,e,{value:i})},configurable:!0})}function xo(r,e,t){Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function yw(r,e){return e?e.reduce((t,n)=>t?.[n],r):r}function bw(r){let e=Object.keys(r),t=e.map(n=>r[n]);return Promise.all(t).then(n=>{let i={};for(let s=0;s<e.length;s++)i[e[s]]=n[s];return i})}function ww(r=10){let e="abcdefghijklmnopqrstuvwxyz",t="";for(let n=0;n<r;n++)t+=e[Math.floor(Math.random()*e.length)];return t}function Tf(r){return JSON.stringify(r)}var ns=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};function es(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}var Of=wo(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let r=Function;return new r(""),!0}catch{return!1}});function Eo(r){if(es(r)===!1)return!1;let e=r.constructor;if(e===void 0)return!0;let t=e.prototype;return!(es(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function vw(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}var xw=r=>{let e=typeof r;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(r)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(r)?"array":r===null?"null":r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?"promise":typeof Map<"u"&&r instanceof Map?"map":typeof Set<"u"&&r instanceof Set?"set":typeof Date<"u"&&r instanceof Date?"date":typeof File<"u"&&r instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},$f=new Set(["string","number","symbol"]),If=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Af(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function je(r,e,t){let n=new r._zod.constr(e??r._zod.def);return(!e||t?.parent)&&(n._zod.parent=r),n}function So(r){let e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?m(l({},e),{error:()=>e.error}):e}function Ew(r){let e;return new Proxy({},{get(t,n,i){return e??(e=r()),Reflect.get(e,n,i)},set(t,n,i,s){return e??(e=r()),Reflect.set(e,n,i,s)},has(t,n){return e??(e=r()),Reflect.has(e,n)},deleteProperty(t,n){return e??(e=r()),Reflect.deleteProperty(e,n)},ownKeys(t){return e??(e=r()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(t,n){return e??(e=r()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(t,n,i){return e??(e=r()),Reflect.defineProperty(e,n,i)}})}function Pf(r){return typeof r=="bigint"?r.toString()+"n":typeof r=="string"?`"${r}"`:`${r}`}function kf(r){return Object.keys(r).filter(e=>r[e]._zod.optin==="optional"&&r[e]._zod.optout==="optional")}var Sw={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Tw={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function Ow(r,e){let t={},n=r._zod.def;for(let i in e){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&(t[i]=n.shape[i])}return je(r,m(l({},r._zod.def),{shape:t,checks:[]}))}function $w(r,e){let t=l({},r._zod.def.shape),n=r._zod.def;for(let i in e){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);e[i]&&delete t[i]}return je(r,m(l({},r._zod.def),{shape:t,checks:[]}))}function Iw(r,e){if(!Eo(e))throw new Error("Invalid input to extend: expected a plain object");let t=m(l({},r._zod.def),{get shape(){let n=l(l({},r._zod.def.shape),e);return xo(this,"shape",n),n},checks:[]});return je(r,t)}function Aw(r,e){return je(r,m(l({},r._zod.def),{get shape(){let t=l(l({},r._zod.def.shape),e._zod.def.shape);return xo(this,"shape",t),t},catchall:e._zod.def.catchall,checks:[]}))}function Pw(r,e,t){let n=e._zod.def.shape,i=l({},n);if(t)for(let s in t){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(i[s]=r?new r({type:"optional",innerType:n[s]}):n[s])}else for(let s in n)i[s]=r?new r({type:"optional",innerType:n[s]}):n[s];return je(e,m(l({},e._zod.def),{shape:i,checks:[]}))}function kw(r,e,t){let n=e._zod.def.shape,i=l({},n);if(t)for(let s in t){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(i[s]=new r({type:"nonoptional",innerType:n[s]}))}else for(let s in n)i[s]=new r({type:"nonoptional",innerType:n[s]});return je(e,m(l({},e._zod.def),{shape:i,checks:[]}))}function hn(r,e=0){for(let t=e;t<r.issues.length;t++)if(r.issues[t]?.continue!==!0)return!0;return!1}function Rf(r,e){return e.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(r),t})}function pn(r){return typeof r=="string"?r:r?.message}function cr(r,e,t){let n=m(l({},r),{path:r.path??[]});if(!r.message){let i=pn(r.inst?._zod.def?.error?.(r))??pn(e?.error?.(r))??pn(t.customError?.(r))??pn(t.localeError?.(r))??"Invalid input";n.message=i}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Rw(r){return r instanceof Set?"set":r instanceof Map?"map":r instanceof File?"file":"unknown"}function Nw(r){return Array.isArray(r)?"array":typeof r=="string"?"string":"unknown"}function Nf(...r){let[e,t,n]=r;return typeof e=="string"?{message:e,code:"custom",input:t,inst:n}:l({},e)}function Cw(r){return Object.entries(r).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var yo=class{constructor(...e){}};var Cf=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,bo,2)},enumerable:!0}),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},jf=qt("$ZodError",Cf),mn=qt("$ZodError",Cf,{Parent:Error});var Lw=r=>(e,t,n,i)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},a=e._zod.run({value:t,issues:[]},s);if(a instanceof Promise)throw new Gt;if(a.issues.length){let o=new(i?.Err??r)(a.issues.map(u=>cr(u,s,Rr())));throw ns(o,i?.callee),o}return a.value},gn=Lw(mn),zw=r=>(e,t,n,i)=>f(null,null,function*(){let s=n?Object.assign(n,{async:!0}):{async:!0},a=e._zod.run({value:t,issues:[]},s);if(a instanceof Promise&&(a=yield a),a.issues.length){let o=new(i?.Err??r)(a.issues.map(u=>cr(u,s,Rr())));throw ns(o,i?.callee),o}return a.value}),Lf=zw(mn),Mw=r=>(e,t,n)=>{let i=n?m(l({},n),{async:!1}):{async:!1},s=e._zod.run({value:t,issues:[]},i);if(s instanceof Promise)throw new Gt;return s.issues.length?{success:!1,error:new(r??jf)(s.issues.map(a=>cr(a,i,Rr())))}:{success:!0,data:s.value}},zf=Mw(mn),Dw=r=>(e,t,n)=>f(null,null,function*(){let i=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:t,issues:[]},i);return s instanceof Promise&&(s=yield s),s.issues.length?{success:!1,error:new r(s.issues.map(a=>cr(a,i,Rr())))}:{success:!0,data:s.value}}),Mf=Dw(mn);var Df={major:4,minor:0,patch:0};var To=qt("$ZodType",(r,e)=>{var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=Df;let n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(let i of n)for(let s of i._zod.onattach)s(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),r._zod.deferred?.push(()=>{r._zod.run=r._zod.parse});else{let i=(s,a,o)=>{let u=hn(s),c;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;let p=s.issues.length,h=d._zod.check(s);if(h instanceof Promise&&o?.async===!1)throw new Gt;if(c||h instanceof Promise)c=(c??Promise.resolve()).then(()=>f(null,null,function*(){yield h,s.issues.length!==p&&(u||(u=hn(s,p)))}));else{if(s.issues.length===p)continue;u||(u=hn(s,p))}}return c?c.then(()=>s):s};r._zod.run=(s,a)=>{let o=r._zod.parse(s,a);if(o instanceof Promise){if(a.async===!1)throw new Gt;return o.then(u=>i(u,n,a))}return i(o,n,a)}}r["~standard"]={validate:i=>{try{let s=zf(r,i);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Mf(r,i).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}});var Uf=qt("$ZodUnknown",(r,e)=>{To.init(r,e),r._zod.parse=t=>t}),Zf=qt("$ZodNever",(r,e)=>{To.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});var Ff=qt("$ZodOptional",(r,e)=>{To.init(r,e),r._zod.optin="optional",r._zod.optout="optional",rs(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),rs(r._zod,"pattern",()=>{let t=e.innerType._zod.pattern;return t?new RegExp(`^(${vo(t.source)})?$`):void 0}),r._zod.parse=(t,n)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(t,n):t.value===void 0?t:e.innerType._zod.run(t,n)});var B$=Symbol("ZodOutput"),G$=Symbol("ZodInput"),_n=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n=l({},this.get(t)??{});return delete n.id,l(l({},n),this._map.get(e))}return this._map.get(e)}has(e){return this._map.has(e)}};function Uw(){return new _n}var Be=Uw();function Bf(r){return new r({type:"unknown"})}function Gf(r,e){return new r(l({type:"never"},So(e)))}var is=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Be,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var n;let i=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,t.schemaPath.includes(e)&&(a.cycle=t.path),a.schema;let o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);let u=e._zod.toJSONSchema?.();if(u)o.schema=u;else{let p=m(l({},t),{schemaPath:[...t.schemaPath,e],path:t.path}),h=e._zod.parent;if(h)o.ref=h,this.process(h,p),this.seen.get(h).isParent=!0;else{let g=o.schema;switch(i.type){case"string":{let _=g;_.type="string";let{minimum:b,maximum:y,format:v,patterns:w,contentEncoding:T}=e._zod.bag;if(typeof b=="number"&&(_.minLength=b),typeof y=="number"&&(_.maxLength=y),v&&(_.format=s[v]??v,_.format===""&&delete _.format),T&&(_.contentEncoding=T),w&&w.size>0){let N=[...w];N.length===1?_.pattern=N[0].source:N.length>1&&(o.schema.allOf=[...N.map(U=>m(l({},this.target==="draft-7"?{type:"string"}:{}),{pattern:U.source}))])}break}case"number":{let _=g,{minimum:b,maximum:y,format:v,multipleOf:w,exclusiveMaximum:T,exclusiveMinimum:N}=e._zod.bag;typeof v=="string"&&v.includes("int")?_.type="integer":_.type="number",typeof N=="number"&&(_.exclusiveMinimum=N),typeof b=="number"&&(_.minimum=b,typeof N=="number"&&(N>=b?delete _.minimum:delete _.exclusiveMinimum)),typeof T=="number"&&(_.exclusiveMaximum=T),typeof y=="number"&&(_.maximum=y,typeof T=="number"&&(T<=y?delete _.maximum:delete _.exclusiveMaximum)),typeof w=="number"&&(_.multipleOf=w);break}case"boolean":{let _=g;_.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{g.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{g.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let _=g,{minimum:b,maximum:y}=e._zod.bag;typeof b=="number"&&(_.minItems=b),typeof y=="number"&&(_.maxItems=y),_.type="array",_.items=this.process(i.element,m(l({},p),{path:[...p.path,"items"]}));break}case"object":{let _=g;_.type="object",_.properties={};let b=i.shape;for(let w in b)_.properties[w]=this.process(b[w],m(l({},p),{path:[...p.path,"properties",w]}));let y=new Set(Object.keys(b)),v=new Set([...y].filter(w=>{let T=i.shape[w]._zod;return this.io==="input"?T.optin===void 0:T.optout===void 0}));v.size>0&&(_.required=Array.from(v)),i.catchall?._zod.def.type==="never"?_.additionalProperties=!1:i.catchall?i.catchall&&(_.additionalProperties=this.process(i.catchall,m(l({},p),{path:[...p.path,"additionalProperties"]}))):this.io==="output"&&(_.additionalProperties=!1);break}case"union":{let _=g;_.anyOf=i.options.map((b,y)=>this.process(b,m(l({},p),{path:[...p.path,"anyOf",y]})));break}case"intersection":{let _=g,b=this.process(i.left,m(l({},p),{path:[...p.path,"allOf",0]})),y=this.process(i.right,m(l({},p),{path:[...p.path,"allOf",1]})),v=T=>"allOf"in T&&Object.keys(T).length===1,w=[...v(b)?b.allOf:[b],...v(y)?y.allOf:[y]];_.allOf=w;break}case"tuple":{let _=g;_.type="array";let b=i.items.map((w,T)=>this.process(w,m(l({},p),{path:[...p.path,"prefixItems",T]})));if(this.target==="draft-2020-12"?_.prefixItems=b:_.items=b,i.rest){let w=this.process(i.rest,m(l({},p),{path:[...p.path,"items"]}));this.target==="draft-2020-12"?_.items=w:_.additionalItems=w}i.rest&&(_.items=this.process(i.rest,m(l({},p),{path:[...p.path,"items"]})));let{minimum:y,maximum:v}=e._zod.bag;typeof y=="number"&&(_.minItems=y),typeof v=="number"&&(_.maxItems=v);break}case"record":{let _=g;_.type="object",_.propertyNames=this.process(i.keyType,m(l({},p),{path:[...p.path,"propertyNames"]})),_.additionalProperties=this.process(i.valueType,m(l({},p),{path:[...p.path,"additionalProperties"]}));break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let _=g,b=ts(i.entries);b.every(y=>typeof y=="number")&&(_.type="number"),b.every(y=>typeof y=="string")&&(_.type="string"),_.enum=b;break}case"literal":{let _=g,b=[];for(let y of i.values)if(y===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof y=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");b.push(Number(y))}else b.push(y);if(b.length!==0)if(b.length===1){let y=b[0];_.type=y===null?"null":typeof y,_.const=y}else b.every(y=>typeof y=="number")&&(_.type="number"),b.every(y=>typeof y=="string")&&(_.type="string"),b.every(y=>typeof y=="boolean")&&(_.type="string"),b.every(y=>y===null)&&(_.type="null"),_.enum=b;break}case"file":{let _=g,b={type:"string",format:"binary",contentEncoding:"binary"},{minimum:y,maximum:v,mime:w}=e._zod.bag;y!==void 0&&(b.minLength=y),v!==void 0&&(b.maxLength=v),w?w.length===1?(b.contentMediaType=w[0],Object.assign(_,b)):_.anyOf=w.map(T=>m(l({},b),{contentMediaType:T})):Object.assign(_,b);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let _=this.process(i.innerType,p);g.anyOf=[_,{type:"null"}];break}case"nonoptional":{this.process(i.innerType,p),o.ref=i.innerType;break}case"success":{let _=g;_.type="boolean";break}case"default":{this.process(i.innerType,p),o.ref=i.innerType,g.default=JSON.parse(JSON.stringify(i.defaultValue));break}case"prefault":{this.process(i.innerType,p),o.ref=i.innerType,this.io==="input"&&(g._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break}case"catch":{this.process(i.innerType,p),o.ref=i.innerType;let _;try{_=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}g.default=_;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let _=g,b=e._zod.pattern;if(!b)throw new Error("Pattern not found in template literal");_.type="string",_.pattern=b.source;break}case"pipe":{let _=this.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;this.process(_,p),o.ref=_;break}case"readonly":{this.process(i.innerType,p),o.ref=i.innerType,g.readOnly=!0;break}case"promise":{this.process(i.innerType,p),o.ref=i.innerType;break}case"optional":{this.process(i.innerType,p),o.ref=i.innerType;break}case"lazy":{let _=e._zod.innerType;this.process(_,p),o.ref=_;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&he(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){let n={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},i=this.seen.get(e);if(!i)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=d=>{let p=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let b=n.external.registry.get(d[0])?.id,y=n.external.uri??(w=>w);if(b)return{ref:y(b)};let v=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=v,{defId:v,ref:`${y("__shared")}#/${p}/${v}`}}if(d[1]===i)return{ref:"#"};let g=`#/${p}/`,_=d[1].schema.id??`__schema${this.counter++}`;return{defId:_,ref:g+_}},a=d=>{if(d[1].schema.$ref)return;let p=d[1],{ref:h,defId:g}=s(d);p.def=l({},p.schema),g&&(p.defId=g);let _=p.schema;for(let b in _)delete _[b];_.$ref=h};if(n.cycles==="throw")for(let d of this.seen.entries()){let p=d[1];if(p.cycle)throw new Error(`Cycle detected: #/${p.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let d of this.seen.entries()){let p=d[1];if(e===d[0]){a(d);continue}if(n.external){let g=n.external.registry.get(d[0])?.id;if(e!==d[0]&&g){a(d);continue}}if(this.metadataRegistry.get(d[0])?.id){a(d);continue}if(p.cycle){a(d);continue}if(p.count>1&&n.reused==="ref"){a(d);continue}}let o=(d,p)=>{let h=this.seen.get(d),g=h.def??h.schema,_=l({},g);if(h.ref===null)return;let b=h.ref;if(h.ref=null,b){o(b,p);let y=this.seen.get(b).schema;y.$ref&&p.target==="draft-7"?(g.allOf=g.allOf??[],g.allOf.push(y)):(Object.assign(g,y),Object.assign(g,_))}h.isParent||this.override({zodSchema:d,jsonSchema:g,path:h.path??[]})};for(let d of[...this.seen.entries()].reverse())o(d[0],{target:this.target});let u={};if(this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let d=n.external.registry.get(e)?.id;if(!d)throw new Error("Schema is missing an `id` property");u.$id=n.external.uri(d)}Object.assign(u,i.def);let c=n.external?.defs??{};for(let d of this.seen.entries()){let p=d[1];p.def&&p.defId&&(c[p.defId]=p.def)}n.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}};function Oo(r,e){if(r instanceof _n){let n=new is(e),i={};for(let o of r._idmap.entries()){let[u,c]=o;n.process(c)}let s={},a={registry:r,uri:e?.uri,defs:i};for(let o of r._idmap.entries()){let[u,c]=o;s[u]=n.emit(c,m(l({},e),{external:a}))}if(Object.keys(i).length>0){let o=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[o]:i}}return{schemas:s}}let t=new is(e);return t.process(r),t.emit(r,e)}function he(r,e){let t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);let i=r._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return he(i.element,t);case"object":{for(let s in i.shape)if(he(i.shape[s],t))return!0;return!1}case"union":{for(let s of i.options)if(he(s,t))return!0;return!1}case"intersection":return he(i.left,t)||he(i.right,t);case"tuple":{for(let s of i.items)if(he(s,t))return!0;return!!(i.rest&&he(i.rest,t))}case"record":return he(i.keyType,t)||he(i.valueType,t);case"map":return he(i.keyType,t)||he(i.valueType,t);case"set":return he(i.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return he(i.innerType,t);case"lazy":return he(i.getter(),t);case"default":return he(i.innerType,t);case"prefault":return he(i.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return he(i.in,t)||he(i.out,t);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${i.type}`)}var Vf=Symbol("Let zodToJsonSchema decide on which parser to use");var qf={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Hf=r=>typeof r=="string"?m(l({},qf),{name:r}):l(l({},qf),r);var Jf=r=>{let e=Hf(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return m(l({},e),{flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))})};function $o(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage=m(l({},r.errorMessage),{[e]:t}))}function te(r,e,t,n,i){r[e]=t,$o(r,e,n,i)}var ss=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function ae(r){if(r.target!=="openAi")return{};let e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?ss(e,r.currentPath):e.join("/")}}function Wf(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==S.ZodAny&&(t.items=Z(r.type._def,m(l({},e),{currentPath:[...e.currentPath,"items"]}))),r.minLength&&te(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&te(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(te(t,"minItems",r.exactLength.value,r.exactLength.message,e),te(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Kf(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?te(t,"minimum",n.value,n.message,e):te(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),te(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?te(t,"maximum",n.value,n.message,e):te(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),te(t,"maximum",n.value,n.message,e));break;case"multipleOf":te(t,"multipleOf",n.value,n.message,e);break}return t}function Yf(){return{type:"boolean"}}function as(r,e){return Z(r.type._def,e)}var Xf=(r,e)=>Z(r.innerType._def,e);function Io(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,s)=>Io(r,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Zw(r,e)}}var Zw=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":te(t,"minimum",n.value,n.message,e);break;case"max":te(t,"maximum",n.value,n.message,e);break}return t};function Qf(r,e){return m(l({},Z(r.innerType._def,e)),{default:r.defaultValue()})}function ep(r,e){return e.effectStrategy==="input"?Z(r.schema._def,e):ae(e)}function tp(r){return{type:"string",enum:Array.from(r.values)}}var Fw=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function rp(r,e){let t=[Z(r.left._def,m(l({},e),{currentPath:[...e.currentPath,"allOf","0"]})),Z(r.right._def,m(l({},e),{currentPath:[...e.currentPath,"allOf","1"]}))].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return t.forEach(s=>{if(Fw(s))i.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let o=s;if("additionalProperties"in s&&s.additionalProperties===!1){let a=s,{additionalProperties:u}=a;o=se(a,["additionalProperties"])}else n=void 0;i.push(o)}}),i.length?l({allOf:i},n):void 0}function np(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var Ao,ft={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ao===void 0&&(Ao=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ao),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function os(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":te(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":te(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":pt(t,"email",n.message,e);break;case"format:idn-email":pt(t,"idn-email",n.message,e);break;case"pattern:zod":Le(t,ft.email,n.message,e);break}break;case"url":pt(t,"uri",n.message,e);break;case"uuid":pt(t,"uuid",n.message,e);break;case"regex":Le(t,n.regex,n.message,e);break;case"cuid":Le(t,ft.cuid,n.message,e);break;case"cuid2":Le(t,ft.cuid2,n.message,e);break;case"startsWith":Le(t,RegExp(`^${Po(n.value,e)}`),n.message,e);break;case"endsWith":Le(t,RegExp(`${Po(n.value,e)}$`),n.message,e);break;case"datetime":pt(t,"date-time",n.message,e);break;case"date":pt(t,"date",n.message,e);break;case"time":pt(t,"time",n.message,e);break;case"duration":pt(t,"duration",n.message,e);break;case"length":te(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),te(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Le(t,RegExp(Po(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&pt(t,"ipv4",n.message,e),n.version!=="v4"&&pt(t,"ipv6",n.message,e);break}case"base64url":Le(t,ft.base64url,n.message,e);break;case"jwt":Le(t,ft.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Le(t,ft.ipv4Cidr,n.message,e),n.version!=="v4"&&Le(t,ft.ipv6Cidr,n.message,e);break}case"emoji":Le(t,ft.emoji(),n.message,e);break;case"ulid":{Le(t,ft.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{pt(t,"binary",n.message,e);break}case"contentEncoding:base64":{te(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Le(t,ft.base64,n.message,e);break}}break}case"nanoid":Le(t,ft.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function Po(r,e){return e.patternStrategy==="escape"?Gw(r):r}var Bw=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Gw(r){let e="";for(let t=0;t<r.length;t++)Bw.has(r[t])||(e+="\\"),e+=r[t];return e}function pt(r,e,t,n){r.format||r.anyOf?.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push(l({format:r.format},r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}})),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push(l({format:e},t&&n.errorMessages&&{errorMessage:{format:t}}))):te(r,"format",e,t,n)}function Le(r,e,t,n){r.pattern||r.allOf?.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push(l({pattern:r.pattern},r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}})),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push(l({pattern:ip(e,n)},t&&n.errorMessages&&{errorMessage:{pattern:t}}))):te(r,"pattern",ip(e,n),t,n)}function ip(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,i="",s=!1,a=!1,o=!1;for(let u=0;u<n.length;u++){if(s){i+=n[u],s=!1;continue}if(t.i){if(a){if(n[u].match(/[a-z]/)){o?(i+=n[u],i+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&n[u+2]?.match(/[a-z]/)?(i+=n[u],o=!0):i+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){i+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){i+=a?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}i+=n[u],n[u]==="\\"?s=!0:a&&n[u]==="]"?a=!1:!a&&n[u]==="["&&(a=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return i}function us(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===S.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((s,a)=>m(l({},s),{[a]:Z(r.valueType._def,m(l({},e),{currentPath:[...e.currentPath,"properties",a]}))??ae(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:Z(r.valueType._def,m(l({},e),{currentPath:[...e.currentPath,"additionalProperties"]}))??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===S.ZodString&&r.keyType._def.checks?.length){let n=os(r.keyType._def,e),{type:s}=n,a=se(n,["type"]);return m(l({},t),{propertyNames:a})}else{if(r.keyType?._def.typeName===S.ZodEnum)return m(l({},t),{propertyNames:{enum:r.keyType._def.values}});if(r.keyType?._def.typeName===S.ZodBranded&&r.keyType._def.type._def.typeName===S.ZodString&&r.keyType._def.type._def.checks?.length){let i=as(r.keyType._def,e),{type:s}=i,a=se(i,["type"]);return m(l({},t),{propertyNames:a})}}return t}function sp(r,e){if(e.mapStrategy==="record")return us(r,e);let t=Z(r.keyType._def,m(l({},e),{currentPath:[...e.currentPath,"items","items","0"]}))||ae(e),n=Z(r.valueType._def,m(l({},e),{currentPath:[...e.currentPath,"items","items","1"]}))||ae(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function ap(r){let e=r.values,n=Object.keys(r.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(n.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function op(r){return r.target==="openAi"?void 0:{not:ae(m(l({},r),{currentPath:[...r.currentPath,"not"]}))}}function up(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var yn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function lp(r,e){if(e.target==="openApi3")return cp(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in yn&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((i,s)=>{let a=yn[s._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((i,s)=>{let a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(n.length===t.length){let i=n.filter((s,a,o)=>o.indexOf(s)===a);return{type:i.length>1?i:i[0],enum:t.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,i)=>[...n,...i._def.values.filter(s=>!n.includes(s))],[])};return cp(r,e)}var cp=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,i)=>Z(n._def,m(l({},e),{currentPath:[...e.currentPath,"anyOf",`${i}`]}))).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function dp(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:yn[r.innerType._def.typeName],nullable:!0}:{type:[yn[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=Z(r.innerType._def,m(l({},e),{currentPath:[...e.currentPath]}));return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&m(l({},n),{nullable:!0})}let t=Z(r.innerType._def,m(l({},e),{currentPath:[...e.currentPath,"anyOf","0"]}));return t&&{anyOf:[t,{type:"null"}]}}function fp(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",$o(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?te(t,"minimum",n.value,n.message,e):te(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),te(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?te(t,"maximum",n.value,n.message,e):te(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),te(t,"maximum",n.value,n.message,e));break;case"multipleOf":te(t,"multipleOf",n.value,n.message,e);break}return t}function pp(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},i=[],s=r.shape();for(let o in s){let u=s[o];if(u===void 0||u._def===void 0)continue;let c=Vw(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);let d=Z(u._def,m(l({},e),{currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]}));d!==void 0&&(n.properties[o]=d,c||i.push(o))}i.length&&(n.required=i);let a=qw(r,e);return a!==void 0&&(n.additionalProperties=a),n}function qw(r,e){if(r.catchall._def.typeName!=="ZodNever")return Z(r.catchall._def,m(l({},e),{currentPath:[...e.currentPath,"additionalProperties"]}));switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Vw(r){try{return r.isOptional()}catch{return!0}}var hp=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return Z(r.innerType._def,e);let t=Z(r.innerType._def,m(l({},e),{currentPath:[...e.currentPath,"anyOf","1"]}));return t?{anyOf:[{not:ae(e)},t]}:ae(e)};var mp=(r,e)=>{if(e.pipeStrategy==="input")return Z(r.in._def,e);if(e.pipeStrategy==="output")return Z(r.out._def,e);let t=Z(r.in._def,m(l({},e),{currentPath:[...e.currentPath,"allOf","0"]})),n=Z(r.out._def,m(l({},e),{currentPath:[...e.currentPath,"allOf",t?"1":"0"]}));return{allOf:[t,n].filter(i=>i!==void 0)}};function gp(r,e){return Z(r.type._def,e)}function _p(r,e){let n={type:"array",uniqueItems:!0,items:Z(r.valueType._def,m(l({},e),{currentPath:[...e.currentPath,"items"]}))};return r.minSize&&te(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&te(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function yp(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Z(t._def,m(l({},e),{currentPath:[...e.currentPath,"items",`${n}`]}))).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Z(r.rest._def,m(l({},e),{currentPath:[...e.currentPath,"additionalItems"]}))}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Z(t._def,m(l({},e),{currentPath:[...e.currentPath,"items",`${n}`]}))).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function bp(r){return{not:ae(r)}}function wp(r){return ae(r)}var vp=(r,e)=>Z(r.innerType._def,e);var xp=(r,e,t)=>{switch(e){case S.ZodString:return os(r,t);case S.ZodNumber:return fp(r,t);case S.ZodObject:return pp(r,t);case S.ZodBigInt:return Kf(r,t);case S.ZodBoolean:return Yf();case S.ZodDate:return Io(r,t);case S.ZodUndefined:return bp(t);case S.ZodNull:return up(t);case S.ZodArray:return Wf(r,t);case S.ZodUnion:case S.ZodDiscriminatedUnion:return lp(r,t);case S.ZodIntersection:return rp(r,t);case S.ZodTuple:return yp(r,t);case S.ZodRecord:return us(r,t);case S.ZodLiteral:return np(r,t);case S.ZodEnum:return tp(r);case S.ZodNativeEnum:return ap(r);case S.ZodNullable:return dp(r,t);case S.ZodOptional:return hp(r,t);case S.ZodMap:return sp(r,t);case S.ZodSet:return _p(r,t);case S.ZodLazy:return()=>r.getter()._def;case S.ZodPromise:return gp(r,t);case S.ZodNaN:case S.ZodNever:return op(t);case S.ZodEffects:return ep(r,t);case S.ZodAny:return ae(t);case S.ZodUnknown:return wp(t);case S.ZodDefault:return Qf(r,t);case S.ZodBranded:return as(r,t);case S.ZodReadonly:return vp(r,t);case S.ZodCatch:return Xf(r,t);case S.ZodPipeline:return mp(r,t);case S.ZodFunction:case S.ZodVoid:case S.ZodSymbol:return;default:return(n=>{})(e)}};function Z(r,e,t=!1){let n=e.seen.get(r);if(e.override){let o=e.override?.(r,e,n,t);if(o!==Vf)return o}if(n&&!t){let o=Hw(n,e);if(o!==void 0)return o}let i={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,i);let s=xp(r,r.typeName,e),a=typeof s=="function"?Z(s(),e):s;if(a&&Jw(r,e,a),e.postProcess){let o=e.postProcess(a,r,e);return i.jsonSchema=a,o}return i.jsonSchema=a,a}var Hw=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:ss(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ae(e)):e.$refStrategy==="seen"?ae(e):void 0}},Jw=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var ko=(r,e)=>{let t=Jf(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,d])=>m(l({},u),{[c]:Z(d._def,m(l({},t),{currentPath:[...t.basePath,t.definitionPath,c]}),!0)??ae(t)}),{}):void 0,i=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=Z(r._def,i===void 0?t:m(l({},t),{currentPath:[...t.basePath,t.definitionPath,i]}),!1)??ae(t),a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a),t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=i===void 0?n?m(l({},s),{[t.definitionPath]:n}):s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:m(l({},n),{[i]:s})};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Vt(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(!Vt(r[i],e[i]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(let a of n)if(!Vt(r[a],e[a]))return!1;return!0}return r===e}function Je(r){return encodeURI(Ww(r))}function Ww(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var Kw={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},Yw={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},Xw={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},Qw=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function ht(r,e=Object.create(null),t=Qw,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){let s=r.$id||r.id;if(s){let a=new URL(s,t.href);a.hash.length>1?e[a.href]=r:(a.hash="",n===""?t=a:ht(r,e,t))}}else if(r!==!0&&r!==!1)return e;let i=t.href+(n?"#"+n:"");if(e[i]!==void 0)throw new Error(`Duplicate schema URI "${i}".`);if(e[i]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:i}),r.$ref&&r.__absolute_ref__===void 0){let s=new URL(r.$ref,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:s.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){let s=new URL(r.$recursiveRef,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:s.href})}if(r.$anchor){let s=new URL("#"+r.$anchor,t.href);e[s.href]=r}for(let s in r){if(Xw[s])continue;let a=`${n}/${Je(s)}`,o=r[s];if(Array.isArray(o)){if(Kw[s]){let u=o.length;for(let c=0;c<u;c++)ht(o[c],e,t,`${a}/${c}`)}}else if(Yw[s])for(let u in o)ht(o[u],e,t,`${a}/${Je(u)}`);else ht(o,e,t,a)}return e}var ev=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,tv=[0,31,28,31,30,31,30,31,31,30,31,30,31],rv=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,nv=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,iv=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,sv=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,av=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,ov=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,uv=/^(?:\/(?:[^~/]|~0|~1)*)*$/,cv=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,lv=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,dv=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(i=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(i))},fv=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,pv=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,hv=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function St(r){return r.test.bind(r)}var Ro={date:Ep,time:Sp.bind(void 0,!1),"date-time":_v,duration:hv,uri:wv,"uri-reference":St(iv),"uri-template":St(sv),url:St(av),email:dv,hostname:St(nv),ipv4:St(fv),ipv6:St(pv),regex:xv,uuid:St(ov),"json-pointer":St(uv),"json-pointer-uri-fragment":St(cv),"relative-json-pointer":St(lv)};function mv(r){return r%4===0&&(r%100!==0||r%400===0)}function Ep(r){let e=r.match(ev);if(!e)return!1;let t=+e[1],n=+e[2],i=+e[3];return n>=1&&n<=12&&i>=1&&i<=(n==2&&mv(t)?29:tv[n])}function Sp(r,e){let t=e.match(rv);if(!t)return!1;let n=+t[1],i=+t[2],s=+t[3],a=!!t[5];return(n<=23&&i<=59&&s<=59||n==23&&i==59&&s==60)&&(!r||a)}var gv=/t|\s/i;function _v(r){let e=r.split(gv);return e.length==2&&Ep(e[0])&&Sp(!0,e[1])}var yv=/\/|:/,bv=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function wv(r){return yv.test(r)&&bv.test(r)}var vv=/[^\\]\\Z/;function xv(r){if(vv.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}function Tp(r){let e=0,t=r.length,n=0,i;for(;n<t;)e++,i=r.charCodeAt(n++),i>=55296&&i<=56319&&n<t&&(i=r.charCodeAt(n),(i&64512)==56320&&n++);return e}function oe(r,e,t="2019-09",n=ht(e),i=!0,s=null,a="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};let c=typeof r,d;switch(c){case"boolean":case"number":case"string":d=c;break;case"object":r===null?d="null":Array.isArray(r)?d="array":d="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}let{$ref:p,$recursiveRef:h,$recursiveAnchor:g,type:_,const:b,enum:y,required:v,not:w,anyOf:T,allOf:N,oneOf:U,if:M,then:ee,else:G,format:re,properties:Ge,patternProperties:We,additionalProperties:pe,unevaluatedProperties:be,minProperties:Ot,maxProperties:mt,propertyNames:Vo,dependentRequired:vs,dependentSchemas:xs,dependencies:Es,prefixItems:Ss,items:Mr,additionalItems:Ho,unevaluatedItems:Jo,contains:Wo,minContains:$t,maxContains:xn,minItems:Ts,maxItems:Os,uniqueItems:Gp,minimum:Ht,maximum:Jt,exclusiveMinimum:Dr,exclusiveMaximum:Ur,multipleOf:En,minLength:Sn,maxLength:Tn,pattern:Ko,__absolute_ref__:On,__absolute_recursive_ref__:qp}=e,k=[];if(g===!0&&s===null&&(s=e),h==="#"){let F=s===null?n[qp]:s,z=`${o}/$recursiveRef`,V=oe(r,s===null?e:s,t,n,i,F,a,z,u);V.valid||k.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:z,error:"A subschema had errors."},...V.errors)}if(p!==void 0){let z=n[On||p];if(z===void 0){let $=`Unresolved $ref "${p}".`;throw On&&On!==p&&($+=`  Absolute URI "${On}".`),$+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error($)}let V=`${o}/$ref`,R=oe(r,z,t,n,i,s,a,V,u);if(R.valid||k.push({instanceLocation:a,keyword:"$ref",keywordLocation:V,error:"A subschema had errors."},...R.errors),t==="4"||t==="7")return{valid:k.length===0,errors:k}}if(Array.isArray(_)){let F=_.length,z=!1;for(let V=0;V<F;V++)if(d===_[V]||_[V]==="integer"&&d==="number"&&r%1===0&&r===r){z=!0;break}z||k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_.join('", "')}".`})}else _==="integer"?(d!=="number"||r%1||r!==r)&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_}".`}):_!==void 0&&d!==_&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_}".`});if(b!==void 0&&(d==="object"||d==="array"?Vt(r,b)||k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`}):r!==b&&k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(b)}.`})),y!==void 0&&(d==="object"||d==="array"?y.some(F=>Vt(r,F))||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`}):y.some(F=>r===F)||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`})),w!==void 0){let F=`${o}/not`;oe(r,w,t,n,i,s,a,F).valid&&k.push({instanceLocation:a,keyword:"not",keywordLocation:F,error:'Instance matched "not" schema.'})}let $n=[];if(T!==void 0){let F=`${o}/anyOf`,z=k.length,V=!1;for(let R=0;R<T.length;R++){let $=T[R],q=Object.create(u),B=oe(r,$,t,n,i,g===!0?s:null,a,`${F}/${R}`,q);k.push(...B.errors),V=V||B.valid,B.valid&&$n.push(q)}V?k.length=z:k.splice(z,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:F,error:"Instance does not match any subschemas."})}if(N!==void 0){let F=`${o}/allOf`,z=k.length,V=!0;for(let R=0;R<N.length;R++){let $=N[R],q=Object.create(u),B=oe(r,$,t,n,i,g===!0?s:null,a,`${F}/${R}`,q);k.push(...B.errors),V=V&&B.valid,B.valid&&$n.push(q)}V?k.length=z:k.splice(z,0,{instanceLocation:a,keyword:"allOf",keywordLocation:F,error:"Instance does not match every subschema."})}if(U!==void 0){let F=`${o}/oneOf`,z=k.length,V=U.filter((R,$)=>{let q=Object.create(u),B=oe(r,R,t,n,i,g===!0?s:null,a,`${F}/${$}`,q);return k.push(...B.errors),B.valid&&$n.push(q),B.valid}).length;V===1?k.length=z:k.splice(z,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:F,error:`Instance does not match exactly one subschema (${V} matches).`})}if((d==="object"||d==="array")&&Object.assign(u,...$n),M!==void 0){let F=`${o}/if`;if(oe(r,M,t,n,i,s,a,F,u).valid){if(ee!==void 0){let V=oe(r,ee,t,n,i,s,a,`${o}/then`,u);V.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:F,error:'Instance does not match "then" schema.'},...V.errors)}}else if(G!==void 0){let V=oe(r,G,t,n,i,s,a,`${o}/else`,u);V.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:F,error:'Instance does not match "else" schema.'},...V.errors)}}if(d==="object"){if(v!==void 0)for(let R of v)R in r||k.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${R}".`});let F=Object.keys(r);if(Ot!==void 0&&F.length<Ot&&k.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${Ot} properties.`}),mt!==void 0&&F.length>mt&&k.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${mt} properties.`}),Vo!==void 0){let R=`${o}/propertyNames`;for(let $ in r){let q=`${a}/${Je($)}`,B=oe($,Vo,t,n,i,s,q,R);B.valid||k.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:R,error:`Property name "${$}" does not match schema.`},...B.errors)}}if(vs!==void 0){let R=`${o}/dependantRequired`;for(let $ in vs)if($ in r){let q=vs[$];for(let B of q)B in r||k.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:R,error:`Instance has "${$}" but does not have "${B}".`})}}if(xs!==void 0)for(let R in xs){let $=`${o}/dependentSchemas`;if(R in r){let q=oe(r,xs[R],t,n,i,s,a,`${$}/${Je(R)}`,u);q.valid||k.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:$,error:`Instance has "${R}" but does not match dependant schema.`},...q.errors)}}if(Es!==void 0){let R=`${o}/dependencies`;for(let $ in Es)if($ in r){let q=Es[$];if(Array.isArray(q))for(let B of q)B in r||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${$}" but does not have "${B}".`});else{let B=oe(r,q,t,n,i,s,a,`${R}/${Je($)}`);B.valid||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${$}" but does not match dependant schema.`},...B.errors)}}}let z=Object.create(null),V=!1;if(Ge!==void 0){let R=`${o}/properties`;for(let $ in Ge){if(!($ in r))continue;let q=`${a}/${Je($)}`,B=oe(r[$],Ge[$],t,n,i,s,q,`${R}/${Je($)}`);if(B.valid)u[$]=z[$]=!0;else if(V=i,k.push({instanceLocation:a,keyword:"properties",keywordLocation:R,error:`Property "${$}" does not match schema.`},...B.errors),V)break}}if(!V&&We!==void 0){let R=`${o}/patternProperties`;for(let $ in We){let q=new RegExp($,"u"),B=We[$];for(let Me in r){if(!q.test(Me))continue;let Yo=`${a}/${Je(Me)}`,Xo=oe(r[Me],B,t,n,i,s,Yo,`${R}/${Je($)}`);Xo.valid?u[Me]=z[Me]=!0:(V=i,k.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:R,error:`Property "${Me}" matches pattern "${$}" but does not match associated schema.`},...Xo.errors))}}}if(!V&&pe!==void 0){let R=`${o}/additionalProperties`;for(let $ in r){if(z[$])continue;let q=`${a}/${Je($)}`,B=oe(r[$],pe,t,n,i,s,q,R);B.valid?u[$]=!0:(V=i,k.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:R,error:`Property "${$}" does not match additional properties schema.`},...B.errors))}}else if(!V&&be!==void 0){let R=`${o}/unevaluatedProperties`;for(let $ in r)if(!u[$]){let q=`${a}/${Je($)}`,B=oe(r[$],be,t,n,i,s,q,R);B.valid?u[$]=!0:k.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:R,error:`Property "${$}" does not match unevaluated properties schema.`},...B.errors)}}}else if(d==="array"){Os!==void 0&&r.length>Os&&k.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${Os}).`}),Ts!==void 0&&r.length<Ts&&k.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${Ts}).`});let F=r.length,z=0,V=!1;if(Ss!==void 0){let R=`${o}/prefixItems`,$=Math.min(Ss.length,F);for(;z<$;z++){let q=oe(r[z],Ss[z],t,n,i,s,`${a}/${z}`,`${R}/${z}`);if(u[z]=!0,!q.valid&&(V=i,k.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:R,error:"Items did not match schema."},...q.errors),V))break}}if(Mr!==void 0){let R=`${o}/items`;if(Array.isArray(Mr)){let $=Math.min(Mr.length,F);for(;z<$;z++){let q=oe(r[z],Mr[z],t,n,i,s,`${a}/${z}`,`${R}/${z}`);if(u[z]=!0,!q.valid&&(V=i,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...q.errors),V))break}}else for(;z<F;z++){let $=oe(r[z],Mr,t,n,i,s,`${a}/${z}`,R);if(u[z]=!0,!$.valid&&(V=i,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...$.errors),V))break}if(!V&&Ho!==void 0){let $=`${o}/additionalItems`;for(;z<F;z++){let q=oe(r[z],Ho,t,n,i,s,`${a}/${z}`,$);u[z]=!0,q.valid||(V=i,k.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:$,error:"Items did not match additional items schema."},...q.errors))}}}if(Wo!==void 0)if(F===0&&$t===void 0)k.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if($t!==void 0&&F<$t)k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${F}) than minContains (${$t}).`});else{let R=`${o}/contains`,$=k.length,q=0;for(let B=0;B<F;B++){let Me=oe(r[B],Wo,t,n,i,s,`${a}/${B}`,R);Me.valid?(u[B]=!0,q++):k.push(...Me.errors)}q>=($t||0)&&(k.length=$),$t===void 0&&xn===void 0&&q===0?k.splice($,0,{instanceLocation:a,keyword:"contains",keywordLocation:R,error:"Array does not contain item matching schema."}):$t!==void 0&&q<$t?k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${$t} items matching schema. Only ${q} items were found.`}):xn!==void 0&&q>xn&&k.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${xn} items matching schema. ${q} items were found.`})}if(!V&&Jo!==void 0){let R=`${o}/unevaluatedItems`;for(z;z<F;z++){if(u[z])continue;let $=oe(r[z],Jo,t,n,i,s,`${a}/${z}`,R);u[z]=!0,$.valid||k.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:R,error:"Items did not match unevaluated items schema."},...$.errors)}}if(Gp)for(let R=0;R<F;R++){let $=r[R],q=typeof $=="object"&&$!==null;for(let B=0;B<F;B++){if(R===B)continue;let Me=r[B];($===Me||q&&(typeof Me=="object"&&Me!==null)&&Vt($,Me))&&(k.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${R} and ${B}.`}),R=Number.MAX_SAFE_INTEGER,B=Number.MAX_SAFE_INTEGER)}}}else if(d==="number"){if(t==="4"?(Ht!==void 0&&(Dr===!0&&r<=Ht||r<Ht)&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${Dr?"or equal to ":""} ${Ht}.`}),Jt!==void 0&&(Ur===!0&&r>=Jt||r>Jt)&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Ur?"or equal to ":""} ${Jt}.`})):(Ht!==void 0&&r<Ht&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${Ht}.`}),Jt!==void 0&&r>Jt&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Jt}.`}),Dr!==void 0&&r<=Dr&&k.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${Dr}.`}),Ur!==void 0&&r>=Ur&&k.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${Ur}.`})),En!==void 0){let F=r%En;Math.abs(0-F)>=11920929e-14&&Math.abs(En-F)>=11920929e-14&&k.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${En}.`})}}else if(d==="string"){let F=Sn===void 0&&Tn===void 0?0:Tp(r);Sn!==void 0&&F<Sn&&k.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${F} < ${Sn}).`}),Tn!==void 0&&F>Tn&&k.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${F} > ${Tn}).`}),Ko!==void 0&&!new RegExp(Ko,"u").test(r)&&k.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),re!==void 0&&Ro[re]&&!Ro[re](r)&&k.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${re}".`})}return{valid:k.length===0,errors:k}}var cs=class{schema;draft;shortCircuit;lookup;constructor(e,t="2019-09",n=!0){this.schema=e,this.draft=t,this.shortCircuit=n,this.lookup=ht(e)}validate(e){return oe(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e=m(l({},e),{$id:t})),ht(e,this.lookup)}};function me(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_zod"in e))return!1;let t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function ge(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_def"in e)||"_zod"in e)return!1;let t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Xk(r){return me(r)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),ge(r)}function $p(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(me(r)||ge(r))}function Qk(r,e){return f(this,null,function*(){if(me(r))try{return{success:!0,data:yield Lf(r,e)}}catch(t){return{success:!1,error:t}}if(ge(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")})}function Ip(r,e){return f(this,null,function*(){if(me(r))return gn(r,e);if(ge(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")})}function eR(r,e){if(me(r))try{return{success:!0,data:gn(r,e)}}catch(t){return{success:!1,error:t}}if(ge(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function tR(r,e){if(me(r))return gn(r,e);if(ge(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Ap(r){if(me(r))return Be.get(r)?.description;if(ge(r)||"description"in r&&typeof r.description=="string")return r.description}function rR(r){if(!$p(r))return!1;if(ge(r)){let e=r._def;if(e.typeName==="ZodObject"){let t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(me(r)){let e=r._zod.def;if(e.type==="object"){let t=r;return!t.shape||Object.keys(t.shape).length===0}if(e.type==="record")return!0}return typeof r=="object"&&r!==null&&!("shape"in r)}function Pp(r){return $p(r)?ge(r)?r._def.typeName==="ZodString":me(r)?r._zod.def.type==="string":!1:!1}function kp(r){return typeof r=="object"&&r!==null&&"_def"in r&&typeof r._def=="object"&&r._def!==null&&"typeName"in r._def&&r._def.typeName==="ZodObject"}function Tt(r){return me(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function No(r){return me(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function nR(r){return!!(kp(r)||Tt(r))}function iR(r){if(ge(r))return r.shape;if(me(r))return r._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function sR(r,e){if(ge(r))return r.extend(e);if(me(r))return Nt.extend(r,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function aR(r){if(ge(r))return r.partial();if(me(r))return Nt.partial(Ff,r,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function ls(r,e=!1){if(ge(r))return r.strict();if(Tt(r)){let t=r._zod.def.shape;if(e)for(let[s,a]of Object.entries(r._zod.def.shape)){if(Tt(a)){let u=ls(a,e);t[s]=u}else if(No(a)){let u=a._zod.def.element;Tt(u)&&(u=ls(u,e)),t[s]=je(a,m(l({},a._zod.def),{element:u}))}else t[s]=a;let o=Be.get(a);o&&Be.add(t[s],o)}let n=je(r,m(l({},r._zod.def),{shape:t,catchall:Gf(Zf)})),i=Be.get(r);return i&&Be.add(n,i),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Op(r,e=!1){if(kp(r))return r.passthrough();if(Tt(r)){let t=r._zod.def.shape;if(e)for(let[s,a]of Object.entries(r._zod.def.shape)){if(Tt(a)){let u=Op(a,e);t[s]=u}else if(No(a)){let u=a._zod.def.element;Tt(u)&&(u=Op(u,e)),t[s]=je(a,m(l({},a._zod.def),{element:u}))}else t[s]=a;let o=Be.get(a);o&&Be.add(t[s],o)}let n=je(r,m(l({},r._zod.def),{shape:t,catchall:Bf(Uf)})),i=Be.get(r);return i&&Be.add(n,i),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function oR(r){if(ge(r))try{let e=r.parse(void 0);return()=>e}catch{return}if(me(r))try{let e=gn(r,void 0);return()=>e}catch{return}}function Ev(r){return ge(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function Sv(r){return me(r)&&r._zod.def.type==="pipe"}function Nr(r,e=!1){if(ge(r))return Ev(r)?Nr(r._def.schema,e):r;if(me(r)){let t=r;if(Sv(r)&&(t=Nr(r._zod.def.in,e)),e){if(Tt(t)){let i=t._zod.def.shape;for(let[s,a]of Object.entries(t._zod.def.shape))i[s]=Nr(a,e);t=je(t,m(l({},t._zod.def),{shape:i}))}else if(No(t)){let i=Nr(t._zod.def.element,e);t=je(t,m(l({},t._zod.def),{element:i}))}}let n=Be.get(r);return n&&Be.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Co(r){if(me(r)){let e=Nr(r,!0);if(Tt(e)){let t=ls(e,!0);return Oo(t)}else return Oo(r)}return ge(r)?ko(r):r}function ds(r){if(!r||typeof r!="object"||Object.keys(r).length===0||Array.isArray(r))return!1;if("type"in r)return typeof r.type=="string"?r.type==="string":Array.isArray(r.type)?r.type.every(e=>e==="string"):!1;if("enum"in r)return Array.isArray(r.enum)&&r.enum.length>0&&r.enum.every(e=>typeof e=="string");if("const"in r)return typeof r.const=="string";if("allOf"in r&&Array.isArray(r.allOf))return r.allOf.some(e=>ds(e));if("anyOf"in r&&Array.isArray(r.anyOf)||"oneOf"in r&&Array.isArray(r.oneOf)){let e="anyOf"in r?r.anyOf:r.oneOf;return e.length>0&&e.every(t=>ds(t))}if("not"in r)return!1;if("$ref"in r&&typeof r.$ref=="string"){let e=r.$ref,t=ht(r);return t[e]?ds(t[e]):!1}return!1}function Ov(r,e){if(r!==void 0&&!Dt(r))return r;if(fn(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function $v(r){return fn(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:m(l({},Co(r.data.schema)),{title:r.data.name})}}var bn=class r{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Dt(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>l({id:e[t.id]},$v(t))),edges:this.edges.map(t=>{let n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let i=t??de(),s={id:i,data:e,name:Ov(t,e),metadata:n};return this.nodes[i]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:n,conditional:i};return this.edges.push(s),s}firstNode(){return Rp(this)}lastNode(){return Np(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(Dt)&&(n="");let s=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,d])=>{this.nodes[s(c)]=m(l({},d),{id:s(c)})});let a=e.edges.map(c=>m(l({},c),{source:s(c.source),target:s(c.target)}));this.edges=[...this.edges,...a];let o=e.firstNode(),u=e.lastNode();return[o?{id:s(o.id),data:o.data}:void 0,u?{id:s(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&Rp(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&Np(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),t=new Map;Object.values(e).forEach(i=>{t.set(i,(t.get(i)||0)+1)});let n=i=>{let s=e[i];return Dt(i)&&t.get(s)===1?s:i};return new r({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,s])=>[n(i),m(l({},s),{id:n(i)})])),edges:this.edges.map(i=>m(l({},i),{source:n(i.source),target:n(i.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:n,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:s}=e??{},a=this.reid(),o=a.firstNode(),u=a.lastNode();return xf(a.nodes,a.edges,{firstNode:o?.id,lastNode:u?.id,withStyles:t,curveStyle:n,nodeColors:i,wrapLabelNWords:s})}drawMermaidPng(e){return f(this,null,function*(){let t=this.drawMermaid(e);return Ef(t,{backgroundColor:e?.backgroundColor})})}};function Rp(r,e=[]){let t=new Set(r.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),n=[];for(let i of Object.values(r.nodes))!e.includes(i.id)&&!t.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function Np(r,e=[]){let t=new Set(r.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),n=[];for(let i of Object.values(r.nodes))!e.includes(i.id)&&!t.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function Cp(r){let e=new TextEncoder,t=new ReadableStream({start(i){return f(this,null,function*(){try{for(var s=X(r),a,o,u;a=!(o=yield s.next()).done;a=!1){let c=o.value;i.enqueue(e.encode(`event: data
data: ${JSON.stringify(c)}

`))}}catch{u=[o]}finally{try{a&&(o=s.return)&&(yield o.call(s))}finally{if(u)throw u[0]}}i.enqueue(e.encode(`event: end

`)),i.close()})}});return Te.fromReadableStream(t)}function jo(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}var jp=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function fs(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Lo(r,e){for(;;){let{value:t,done:n}=He.runWithConfig(Rt(r),e.next.bind(e),!0);if(n)break;yield t}}function ps(r,e){return H(this,null,function*(){let t=e[Symbol.asyncIterator]();for(;;){let{value:n,done:i}=yield new x(He.runWithConfig(Rt(r),t.next.bind(e),!0));if(i)break;yield n}})}function _e(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var ye=class extends Ke{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new dr({bound:this,kwargs:e,config:{}})}map(){return new Mo({bound:this})}withRetry(e){return new hs(l({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt},e))}withConfig(e){return new dr({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new Uo({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ne);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,s)=>ne(s===0?e:n))}return Array.from({length:t},()=>ne(e))}batch(e,t,n){return f(this,null,function*(){let i=this._getOptionsList(t??{},e.length),s=i[0]?.maxConcurrency??n?.maxConcurrency,a=new ln({maxConcurrency:s,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(()=>f(this,null,function*(){try{return yield this.invoke(u,i[c])}catch(d){if(n?.returnExceptions)return d;throw d}})));return Promise.all(o)})}_streamIterator(e,t){return H(this,null,function*(){yield this.invoke(e,t)})}stream(e,t){return f(this,null,function*(){let n=ne(t),i=new Et({generator:this._streamIterator(e,n),config:n});return yield i.setup,Te.fromAsyncGenerator(i)})}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ne(e):t=ne({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n=l({},e);return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}_callWithConfig(e,t,n){return f(this,null,function*(){let i=ne(n),a=yield(yield st(i))?.handleChainStart(this.toJSON(),_e(t,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;let o;try{let u=e.call(this,t,i,a);o=yield xt(u,n?.signal)}catch(u){throw yield a?.handleChainError(u),u}return yield a?.handleChainEnd(_e(o,"output")),o})}_batchWithConfig(e,t,n,i){return f(this,null,function*(){let s=this._getOptionsList(n??{},t.length),a=yield Promise.all(s.map(st)),o=yield Promise.all(a.map((c,d)=>f(this,null,function*(){let p=yield c?.handleChainStart(this.toJSON(),_e(t[d],"input"),s[d].runId,s[d].runType,void 0,void 0,s[d].runName??this.getName());return delete s[d].runId,p}))),u;try{let c=e.call(this,t,s,o,i);u=yield xt(c,s?.[0]?.signal)}catch(c){throw yield Promise.all(o.map(d=>d?.handleChainError(c))),c}return yield Promise.all(o.map(c=>c?.handleChainEnd(_e(u,"output")))),u})}_transformStreamWithConfig(e,t,n){return H(this,null,function*(){let i,s=!0,a,o=!0,u=ne(n),c=yield new x(st(u));function d(){return H(this,null,function*(){try{for(var y=X(e),v,w,T;v=!(w=yield new x(y.next())).done;v=!1){let N=w.value;if(s)if(i===void 0)i=N;else try{i=dt(i,N)}catch{i=void 0,s=!1}yield N}}catch{T=[w]}finally{try{v&&(w=y.return)&&(yield new x(w.call(y)))}finally{if(T)throw T[0]}}})}let p;try{let y=yield new x(po(t.bind(this),d(),()=>f(this,null,function*(){return c?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName())}),n?.signal,u));delete u.runId,p=y.setup;let v=p?.handlers.find(wf),w=y.output;v!==void 0&&p!==void 0&&(w=v.tapOutputIterable(p.runId,w));let T=p?.handlers.find(ho);T!==void 0&&p!==void 0&&(w=T.tapOutputIterable(p.runId,w));try{for(var h=X(w),g,_,b;g=!(_=yield new x(h.next())).done;g=!1){let N=_.value;if(yield N,o)if(a===void 0)a=N;else try{a=dt(a,N)}catch{a=void 0,o=!1}}}catch{b=[_]}finally{try{g&&(_=h.return)&&(yield new x(_.call(h)))}finally{if(b)throw b[0]}}}catch(y){throw yield new x(p?.handleChainError(y,void 0,void 0,void 0,{inputs:_e(i,"input")})),y}yield new x(p?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:_e(i,"input")}))})}getGraph(e){let t=new bn,n=t.addNode({name:`${this.getName()}Input`,schema:Mt.any()}),i=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:Mt.any()});return t.addEdge(n,i),t.addEdge(i,s),t}pipe(e){return new ms({first:this,last:lr(e)})}pick(e){return this.pipe(new Fo(e))}assign(e){return this.pipe(new Zo(new Cr({steps:e})))}transform(e,t){return H(this,null,function*(){let n;try{for(var i=X(e),s,a,o;s=!(a=yield new x(i.next())).done;s=!1){let u=a.value;n===void 0?n=u:n=dt(n,u)}}catch{o=[a]}finally{try{s&&(a=i.return)&&(yield new x(a.call(i)))}finally{if(o)throw o[0]}}yield*ve(this._streamIterator(n,ne(t)))})}streamLog(e,t,n){return H(this,null,function*(){let i=new kr(m(l({},n),{autoClose:!1,_schemaFormat:"original"})),s=ne(t);yield*ve(this._streamLog(e,i,s))})}_streamLog(e,t,n){return H(this,null,function*(){let{callbacks:i}=n;if(i===void 0)n.callbacks=[t];else if(Array.isArray(i))n.callbacks=i.concat([t]);else{let h=i.copy();h.addHandler(t,!0),n.callbacks=h}let s=this.stream(e,n);function a(){return f(this,null,function*(){try{let y=yield s;try{for(var h=X(y),g,_,b;g=!(_=yield h.next()).done;g=!1){let v=_.value;let w=new at({ops:[{op:"add",path:"/streamed_output/-",value:v}]});yield t.writer.write(w)}}catch{b=[_]}finally{try{g&&(_=h.return)&&(yield _.call(h))}finally{if(b)throw b[0]}}}finally{yield t.writer.close()}})}let o=a();try{try{for(var u=X(t),c,d,p;c=!(d=yield new x(u.next())).done;c=!1){let h=d.value;yield h}}catch{p=[d]}finally{try{c&&(d=u.return)&&(yield new x(d.call(u)))}finally{if(p)throw p[0]}}}finally{yield new x(o)}})}streamEvents(e,t,n){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,n);else if(t.version==="v2")i=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?Cp(i):Te.fromAsyncGenerator(i)}_streamEventsV2(e,t,n){return H(this,null,function*(){let i=new Yi(m(l({},n),{autoClose:!1})),s=ne(t),a=s.runId??de();s.runId=a;let o=s.callbacks;if(o===void 0)s.callbacks=[i];else if(Array.isArray(o))s.callbacks=o.concat(i);else{let w=o.copy();w.addHandler(i,!0),s.callbacks=w}let u=new AbortController,c=this;function d(){return f(this,null,function*(){let w,T=null;try{t?.signal?"any"in AbortSignal?w=AbortSignal.any([u.signal,t.signal]):(w=t.signal,T=()=>{u.abort()},t.signal.addEventListener("abort",T,{once:!0})):w=u.signal;let G=yield c.stream(e,m(l({},s),{signal:w})),re=i.tapOutputIterable(a,G);try{for(var N=X(re),U,M,ee;U=!(M=yield N.next()).done;U=!1){let Ge=M.value;if(u.signal.aborted)break}}catch{ee=[M]}finally{try{U&&(M=N.return)&&(yield M.call(N))}finally{if(ee)throw ee[0]}}}finally{yield i.finish(),w&&T&&w.removeEventListener("abort",T)}})}let p=d(),h=!1,g;try{try{for(var _=X(i),b,y,v;b=!(y=yield new x(_.next())).done;b=!1){let w=y.value;if(!h){w.data.input=e,h=!0,g=w.run_id,yield w;continue}w.run_id===g&&w.event.endsWith("_end")&&w.data?.input&&delete w.data.input,yield w}}catch{v=[y]}finally{try{b&&(y=_.return)&&(yield new x(y.call(_)))}finally{if(v)throw v[0]}}}finally{u.abort(),yield new x(p)}})}_streamEventsV1(e,t,n){return H(this,null,function*(){let i,s=!1,a=ne(t),o=a.tags??[],u=a.metadata??{},c=a.runName??this.getName(),d=new kr(m(l({},n),{autoClose:!1,_schemaFormat:"streaming_events"})),p=new Qi(l({},n)),h=this._streamLog(e,d,a);try{for(var _=X(h),b,y,v;b=!(y=yield new x(_.next())).done;b=!1){let w=y.value;if(i?i=i.concat(w):i=Pr.fromRunLogPatch(w),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;let M=l({},i.state),ee={run_id:M.id,event:`on_${M.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};p.includeEvent(ee,M.type)&&(yield ee)}let T=w.ops.filter(M=>M.path.startsWith("/logs/")).map(M=>M.path.split("/")[2]),N=[...new Set(T)];for(let M of N){let ee,G={},re=i.state.logs[M];if(re.end_time===void 0?re.streamed_output.length>0?ee="stream":ee="start":ee="end",ee==="start")re.inputs!==void 0&&(G.input=re.inputs);else if(ee==="end")re.inputs!==void 0&&(G.input=re.inputs),G.output=re.final_output;else if(ee==="stream"){let Ge=re.streamed_output.length;if(Ge!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${Ge} instead. Encountered in: "${re.name}"`);G={chunk:re.streamed_output[0]},re.streamed_output=[]}yield{event:`on_${re.type}_${ee}`,name:re.name,run_id:re.id,tags:re.tags,metadata:re.metadata,data:G}}let{state:U}=i;if(U.streamed_output.length>0){let M=U.streamed_output.length;if(M!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${M} instead. Encountered in: "${U.name}"`);let ee={chunk:U.streamed_output[0]};U.streamed_output=[];let G={event:`on_${U.type}_stream`,run_id:U.id,tags:o,metadata:u,name:c,data:ee};p.includeEvent(G,U.type)&&(yield G)}}}catch{v=[y]}finally{try{b&&(y=_.return)&&(yield new x(y.call(_)))}finally{if(v)throw v[0]}}let g=i?.state;if(g!==void 0){let w={event:`on_${g.type}_end`,name:c,run_id:g.id,tags:o,metadata:u,data:{output:g.final_output}};p.includeEvent(w,g.type)&&(yield w)}})}static isRunnable(e){return fn(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new dr({bound:this,config:{},configFactories:[i=>({callbacks:[new dn({config:i,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return Av(this,e)}},dr=class r extends ye{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}_mergeConfig(...e){return f(this,null,function*(){let t=fo(this.config,...e);return fo(t,...this.configFactories?yield Promise.all(this.configFactories.map(n=>f(this,null,function*(){return yield n(t)}))):[])})}bind(e){return new this.constructor({bound:this.bound,kwargs:l(l({},this.kwargs),e),config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:l(l({},this.config),e)})}withRetry(e){return new hs(l({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt},e))}invoke(e,t){return f(this,null,function*(){return this.bound.invoke(e,yield this._mergeConfig(ne(t),this.kwargs))})}batch(e,t,n){return f(this,null,function*(){let i=Array.isArray(t)?yield Promise.all(t.map(s=>f(this,null,function*(){return this._mergeConfig(ne(s),this.kwargs)}))):yield this._mergeConfig(ne(t),this.kwargs);return this.bound.batch(e,i,n)})}_streamIterator(e,t){return H(this,null,function*(){yield*ve(this.bound._streamIterator(e,yield new x(this._mergeConfig(ne(t),this.kwargs))))})}stream(e,t){return f(this,null,function*(){return this.bound.stream(e,yield this._mergeConfig(ne(t),this.kwargs))})}transform(e,t){return H(this,null,function*(){yield*ve(this.bound.transform(e,yield new x(this._mergeConfig(ne(t),this.kwargs))))})}streamEvents(e,t,n){let i=this,s=function(){return H(this,null,function*(){yield*ve(i.bound.streamEvents(e,m(l({},yield new x(i._mergeConfig(ne(t),i.kwargs))),{version:t.version}),n))})};return Te.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&ye.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new dn({config:i,onStart:e,onEnd:t,onError:n})]})]})}},Mo=class r extends ye{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._invoke.bind(this),e,t)})}_invoke(e,t,n){return f(this,null,function*(){return this.bound.batch(e,Se(t,{callbacks:n?.getChild()}))})}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},hs=class r extends dr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){let i=e>1?`retry:attempt:${e}`:void 0;return Se(t,{callbacks:n?.getChild(i)})}_invoke(e,t,n){return f(this,null,function*(){return(0,zo.default)(i=>Is(r.prototype,this,"invoke").call(this,e,this._patchConfigForRetry(i,t,n)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._invoke.bind(this),e,t)})}_batch(e,t,n,i){return f(this,null,function*(){let s={};try{yield(0,zo.default)(a=>f(this,null,function*(){let o=e.map((h,g)=>g).filter(h=>s[h.toString()]===void 0||s[h.toString()]instanceof Error),u=o.map(h=>e[h]),c=o.map(h=>this._patchConfigForRetry(a,t?.[h],n?.[h])),d=yield Is(r.prototype,this,"batch").call(this,u,c,m(l({},i),{returnExceptions:!0})),p;for(let h=0;h<d.length;h+=1){let g=d[h],_=o[h];g instanceof Error&&p===void 0&&(p=g,p.input=u[h]),s[_.toString()]=g}if(p)throw p;return d}),{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(i?.returnExceptions!==!0)throw a}return Object.keys(s).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>s[parseInt(a,10)])})}batch(e,t,n){return f(this,null,function*(){return this._batchWithConfig(this._batch.bind(this),e,t,n)})}},ms=class r extends ye{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}invoke(e,t){return f(this,null,function*(){let n=ne(t),s=yield(yield st(n))?.handleChainStart(this.toJSON(),_e(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){let p=u[c].invoke(a,Se(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=yield xt(p,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=yield this.last.invoke(a,Se(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw yield s?.handleChainError(u),u}return yield s?.handleChainEnd(_e(o,"output")),o})}batch(e,t,n){return f(this,null,function*(){let i=this._getOptionsList(t??{},e.length),s=yield Promise.all(i.map(st)),a=yield Promise.all(s.map((u,c)=>f(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),_e(e[c],"input"),i[c].runId,void 0,void 0,void 0,i[c].runName);return delete i[c].runId,d}))),o=e;try{for(let u=0;u<this.steps.length;u+=1){let d=this.steps[u].batch(o,a.map((p,h)=>{let g=p?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return Se(i[h],{callbacks:g})}),n);o=yield xt(d,i[0]?.signal)}}catch(u){throw yield Promise.all(a.map(c=>c?.handleChainError(u))),u}return yield Promise.all(a.map(u=>u?.handleChainEnd(_e(o,"output")))),o})}_streamIterator(e,t){return H(this,null,function*(){let n=yield new x(st(t)),p=t??{},{runId:i}=p,s=se(p,["runId"]),a=yield new x(n?.handleChainStart(this.toJSON(),_e(e,"input"),i,void 0,void 0,void 0,s?.runName)),o=[this.first,...this.middle,this.last],u=!0,c;function d(){return H(this,null,function*(){yield e})}try{let y=o[0].transform(d(),Se(s,{callbacks:a?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let v=1;v<o.length;v+=1){let w=o[v];y=yield new x(w.transform(y,Se(s,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${v+1}`)})))}try{for(var h=X(y),g,_,b;g=!(_=yield new x(h.next())).done;g=!1){let v=_.value;if(t?.signal?.throwIfAborted(),yield v,u)if(c===void 0)c=v;else try{c=dt(c,v)}catch{c=void 0,u=!1}}}catch{b=[_]}finally{try{g&&(_=h.return)&&(yield new x(_.call(h)))}finally{if(b)throw b[0]}}}catch(y){throw yield new x(a?.handleChainError(y)),y}yield new x(a?.handleChainEnd(_e(c,"output")))})}getGraph(e){let t=new bn,n=null;return this.steps.forEach((i,s)=>{let a=i.getGraph(e);s!==0&&a.trimFirstNode(),s!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let o=a.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:lr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ye.isRunnable(e)}static from([e,...t],n){let i={};return typeof n=="string"?i.name=n:n!==void 0&&(i=n),new r(m(l({},i),{first:lr(e),middle:t.slice(0,-1).map(lr),last:lr(t[t.length-1])}))}},Cr=class r extends ye{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=lr(n)}static from(e){return new r({steps:e})}invoke(e,t){return f(this,null,function*(){let n=ne(t),s=yield(yield st(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a={};try{let o=Object.entries(this.steps).map(d=>f(this,[d],function*([u,c]){a[u]=yield c.invoke(e,Se(n,{callbacks:s?.getChild(`map:key:${u}`)}))}));yield xt(Promise.all(o),t?.signal)}catch(o){throw yield s?.handleChainError(o),o}return yield s?.handleChainEnd(a),a})}_transform(e,t,n){return H(this,null,function*(){let i=l({},this.steps),s=Wi(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([o,u],c)=>{let d=u.transform(s[c],Se(n,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,d.next().then(p=>({key:o,gen:d,result:p}))]}));for(;a.size;){let o=Promise.race(a.values()),{key:u,result:c,gen:d}=yield new x(xt(o,n?.signal));a.delete(u),c.done||(yield{[u]:c.value},a.set(u,d.next().then(p=>({key:u,gen:d,result:p}))))}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function n(){return H(this,null,function*(){yield e})}let i=ne(t),s=new Et({generator:this.transform(n(),i),config:i});return yield s.setup,Te.fromAsyncGenerator(s)})}},Do=class r extends ye{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!ri(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}invoke(e,t){return f(this,null,function*(){let[n]=this._getOptionsList(t??{},1),i=yield st(n),s=this.func(Se(n,{callbacks:i}),e);return xt(s,n?.signal)})}_streamIterator(e,t){return H(this,null,function*(){let[n]=this._getOptionsList(t??{},1),i=yield new x(this.invoke(e,t));if(fs(i)){try{for(var s=X(i),a,o,u;a=!(o=yield new x(s.next())).done;a=!1){let c=o.value;n?.signal?.throwIfAborted(),yield c}}catch{u=[o]}finally{try{a&&(o=s.return)&&(yield new x(o.call(s)))}finally{if(u)throw u[0]}}return}if(jp(i)){for(;;){n?.signal?.throwIfAborted();let c=i.next();if(c.done)break;yield c.value}return}yield i})}static from(e){return new r({func:e})}};function Iv(r){if(ri(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var gs=class r extends ye{static lc_name(){return"RunnableLambda"}constructor(e){if(ri(e.func))return Do.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Iv(e.func),this.func=e.func}static from(e){return new r({func:e})}_invoke(e,t,n){return f(this,null,function*(){return new Promise((i,s)=>{let a=Se(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??Ji)-1});He.runWithConfig(Rt(a),()=>f(this,null,function*(){try{let p=yield this.func(e,l({},a));if(p&&ye.isRunnable(p)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");p=yield p.invoke(e,m(l({},a),{recursionLimit:(a.recursionLimit??Ji)-1}))}else if(fs(p)){let h;try{for(var o=X(ps(a,p)),u,c,d;u=!(c=yield o.next()).done;u=!1){let g=c.value;if(t?.signal?.throwIfAborted(),h===void 0)h=g;else try{h=dt(h,g)}catch{h=g}}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield c.call(o))}finally{if(d)throw d[0]}}p=h}else if(jo(p)){let h;for(let g of Lo(a,p))if(t?.signal?.throwIfAborted(),h===void 0)h=g;else try{h=dt(h,g)}catch{h=g}p=h}i(p)}catch(p){s(p)}}))})})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._invoke.bind(this),e,t)})}_transform(e,t,n){return H(this,null,function*(){let i;try{for(var o=X(e),u,c,d;u=!(c=yield new x(o.next())).done;u=!1){let T=c.value;if(i===void 0)i=T;else try{i=dt(i,T)}catch{i=T}}}catch{d=[c]}finally{try{u&&(c=o.return)&&(yield new x(c.call(o)))}finally{if(d)throw d[0]}}let s=Se(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??Ji)-1}),a=yield new x(new Promise((T,N)=>{He.runWithConfig(Rt(s),()=>f(this,null,function*(){try{let U=yield this.func(i,m(l({},s),{config:s}));T(U)}catch(U){N(U)}}))}));if(a&&ye.isRunnable(a)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let T=yield new x(a.stream(i,s));try{for(var p=X(T),h,g,_;h=!(g=yield new x(p.next())).done;h=!1){let N=g.value;yield N}}catch{_=[g]}finally{try{h&&(g=p.return)&&(yield new x(g.call(p)))}finally{if(_)throw _[0]}}}else if(fs(a))try{for(var b=X(ps(s,a)),y,v,w;y=!(v=yield new x(b.next())).done;y=!1){let T=v.value;n?.signal?.throwIfAborted(),yield T}}catch{w=[v]}finally{try{y&&(v=b.return)&&(yield new x(v.call(b)))}finally{if(w)throw w[0]}}else if(jo(a))for(let T of Lo(s,a))n?.signal?.throwIfAborted(),yield T;else yield a})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function n(){return H(this,null,function*(){yield e})}let i=ne(t),s=new Et({generator:this.transform(n(),i),config:i});return yield s.setup,Te.fromAsyncGenerator(s)})}},Lp=class extends Cr{},Uo=class extends ye{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}invoke(e,t){return f(this,null,function*(){let n=ne(t),i=yield st(n),d=n,{runId:s}=d,a=se(d,["runId"]),o=yield i?.handleChainStart(this.toJSON(),_e(e,"input"),s,void 0,void 0,void 0,a?.runName),u=Se(a,{callbacks:o?.getChild()});return yield He.runWithConfig(u,()=>f(this,null,function*(){let p;for(let h of this.runnables()){n?.signal?.throwIfAborted();try{let g=yield h.invoke(e,u);return yield o?.handleChainEnd(_e(g,"output")),g}catch(g){p===void 0&&(p=g)}}throw p===void 0?new Error("No error stored at end of fallback."):(yield o?.handleChainError(p),p)}))})}_streamIterator(e,t){return H(this,null,function*(){let n=ne(t),i=yield new x(st(n)),p=n,{runId:s}=p,a=se(p,["runId"]),o=yield new x(i?.handleChainStart(this.toJSON(),_e(e,"input"),s,void 0,void 0,void 0,a?.runName)),u,c;for(let y of this.runnables()){n?.signal?.throwIfAborted();let v=Se(a,{callbacks:o?.getChild()});try{let w=yield new x(y.stream(e,v));c=ps(v,w);break}catch(w){u===void 0&&(u=w)}}if(c===void 0){let y=u??new Error("No error stored at end of fallback.");throw yield new x(o?.handleChainError(y)),y}let d;try{try{for(var h=X(c),g,_,b;g=!(_=yield new x(h.next())).done;g=!1){let y=_.value;yield y;try{d=d===void 0?d:dt(d,y)}catch{d=void 0}}}catch{b=[_]}finally{try{g&&(_=h.return)&&(yield new x(_.call(h)))}finally{if(b)throw b[0]}}}catch(y){throw yield new x(o?.handleChainError(y)),y}yield new x(o?.handleChainEnd(_e(d,"output")))})}batch(e,t,n){return f(this,null,function*(){if(n?.returnExceptions)throw new Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),s=yield Promise.all(i.map(u=>st(u))),a=yield Promise.all(s.map((u,c)=>f(this,null,function*(){let d=yield u?.handleChainStart(this.toJSON(),_e(e[c],"input"),i[c].runId,void 0,void 0,void 0,i[c].runName);return delete i[c].runId,d}))),o;for(let u of this.runnables()){i[0].signal?.throwIfAborted();try{let c=yield u.batch(e,a.map((d,p)=>Se(i[p],{callbacks:d?.getChild()})),n);return yield Promise.all(a.map((d,p)=>d?.handleChainEnd(_e(c[p],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(yield Promise.all(a.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")})}};function lr(r){if(typeof r=="function")return new gs({func:r});if(ye.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=lr(n);return new Cr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var Zo=class extends ye{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Cr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}invoke(e,t){return f(this,null,function*(){let n=yield this.mapper.invoke(e,t);return l(l({},e),n)})}_transform(e,t,n){return H(this,null,function*(){let i=this.mapper.getStepsKeys(),[s,a]=Wi(e),o=this.mapper.transform(a,Se(n,{callbacks:t?.getChild()})),u=o.next();try{for(var c=X(s),d,p,h;d=!(p=yield new x(c.next())).done;d=!1){let v=p.value;if(typeof v!="object"||Array.isArray(v))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof v}`);let w=Object.fromEntries(Object.entries(v).filter(([T])=>!i.includes(T)));Object.keys(w).length>0&&(yield w)}}catch{h=[p]}finally{try{d&&(p=c.return)&&(yield new x(p.call(c)))}finally{if(h)throw h[0]}}yield(yield new x(u)).value;try{for(var g=X(o),_,b,y;_=!(b=yield new x(g.next())).done;_=!1){let v=b.value;yield v}}catch{y=[b]}finally{try{_&&(b=g.return)&&(yield new x(b.call(g)))}finally{if(y)throw y[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function n(){return H(this,null,function*(){yield e})}let i=ne(t),s=new Et({generator:this.transform(n(),i),config:i});return yield s.setup,Te.fromAsyncGenerator(s)})}},Fo=class extends ye{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}_pick(e){return f(this,null,function*(){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}})}invoke(e,t){return f(this,null,function*(){return this._callWithConfig(this._pick.bind(this),e,t)})}_transform(e){return H(this,null,function*(){try{for(var t=X(e),n,i,s;n=!(i=yield new x(t.next())).done;n=!1){let a=i.value;let o=yield new x(this._pick(a));o!==void 0&&(yield o)}}catch{s=[i]}finally{try{n&&(i=t.return)&&(yield new x(i.call(t)))}finally{if(s)throw s[0]}}})}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}stream(e,t){return f(this,null,function*(){function n(){return H(this,null,function*(){yield e})}let i=ne(t),s=new Et({generator:this.transform(n(),i),config:i});return yield s.setup,Te.fromAsyncGenerator(s)})}},_s=class extends dr{constructor(e){let t=ms.from([gs.from(n=>f(this,null,function*(){let i;if(Cn(n))try{i=yield Ip(this.schema,n.args)}catch{throw new Nn("Received tool input did not match expected schema",JSON.stringify(n.args))}else i=n;return i})).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function Av(r,e){let t=e.name??r.getName(),n=e.description??Ap(e.schema);return Pp(e.schema)?new _s({name:t,description:n,schema:Mt.object({input:Mt.string()}).transform(i=>i.input),bound:r}):new _s({name:t,description:n,schema:e.schema,bound:r})}var ys=class extends ye{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}mergePartialAndUserVariables(e){return f(this,null,function*(){let t=this.partialVariables??{},n={};for(let[s,a]of Object.entries(t))typeof a=="string"?n[s]=a:n[s]=yield a();return l(l({},n),e)})}invoke(e,t){return f(this,null,function*(){let n=l(l({},this.metadata),t?.metadata),i=[...this.tags??[],...t?.tags??[]];return this._callWithConfig(s=>this.formatPromptValue(s),e,m(l({},t),{tags:i,metadata:n,runType:"prompt"}))})}serialize(){throw new Error("Use .toJSON() instead")}static deserialize(e){return f(this,null,function*(){switch(e._type){case"prompt":{let{PromptTemplate:t}=yield import("./chunk-QICOKQT3.js");return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=yield import("./chunk-QICOKQT3.js");return t.deserialize(m(l({},e),{_type:"prompt"}))}case"few_shot":{let{FewShotPromptTemplate:t}=yield import("./chunk-PCMHJPYA.js");return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}})}};var bs=class extends ys{formatPromptValue(e){return f(this,null,function*(){let t=yield this.format(e);return new Gr(t)})}};var Pv=Object.prototype.toString,Lr=Array.isArray||function(e){return Pv.call(e)==="[object Array]"};function Go(r){return typeof r=="function"}function kv(r){return Lr(r)?"array":typeof r}function Bo(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function zp(r,e){return r!=null&&typeof r=="object"&&e in r}function Rv(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var Nv=RegExp.prototype.test;function Cv(r,e){return Nv.call(r,e)}var jv=/\S/;function Lv(r){return!Cv(jv,r)}var zv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Mv(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return zv[t]})}var Dv=/\s*/,Uv=/\s+/,Mp=/\s*=/,Zv=/\s*\}/,Fv=/#|\^|\/|>|\{|&|=|!/;function Bv(r,e){if(!r)return[];var t=!1,n=[],i=[],s=[],a=!1,o=!1,u="",c=0;function d(){if(a&&!o)for(;s.length;)delete i[s.pop()];else s=[];a=!1,o=!1}var p,h,g;function _(G){if(typeof G=="string"&&(G=G.split(Uv,2)),!Lr(G)||G.length!==2)throw new Error("Invalid tags: "+G);p=new RegExp(Bo(G[0])+"\\s*"),h=new RegExp("\\s*"+Bo(G[1])),g=new RegExp("\\s*"+Bo("}"+G[1]))}_(e||ot.tags);for(var b=new vn(r),y,v,w,T,N,U;!b.eos();){if(y=b.pos,w=b.scanUntil(p),w)for(var M=0,ee=w.length;M<ee;++M)T=w.charAt(M),Lv(T)?(s.push(i.length),u+=T):(o=!0,t=!0,u+=" "),i.push(["text",T,y,y+1]),y+=1,T===`
`&&(d(),u="",c=0,t=!1);if(!b.scan(p))break;if(a=!0,v=b.scan(Fv)||"name",b.scan(Dv),v==="="?(w=b.scanUntil(Mp),b.scan(Mp),b.scanUntil(h)):v==="{"?(w=b.scanUntil(g),b.scan(Zv),b.scanUntil(h),v="&"):w=b.scanUntil(h),!b.scan(h))throw new Error("Unclosed tag at "+b.pos);if(v==">"?N=[v,w,y,b.pos,u,c,t]:N=[v,w,y,b.pos],c++,i.push(N),v==="#"||v==="^")n.push(N);else if(v==="/"){if(U=n.pop(),!U)throw new Error('Unopened section "'+w+'" at '+y);if(U[1]!==w)throw new Error('Unclosed section "'+U[1]+'" at '+y)}else v==="name"||v==="{"||v==="&"?o=!0:v==="="&&_(w)}if(d(),U=n.pop(),U)throw new Error('Unclosed section "'+U[1]+'" at '+b.pos);return qv(Gv(i))}function Gv(r){for(var e=[],t,n,i=0,s=r.length;i<s;++i)t=r[i],t&&(t[0]==="text"&&n&&n[0]==="text"?(n[1]+=t[1],n[3]=t[3]):(e.push(t),n=t));return e}function qv(r){for(var e=[],t=e,n=[],i,s,a=0,o=r.length;a<o;++a)switch(i=r[a],i[0]){case"#":case"^":t.push(i),n.push(i),t=i[4]=[];break;case"/":s=n.pop(),s[5]=i[2],t=n.length>0?n[n.length-1][4]:e;break;default:t.push(i)}return e}function vn(r){this.string=r,this.tail=r,this.pos=0}vn.prototype.eos=function(){return this.tail===""};vn.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};vn.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n};function jr(r,e){this.view=r,this.cache={".":this.view},this.parent=e}jr.prototype.push=function(e){return new jr(e,this)};jr.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var i=this,s,a,o,u=!1;i;){if(e.indexOf(".")>0)for(s=i.view,a=e.split("."),o=0;s!=null&&o<a.length;)o===a.length-1&&(u=zp(s,a[o])||Rv(s,a[o])),s=s[a[o++]];else s=i.view[e],u=zp(i.view,e);if(u){n=s;break}i=i.parent}t[e]=n}return Go(n)&&(n=n.call(this.view)),n};function ze(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}ze.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};ze.prototype.parse=function(e,t){var n=this.templateCache,i=e+":"+(t||ot.tags).join(":"),s=typeof n<"u",a=s?n.get(i):void 0;return a==null&&(a=Bv(e,t),s&&n.set(i,a)),a};ze.prototype.render=function(e,t,n,i){var s=this.getConfigTags(i),a=this.parse(e,s),o=t instanceof jr?t:new jr(t,void 0);return this.renderTokens(a,o,n,e,i)};ze.prototype.renderTokens=function(e,t,n,i,s){for(var a="",o,u,c,d=0,p=e.length;d<p;++d)c=void 0,o=e[d],u=o[0],u==="#"?c=this.renderSection(o,t,n,i,s):u==="^"?c=this.renderInverted(o,t,n,i,s):u===">"?c=this.renderPartial(o,t,n,s):u==="&"?c=this.unescapedValue(o,t):u==="name"?c=this.escapedValue(o,t,s):u==="text"&&(c=this.rawValue(o)),c!==void 0&&(a+=c);return a};ze.prototype.renderSection=function(e,t,n,i,s){var a=this,o="",u=t.lookup(e[1]);function c(h){return a.render(h,t,n,s)}if(u){if(Lr(u))for(var d=0,p=u.length;d<p;++d)o+=this.renderTokens(e[4],t.push(u[d]),n,i,s);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),n,i,s);else if(Go(u)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,i.slice(e[3],e[5]),c),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,n,i,s);return o}};ze.prototype.renderInverted=function(e,t,n,i,s){var a=t.lookup(e[1]);if(!a||Lr(a)&&a.length===0)return this.renderTokens(e[4],t,n,i,s)};ze.prototype.indentPartial=function(e,t,n){for(var i=t.replace(/[^ \t]/g,""),s=e.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=i+s[a]);return s.join(`
`)};ze.prototype.renderPartial=function(e,t,n,i){if(n){var s=this.getConfigTags(i),a=Go(n)?n(e[1]):n[e[1]];if(a!=null){var o=e[6],u=e[5],c=e[4],d=a;u==0&&c&&(d=this.indentPartial(a,c,o));var p=this.parse(d,s);return this.renderTokens(p,t,n,d,i)}}};ze.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n};ze.prototype.escapedValue=function(e,t,n){var i=this.getConfigEscape(n)||ot.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&i===ot.escape?String(s):i(s)};ze.prototype.rawValue=function(e){return e[1]};ze.prototype.getConfigTags=function(e){return Lr(e)?e:e&&typeof e=="object"?e.tags:void 0};ze.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Lr(e))return e.escape};var ot={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){wn.templateCache=r},get templateCache(){return wn.templateCache}},wn=new ze;ot.clearCache=function(){return wn.clearCache()};ot.parse=function(e,t){return wn.parse(e,t)};ot.render=function(e,t,n,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+kv(e)+'" was given as the first argument for mustache#render(template, view, partials)');return wn.render(e,t,n,i)};ot.escape=Mv;ot.Scanner=vn;ot.Context=jr;ot.Writer=ze;var ws=ot;function Dp(){ws.escape=r=>r}var Up=r=>{let e=r.split(""),t=[],n=(s,a)=>{for(let o=a;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1},i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")t.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")t.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){let s=n("}",i);if(s<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(i+1,s).join("")}),i=s+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{let s=n("{}",i),a=(s<0?e.slice(i):e.slice(i,s)).join("");t.push({type:"literal",text:a}),i=s<0?e.length:s}}return t},Vv=r=>r.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Hv=r=>{Dp();let e=ws.parse(r);return Vv(e)},Jv=(r,e)=>Up(r).reduce((t,n)=>{if(n.type==="variable"){if(n.name in e){let i=typeof e[n.name]=="string"?e[n.name]:JSON.stringify(e[n.name]);return t+i}throw new Error(`(f-string) Missing value for input ${n.name}`)}return t+n.text},""),Wv=(r,e)=>(Dp(),ws.render(r,e)),qo={"f-string":Jv,mustache:Wv},Kv={"f-string":Up,mustache:Hv},zr=(r,e,t)=>{try{return qo[e](r,t)}catch(n){throw Rn(n,"INVALID_PROMPT_INPUT")}},Zp=(r,e)=>Kv[e](r),Fp=(r,e,t)=>{if(!(e in qo)){let n=Object.keys(qo);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{let n=t.reduce((i,s)=>(i[s]="foo",i),{});Array.isArray(r)?r.forEach(i=>{if(i.type==="text")zr(i.text,e,n);else if(i.type==="image_url")if(typeof i.image_url=="string")zr(i.image_url,e,n);else{let s=i.image_url.url;zr(s,e,n)}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):zr(r,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};var Bp=class r extends bs{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Fp(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}format(e){return f(this,null,function*(){let t=yield this.mergePartialAndUserVariables(e);return zr(this.template,this.templateFormat,t)})}static fromExamples(e,t,n,i=`

`,s=""){let a=[s,...e,t].join(i);return new r({inputVariables:n,template:a})}static fromTemplate(e,t){let a=t??{},{templateFormat:n="f-string"}=a,i=se(a,["templateFormat"]),s=new Set;return Zp(e,n).forEach(o=>{o.type==="variable"&&s.add(o.name)}),new r(l({inputVariables:[...s],templateFormat:n,template:e},i))}partial(e){return f(this,null,function*(){let t=this.inputVariables.filter(s=>!(s in e)),n=l(l({},this.partialVariables??{}),e),i=m(l({},this),{inputVariables:t,partialVariables:n});return new r(i)})}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static deserialize(e){return f(this,null,function*(){if(!e.template)throw new Error("Prompt template must have a template");return new r({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})})}};export{l as a,m as b,se as c,j as d,we as e,gt as f,Is as g,f as h,x as i,H as j,ve as k,X as l,S as m,Mt as n,$x as o,ks as p,tx as q,hu as r,Pn as s,Ke as t,oh as u,Ct as v,sx as w,ax as x,ox as y,ux as z,cx as A,lx as B,dx as C,fx as D,Ye as E,gu as F,Pe as G,gx as H,le as I,Zr as J,_u as K,De as L,yu as M,Ps as N,_x as O,Px as P,Fr as Q,bu as R,kx as S,Rx as T,pr as U,Mx as V,Dx as W,jt as X,Br as Y,jn as Z,Bx as _,Gx as $,Ln as aa,zn as ba,Jx as ca,Wx as da,It as ea,kn as fa,vx as ga,xx as ha,hr as ia,Mn as ja,Xx as ka,Qx as la,Rn as ma,Cn as na,Tx as oa,Nn as pa,lE as qa,Dn as ra,fh as sa,dE as ta,fE as ua,pE as va,Dt as wa,de as xa,Fm as ya,Ku as za,tr as Aa,B0 as Ba,lt as Ca,Lb as Da,zb as Ea,Ut as Fa,Mb as Ga,Ve as Ha,Ub as Ia,Fb as Ja,Ft as Ka,Bb as La,Vb as Ma,Jb as Na,it as Oa,Yb as Pa,He as Qa,st as Ra,fo as Sa,ne as Ta,Se as Ua,Rt as Va,Te as Wa,dt as Xa,ew as Ya,rw as Za,nw as _a,ur as $a,mo as ab,iw as bb,ln as cb,ow as db,gn as eb,Oo as fb,Vt as gb,oe as hb,me as ib,ge as jb,Xk as kb,$p as lb,Qk as mb,Ip as nb,eR as ob,tR as pb,Ap as qb,rR as rb,Pp as sb,kp as tb,Tt as ub,No as vb,nR as wb,iR as xb,sR as yb,aR as zb,ls as Ab,Op as Bb,oR as Cb,Nr as Db,Co as Eb,ds as Fb,Tv as Gb,bn as Hb,_e as Ib,ye as Jb,dr as Kb,Mo as Lb,hs as Mb,ms as Nb,Cr as Ob,gs as Pb,Lp as Qb,Uo as Rb,lr as Sb,Zo as Tb,Fo as Ub,_s as Vb,Gr as Wb,Ns as Xb,Cs as Yb,ph as Zb,bs as _b,Up as $b,Hv as ac,Jv as bc,Wv as cc,qo as dc,Kv as ec,zr as fc,Zp as gc,Fp as hc,Bp as ic,ys as jc};
